<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>TS1989</title>
  
  <subtitle>Viva La Vida</subtitle>
  <link href="http://www.ts1989.cn/atom.xml" rel="self"/>
  
  <link href="http://www.ts1989.cn/"/>
  <updated>2021-06-18T08:18:01.472Z</updated>
  <id>http://www.ts1989.cn/</id>
  
  <author>
    <name>T-Bag</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>元器件电磁兼容设计</title>
    <link href="http://www.ts1989.cn/2021/06/19/EMC/"/>
    <id>http://www.ts1989.cn/2021/06/19/EMC/</id>
    <published>2021-06-18T16:16:29.000Z</published>
    <updated>2021-06-18T08:18:01.472Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/2018041318060885885-20210618161749392.jpg" alt="img"></p><span id="more"></span><h4 id="内容框架"><a href="#内容框架" class="headerlink" title="内容框架"></a>内容框架</h4><ol><li>基本定义与分类</li><li>理论模型</li><li>常规特性</li><li>高频特性（EMC、寄生参数）</li><li>应用关键点</li></ol><h4 id="课程目的"><a href="#课程目的" class="headerlink" title="课程目的"></a>课程目的</h4><ul><li>清晰器件工作机理</li><li>全面了解器件电气特性</li><li>深析器件高频特性</li><li>掌握器件应用的关键点</li></ul><h3 id="元器件的选型与产品设计"><a href="#元器件的选型与产品设计" class="headerlink" title="元器件的选型与产品设计"></a>元器件的选型与产品设计</h3><h4 id="元器件引起的故障"><a href="#元器件引起的故障" class="headerlink" title="元器件引起的故障"></a>元器件引起的故障</h4><ul><li>压敏电阻炸坏</li><li>热机EMI超标</li><li>批量EMI超标</li><li>电解电容失效</li><li>瓷片电容炸裂</li><li>接插件接触不良</li><li>高温故障</li></ul><h4 id="电源产品"><a href="#电源产品" class="headerlink" title="电源产品"></a>电源产品</h4><ul><li>保险丝：通常考虑浪涌、最大输出功率来选型。</li><li>电容：X电容、Y电容、薄膜电容、电解电容</li><li>电感：共模电感、PFC电感</li></ul><h4 id="270W医疗电源"><a href="#270W医疗电源" class="headerlink" title="270W医疗电源"></a>270W医疗电源</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617163111621.png" alt="image-20210617163111621" style="zoom:50%;" /></p><h4 id="EMC法规"><a href="#EMC法规" class="headerlink" title="EMC法规"></a>EMC法规</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617163519912.png" alt="image-20210617163519912" style="zoom:50%;" /></p><h4 id="元器件选型及应用"><a href="#元器件选型及应用" class="headerlink" title="元器件选型及应用"></a>元器件选型及应用</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617164220621.png" alt="image-20210617164220621" style="zoom:50%;" /></p><h2 id="一、导线"><a href="#一、导线" class="headerlink" title="一、导线"></a>一、导线</h2><ul><li>基本定义与分类</li><li>理论模型</li><li>常规特性</li><li>高频特性</li><li>应用关键点</li></ul><h4 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h4><ul><li>普通导线</li><li>电力线n</li><li>屏蔽线</li><li>组合线</li></ul><h4 id="理论模型"><a href="#理论模型" class="headerlink" title="理论模型"></a>理论模型</h4><p>1）直流伏安特性</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617165245395.png" alt="image-20210617165245395" style="zoom:50%;" /></p><p>2）动态伏安特性</p><p>电阻和电容接入的特性</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617165339572.png" alt="image-20210617165339572" style="zoom:50%;" /></p><h4 id="常规特性"><a href="#常规特性" class="headerlink" title="常规特性"></a>常规特性</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617165638113.png" alt="image-20210617165638113" style="zoom:50%;" /></p><h4 id="高频特性"><a href="#高频特性" class="headerlink" title="高频特性"></a>高频特性</h4><ul><li>低频段呈现低电阻特性</li><li>高频段呈现电感特性</li><li>寄生电感特性</li></ul><p>自感、长度、趋肤深度、射频电阻</p><h4 id="导线自感L"><a href="#导线自感L" class="headerlink" title="导线自感L"></a>导线自感L</h4><script type="math/tex; mode=display">L=0.002·l[2.3log(\frac{4·l}{d}-0.75)]uH</script><p>其中：l为导线长度（cm）；d为导线直径（cm）。</p><p>工程应用中AWG与自感的换算</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617170845712.png" alt="image-20210617170845712" style="zoom:50%;" /></p><h4 id="长度与波长"><a href="#长度与波长" class="headerlink" title="长度与波长"></a>长度与波长</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617171230827.png" alt="image-20210617171230827" style="zoom:50%;" /></p><script type="math/tex; mode=display">C=f·\lambda</script><p>当 $d&lt;\frac{\lambda}{20}$ 导线不会往外辐射电磁波，PCB布线要注意二十分之一波长。</p><h4 id="长度与绞线"><a href="#长度与绞线" class="headerlink" title="长度与绞线"></a>长度与绞线</h4><ul><li>双绞线：右向绞线和左向绞线</li><li>绞线密度：xx/米，一绞的宽度要小于 $\frac{\lambda}{20}$ ，绞线密度需要和供应商要求。如果绞线密度过高，会破坏绝缘强度。</li><li>多层绞线：相邻绞线相反</li></ul><h4 id="趋肤深度"><a href="#趋肤深度" class="headerlink" title="趋肤深度"></a>趋肤深度</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617174742447.png" alt="image-20210617174742447" style="zoom:50%;" /></p><h5 id="趋肤深度与频率"><a href="#趋肤深度与频率" class="headerlink" title="趋肤深度与频率"></a>趋肤深度与频率</h5><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617174821856.png" alt="image-20210617174821856" style="zoom:50%;" /></p><h4 id="射频电阻"><a href="#射频电阻" class="headerlink" title="射频电阻"></a>射频电阻</h4><p>根据趋肤深度计算得到射频电阻。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210617175200216.png" alt="image-20210617175200216" style="zoom:50%;" /></p><h4 id="导线——小结"><a href="#导线——小结" class="headerlink" title="导线——小结"></a>导线——小结</h4><ul><li>导线自感——长度和直径</li><li>导线长度——$\frac{\lambda}{20}$ </li><li>趋肤深度——频率和电导率</li><li>射频电阻——导体形状</li><li>寄生电容</li></ul><h2 id="二、PCB"><a href="#二、PCB" class="headerlink" title="二、PCB"></a>二、PCB</h2><ul><li>基本定义与分类</li><li>加工工艺</li><li>布线流程</li><li>常规特性</li><li>高频特性</li><li>应用关键点</li></ul><h4 id="印制电路板"><a href="#印制电路板" class="headerlink" title="印制电路板"></a>印制电路板</h4><p>印制板英文：Printed Circuit Board</p><p>主要功能：支撑和互连。</p><h5 id="发展简史"><a href="#发展简史" class="headerlink" title="发展简史"></a>发展简史</h5><p>印制电路板概念于1936年由奥地利人Paul Eisler提出，并且首创铜箔腐蚀法工艺；二战中美国利用该工艺技术制造印制板用于军事收音机中，获得成功。</p><p>1953年出现了双面板，并采用电镀工艺使两面导线互连。</p><p>1960面出现多层板。</p><p>1990出现积层多层板。</p><h4 id="基材"><a href="#基材" class="headerlink" title="基材"></a>基材</h4><p>有机材质：</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618094026327.png" alt="image-20210618094026327" style="zoom:50%;" /></p><p>常用：FR-1、FR-4、CRM-1</p><p>强度、防火、软硬不同分类</p><p>熔点 $T_g$ （玻璃转化温度）：保持刚性最高温度，在此温度下不能燃烧。</p><h5 id="阻燃性"><a href="#阻燃性" class="headerlink" title="阻燃性"></a>阻燃性</h5><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618095240803.png" alt="image-20210618095240803" style="zoom:50%;" /></p><h4 id="PCB加工工艺"><a href="#PCB加工工艺" class="headerlink" title="PCB加工工艺"></a>PCB加工工艺</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618140744654.png" alt="image-20210618140744654" style="zoom:50%;" /></p><h4 id="布线流程标准化"><a href="#布线流程标准化" class="headerlink" title="布线流程标准化"></a>布线流程标准化</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618141034317.png" alt="image-20210618141034317" style="zoom:50%;" /></p><h4 id="常规特性-1"><a href="#常规特性-1" class="headerlink" title="常规特性"></a>常规特性</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618141439653.png" alt="image-20210618141439653" style="zoom:50%;" /></p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618142804427.png" alt="image-20210618142804427" style="zoom:50%;" /></p><h3 id="PCB高频特性"><a href="#PCB高频特性" class="headerlink" title="PCB高频特性"></a>PCB高频特性</h3><ol><li>过孔</li><li>PCB内传输线</li><li>隐藏电容</li><li>3W原则</li><li>20H原则</li><li>叠层设计</li><li>镜像面</li><li>回路面积</li><li>接地</li><li>地弹</li></ol><h4 id="过孔"><a href="#过孔" class="headerlink" title="过孔"></a>过孔</h4><ul><li>寄生电容</li><li>寄生电感</li></ul><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618143443910.png" alt="image-20210618143443910" style="zoom:50%;" /></p><h5 id="寄生电容"><a href="#寄生电容" class="headerlink" title="寄生电容"></a>寄生电容</h5><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618143538878.png" alt="image-20210618143538878" style="zoom:50%;" /></p><p>过孔的寄生电容的充放电会产生电压突降和电压尖峰，从而延长信号的上升时间，降低电路速度。因此，过孔及电容在制造工艺和允许范围内应尽量小，在高频中需要特别重视。</p><h5 id="寄生电感"><a href="#寄生电感" class="headerlink" title="寄生电感"></a>寄生电感</h5><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618144052602.png" alt="image-20210618144052602" style="zoom:50%;" /></p><h5 id="过孔注意点："><a href="#过孔注意点：" class="headerlink" title="过孔注意点："></a>过孔注意点：</h5><ul><li>选择合理的过孔大小</li><li>薄PCB有利于减小寄生参数</li><li>PCB走线尽量不要换层，即尽量少用不必要的过孔。因为每个过孔都是一个阻抗不连续点。</li><li>电源和地的引脚就近打过孔。</li></ul><h4 id="PCB传输线"><a href="#PCB传输线" class="headerlink" title="PCB传输线"></a>PCB传输线</h4><ul><li>当电路的频率超过50MHz时，电磁能量沿PCB走线，电缆和同轴电缆等此类线沿传输线传播</li><li>PCB走线传输高频信号与传输直流或低频信号有很大不同，多层PCB中毗邻的互联关系必须以传输线考虑</li><li>无损传输线等效电路为并联电容和串联电感结构</li><li>有损传输线等效电路为串联电阻和电感，和并联电容结构</li></ul><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618152320609.png" alt="image-20210618152320609" style="zoom:50%;" /></p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618152446482.png" alt="image-20210618152446482" style="zoom:50%;" /></p><h5 id="PCB传输线的天线效应"><a href="#PCB传输线的天线效应" class="headerlink" title="PCB传输线的天线效应"></a>PCB传输线的天线效应</h5><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618152528212.png" alt="image-20210618152528212" style="zoom:50%;" /></p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618152656907.png" alt="image-20210618152656907" style="zoom:50%;" /></p><h4 id="隐藏电容"><a href="#隐藏电容" class="headerlink" title="隐藏电容"></a>隐藏电容</h4><p>多层板必须要考虑的参数，用好隐藏电容可以大幅度减小PCB板辐射。</p><ul><li>电源层和接地层邻近安装，相当于一个大的退耦电容。而且该寄生电容具有非常小的等效引线电感，没有等效串联电阻ESR</li><li>电容的容量与板芯的厚度、填充介质和叠层中的位置和大小有关</li></ul><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618153208888.png" alt="image-20210618153208888" style="zoom:50%;" /></p><p>【Tip】当电源层和接地层之间的自谐振频率与安装在PCB板上的集中退耦电容的自谐振频率相同或接近时，将会产生尖锐的共振，不会用宽的退耦频段分布，影响退耦效果。此时可以用不同自谐振频率的退耦电容，避免发生与PCB板电源层和接地层的共振。</p><h4 id="3W原则——70"><a href="#3W原则——70" class="headerlink" title="3W原则——70%"></a>3W原则——70%</h4><p>三倍宽度原则：</p><p>时钟线附近往往会有别的临近的导线，如何保证互相之间不干扰呢？</p><p>答：时钟产生的场强（磁场、电场）衰减需要达到70%，一般间隔要大于两倍的宽度。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618153920248.png" alt="image-20210618153920248" style="zoom:50%;" /></p><h4 id="20H原则"><a href="#20H原则" class="headerlink" title="20H原则"></a>20H原则</h4><p>二十倍厚度原则</p><p>Mr.W.Michael.King 提出所有具有一定电压的PCB板都会向空间辐射能量，为了能减少辐射效应，PCB板的物理尺寸应小于靠近的接地板的物理尺寸20H，使得辐射强度下降70%，其中H为两层印制板之间的距离。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618154543158.png" alt="image-20210618154543158" style="zoom:50%;" /></p><ul><li>电源层与底层的距离包括芯层距离、填充介质及PCB制造中的绝缘隔离距离</li><li>如果两层间距离为0.006in，20H则为0.12in</li></ul><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618155143502.png" alt="image-20210618155143502" style="zoom:50%;" /></p><h4 id="镜像面"><a href="#镜像面" class="headerlink" title="镜像面"></a>镜像面</h4><ul><li>高速器件（快速边沿速率）为实现最佳性能，必须提供低阻抗（低电感）的RF返回线路，实现闭环网络。</li><li>很多设计中经常只考虑信号电流的流经路线，忽略电流的回流路线，而电流的回流到地的路径和方式正好是混合信号电路设计的关键。</li><li>由低阻抗（低电感）的RF返回线路所形成的闭环网络在时域和频域上的要求</li><li>RF电流必须返回它的源以形成闭环电路，因此任何可能的路径都有机会被使用。</li><li><strong>如果没有提供合适的传导路径，自由空间就成为返回路径，从而产生电磁干扰。</strong><ul><li>控制芯片的旁路电容（0.1uF），就是给60～100MHz频率的噪声提供了低阻抗的回路。如果没有这个环路电容，这个频段的噪声就会散发到自由空间中去。如果有这个电容可以对这个频段达到一个90%（抑制20dB）的衰减。</li></ul></li><li>单面板无RF返回路径，如果增加一个接地层，即使用双层板、四层板甚至更多层的PCB板，均会提高PCB板的信号完整性以及电磁兼容性能。</li><li>如果在双层板增加2个或多个电源层和接地层，同城可以获得10-20dB的辐射性能改进。</li><li>为避免PCB成本的增加，多通过金属保护层或金属化的塑壳保护层来提高电磁兼容能力。</li><li>镜像面可以提供最有RF返回路径，减少串扰和电磁干扰。</li><li>通常镜像层可以是电源层、接地层、铜箔板和隔离层4种。镜像面已成为PCB设计中的标准技术。</li><li>由于镜像面的紧密耦合，RF电流不需要通过其它回路回到源处，因而镜像面技术不仅能降低地噪声，还能防止产生接地环路耦合干扰。</li><li>要减小通过导体的电压降，必须提高两个并联导体之间的互感<ul><li>增加互感的方法就是使RF回路与信号线尽量靠近，使他们之间的距离达到可能的最小值。</li><li>互感存在于两条并行的导线之间</li><li>为了得到最佳互感，两条导线必须大小相等、方向相反。这是镜像面起作用的关键点</li><li>两条并行导线之间距离越小、长度越长，互感越大。</li></ul></li><li>多层PCB中的电源层或接地层可以作为邻近电路或信号层的镜像面，可以提供啊电路板电磁兼容性</li><li>多层板带来成本的增加，可以考虑使用网络接地系统。</li></ul><h5 id="镜像面理论基础"><a href="#镜像面理论基础" class="headerlink" title="镜像面理论基础"></a>镜像面理论基础</h5><p>信号V1和V2通过导线到另一端，每一根导线都有一个自感，两个靠近会产生互感。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618160738481.png" alt="image-20210618160738481" style="zoom:50%;" /></p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618160628422.png" alt="image-20210618160628422" style="zoom:50%;" /></p><ul><li>提高增加并联导体的互感，以减小导体上电压降。</li><li>互感与导体的距离和长度直接相关。</li></ul><h5 id="网络接地层结构"><a href="#网络接地层结构" class="headerlink" title="网络接地层结构"></a>网络接地层结构</h5><p>波长 $\frac{\lambda}{20}$</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210618161406268.png" alt="image-20210618161406268" style="zoom:50%;" /></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/2018041318060885885-20210618161749392.jpg&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="EMBEDDED" scheme="http://www.ts1989.cn/categories/EMBEDDED/"/>
    
    
    <category term="HARDWARE" scheme="http://www.ts1989.cn/tags/HARDWARE/"/>
    
  </entry>
  
  <entry>
    <title>运放基础</title>
    <link href="http://www.ts1989.cn/2021/06/13/OPA2/"/>
    <id>http://www.ts1989.cn/2021/06/13/OPA2/</id>
    <published>2021-06-13T14:19:08.000Z</published>
    <updated>2021-06-16T04:18:33.061Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/OPA-20210616121804247.jpg" alt="OPA"></p><span id="more"></span><h2 id="模电如何入门"><a href="#模电如何入门" class="headerlink" title="模电如何入门"></a>模电如何入门</h2><p>多学科：电子学、控制理论、信号系统、微积分、统计学</p><p>很多物理学家本身都是很优秀的数学家，学好物理需要很扎实的数学功底。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210615183123572.png" alt="image-20210615183123572"></p><p>物理电路经过抽象建模之后可以得到一个数学模型，物理学和数学相辅相成，物理学推动数学在实际中的应用。通过物理电路的实践操作，感受真实的物理世界。通过数学建模，把物理电路理论化，从更底层的数学基础上去理解物理电路的工作过程。</p><p>要学好模拟电路，首先要相信逻辑思维、相信基本定律。模拟电路在我们遇到问题的时候表现得像一门玄学，对于初入门的人来说多了许多神秘感。但是我们要相信自己的思维判断，要相信最基本的逻辑思维和基本定律。包括欧姆定律、能量守恒定律等等。</p><p>多看书、多动手计算、勤于思考发散思维、多实操电路。</p><p>由浅入深，从最基本的电路慢慢深入到复杂电路，最后再把复杂电路简单化。</p><p>此文不需要过多的数学和物理知识以及部分的微积分基础就可以迅速建立起一套知识框架，但是我们需要对于这部分的理论进行一定深度的探索，需要对基础理论进行熟练详细的推导。</p><ul><li>电路分析基础</li><li>一阶RC系统</li><li>运放电路分析</li><li>运放参数概念【核心】</li><li>运放参数产生的误差【核心】</li><li>频域——时域变换</li><li>反馈控制基础</li></ul><p>运放是一门数学为基础的学科。</p><h2 id="运算放大器基础"><a href="#运算放大器基础" class="headerlink" title="运算放大器基础"></a>运算放大器基础</h2><h3 id="为什么需要运放？"><a href="#为什么需要运放？" class="headerlink" title="为什么需要运放？"></a>为什么需要运放？</h3><p>Harold Black发明了负反馈放大电路，不仅促进了电子学的发展，也促进了控制理论的发展。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210616094202983.png" alt="image-20210616094202983"></p><p>A选取足够大，放大倍数与前向增益A无关，只与 $\beta$ 有关。（$\beta$ 是反馈端电阻配比）</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210616094708954.png" alt="同向放大器"></p><p>R1和R2实现了一个反馈控制网络。人们先发明了反馈控制环路，所以他们需要一个求差的一个器件，而放大器刚好可以满足这样的要求。求差、乘以前向增益、得到的Vout乘以反馈系数…….如此循环。</p><ul><li>运算放大器增益越大越好，单个放大器中放大倍数一般是10倍或20倍，而不会是100倍，就是因为实际情况增益A并不是无穷大。因为放大倍数越大，要达到理想状态对运放的增益A要求也就越大。</li><li>$\beta = \frac{R_1}{R_1+R_2}$ 的前提是放大器的负输入端无电流（虚断），因为如果有电流，那么在这一端就会有压降。</li><li>在运放的两条等式中，我们都是在虚短和虚断的条件下来列等式的。</li></ul><p>运放需要满足的三个理想化条件：增益无穷大、虚短、虚断（输入阻抗无穷大）</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210616113542096.png" alt="image-20210616113542096"></p><p>非理想因素 $A\beta &gt;&gt; 0$ </p><h3 id="电路分析基础"><a href="#电路分析基础" class="headerlink" title="电路分析基础"></a>电路分析基础</h3><h4 id="能量守恒定律"><a href="#能量守恒定律" class="headerlink" title="能量守恒定律"></a>能量守恒定律</h4><p>孤立系统的总能量保持不变。</p><blockquote><p>能量既不会凭空产生也不会凭空消失，只会从一个物体转化到另一个物体，或者从一种形式转化为另一种形式，而在转化或者转移的过程中，能量总量保持不变。</p></blockquote><h4 id="电荷守恒定律"><a href="#电荷守恒定律" class="headerlink" title="电荷守恒定律"></a>电荷守恒定律</h4><p>对一个孤立系统，不论发生什么变化，其中所有电荷的代数和永远保持不变。</p><blockquote><p>如果某一区域中的电荷增加或减少了，那么必定有等量的电荷进入或离开该区域；如果一个物流过程中产生或消失了某种符号的电荷，那么必定有等量的异号电荷产生或消失。</p></blockquote><h4 id="欧姆定律"><a href="#欧姆定律" class="headerlink" title="欧姆定律"></a>欧姆定律</h4><p>在同一电路中，通过某一导体的电流跟这段导体两端的电压成正比，跟这段导体的电阻成反比。</p><h4 id="KCL定律（基尔霍夫电流定律）"><a href="#KCL定律（基尔霍夫电流定律）" class="headerlink" title="KCL定律（基尔霍夫电流定律）"></a>KCL定律（基尔霍夫电流定律）</h4><p>流入任何节点的电流代数和等于零。</p><h4 id="KVL定律（基尔霍夫电压定律）"><a href="#KVL定律（基尔霍夫电压定律）" class="headerlink" title="KVL定律（基尔霍夫电压定律）"></a>KVL定律（基尔霍夫电压定律）</h4><p>沿任何闭合回路电压的代数和等于零。</p><h4 id="时域下电容的IV方程"><a href="#时域下电容的IV方程" class="headerlink" title="时域下电容的IV方程"></a>时域下电容的IV方程</h4><p>电压源下电容</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210616115602700.png" alt="image-20210616115602700" style="zoom:50%;" /></p><p>电流源下电感（电容和电感存在一种对偶的特性）</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210616115744382.png" alt="image-20210616115744382" style="zoom:50%;" /></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/OPA-20210616121804247.jpg&quot; alt=&quot;OPA&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="EMBEDDED" scheme="http://www.ts1989.cn/categories/EMBEDDED/"/>
    
    
    <category term="HARDWARE" scheme="http://www.ts1989.cn/tags/HARDWARE/"/>
    
  </entry>
  
  <entry>
    <title>由NFC设计引出的关于天线及其PCB设计</title>
    <link href="http://www.ts1989.cn/2021/06/09/NFC/"/>
    <id>http://www.ts1989.cn/2021/06/09/NFC/</id>
    <published>2021-06-09T11:12:29.000Z</published>
    <updated>2021-06-09T03:43:14.074Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/v2-385f04e0edfe4a3200a289c8e31da640_r.jpg" alt="v2-385f04e0edfe4a3200a289c8e31da640_r"></p><span id="more"></span><h2 id="天线工作原理"><a href="#天线工作原理" class="headerlink" title="天线工作原理"></a>天线工作原理</h2><p>① 电信号 -&gt; 电磁波    利用封闭导体电磁感应（源附近的波动场）</p><p>​    而NFC属于近场通信，理论上并不产生远距离传输的电磁波。</p><p>② 电磁波必须与源分离并向外传播，其本质是带电粒子的运动</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210602194043317.png" alt="image-20210602194043317" style="zoom: 67%;" /></p><p>波长 = 正负电荷最大分隔距离的2倍</p><p>要实现最佳传输，天线长度 = 波长一半，同时天线的电磁效应是可逆的，可以作为接收器。</p><p>天线频率就是天线上电压变化的频率。</p><ul><li>蝶形电视天线：抛物面反射器 —反射聚集—&gt; 低噪声下变频器 —同轴线缆—&gt; 馈源喇叭、一段波导、PCB、探针</li><li>贴片天线：贴片长度 = 工作波长一半</li></ul><script type="math/tex; mode=display">L = \frac\lambda2$</script><script type="math/tex; mode=display">\lambda = \frac{300}f \qquad(\lambda:m;f:MHz)</script><p>想要L变小，即天线做得更短更小，f就需要变大，手机天线频率只能是高频。</p><h4 id="几种天线"><a href="#几种天线" class="headerlink" title="几种天线"></a>几种天线</h4><p>① 半波振子天线：1/2波长天线，其余为1/4波长天线</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210603110045771.png" alt="image-20210603110045771"></p><p>② 单极子：半波振子天线的一半</p><p>③ 倒L型天线：单极子天线弯折一段，减少天线高度。</p><p>④ 蛇形倒F天线（MIFA）：占用PCB空间小</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210603110136097.png" alt="image-20210603110136097"></p><p>根据不同的PCB厚度，需要调整MIFA的长度，这样才能调整天线辐射和频率的选择，MIFA根据不同电路板厚度的天线长度如下表：</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210603110649593.png" alt="image-20210603110649593"></p><p>⑤ 倒F型天线（IFA）：倒L型天线上半与地平行，增加了容抗。所以在拐角处接地，增加感性，以保持谐振特性。</p><p>相比MIFA，IFA是一种辐射更好的天线。给定空间可用性IFA天线比MIFA更好，有更好的效率，但需要更大的面积。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210603110948058.png" alt="image-20210603110948058"></p><p>IFA的迹线宽度也取决于产品的PCB堆叠，不同厚度的PCB有不同的W值。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210603111118567.png" alt="image-20210603111118567"></p><p>[Tip]：天线放置在靠近塑料的位置，谐振频率会降低。变化范围100MHz-200MHz，需要重新调谐获得所需频带。</p><h4 id="天线效应"><a href="#天线效应" class="headerlink" title="天线效应"></a>天线效应</h4><p>在四分之一波长处测量，即可被视为短路，也可被视为开路。</p><p>天线的长度为 1/4 或者 1/2 波长，因此在EMC规范中，不允许导线在 $\frac\lambda{20}$ 以下工作，这会使它变成一根天线，电感电容会造成谐振。</p><p>150MHz时，$\lambda=2m$，$\frac\lambda{20} = 10cm$ ，在 $f &gt; 150MHz$ 时，$\frac\lambda{4}$ 接近10cm，逐渐形成完美天线。 </p><h2 id="阻抗匹配"><a href="#阻抗匹配" class="headerlink" title="阻抗匹配"></a>阻抗匹配</h2><h3 id="谐振"><a href="#谐振" class="headerlink" title="谐振"></a>谐振</h3><blockquote><p>含 L 和 C 的电路，在特定 f 的外加电源的作用下，对外呈电阻性质的现象。这一特定的 f 即为谐振频率。以谐振频率为主工作状态的电路即为谐振电路。</p></blockquote><ul><li>有的时候需要谐振：天线<ul><li>振荡电路具有固有频率，电路输入接近固有频率的交流电，振荡电路会以大振幅体现，造成危害。</li></ul></li><li>有的时候需要避免谐振：电网谐波<ul><li>发生谐振，只剩电阻，一个小的谐波电流源产生很大的谐波电压造成损坏。</li></ul></li></ul><p>导体波长与信号波长呈特定比例也称作谐振，因为这样可以将电能发射到空间中。</p><h3 id="特性阻抗"><a href="#特性阻抗" class="headerlink" title="特性阻抗"></a>特性阻抗</h3><blockquote><p>导线对在其上传输的 <strong>射频能量</strong> 阻碍力的大小，也可以理解为对高频交流成分阻碍力的大小。区别于一般直流电路的电阻大小。</p></blockquote><p>$特性阻抗 = 射频电压/射频电流$</p><p>天线越宽，特性阻抗越小。传输的电能在天线末端连接空气，能量无法释放，就会沿着导线反射回来。是由于末端的阻抗突变导致的。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210603093717218.png" alt="image-20210603093717218"></p><p>假设末端接入电阻R吸收射频能量：</p><p>① 当 $R = R_0$ 时，传输能量被吸收完，无能量返回，导线被视作无限长。</p><p>② 当 $R = \infty$ 时，能量全部反射，末端形成2倍于发射电源的电压。</p><p>③ 当 $R = 0$ 时，末端产生 -1 倍于电源的电压反射回去。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/de123cb3028f7b71e22c769031f5e17.jpg" alt="阻抗实验"></p><p>相关：<a href="https://www.bilibili.com/video/av542412492/">特性阻抗末端电阻实验</a></p><h3 id="阻抗匹配-1"><a href="#阻抗匹配-1" class="headerlink" title="阻抗匹配"></a>阻抗匹配</h3><blockquote><p>负载阻抗与激励源内部阻抗互相适配，得到最大功率输出。</p></blockquote><p>阻抗匹配能量是对于射频而言的，对功率电路而言会造成破坏。</p><p>阻抗匹配应用：功放音响、PCB走线、天线设计、终端匹配电阻。</p><p>改变组抗力的方法：</p><ul><li>改变阻抗力：RLC串并联调整负载阻抗值</li><li>调整传输线：加长源和负载距离，配合LC阻抗力调为0</li></ul><p>天线中传输考虑50Ω的阻抗是由传输线中高频交流的趋肤效应决定的。</p><p>特征阻抗 $Z_0$ ：无损传输线传播的波的电压和电流振幅比。</p><script type="math/tex; mode=display">Z_0 = \sqrt\frac{L}{C}$</script><p>$Z_0$ 取决于，PCB材料、基底厚度、迹线宽度、迹线厚度、迹线RF、接地填充物间隙 等。</p><h4 id="天线馈线和空气的阻抗匹配："><a href="#天线馈线和空气的阻抗匹配：" class="headerlink" title="天线馈线和空气的阻抗匹配："></a>天线馈线和空气的阻抗匹配：</h4><p>50Ω传输线是天线馈线系统中的特性阻抗，而天线是在馈线和自由空间中的一个分界面。自由空间（真空）中的特性阻抗为377Ω，天线起了特性阻抗变换的作用，将电磁波能最大部分发射出去。如果不匹配，电磁波会在天线末端反射回信号源。</p><p>天线是馈线和自由空间的阻抗变换器，是连接发射端和空气的介质，以便将能量从电路辐射到空间中去。</p><p>天线系统中</p><ul><li>高频振荡电流：满足基尔霍夫定律</li><li>电磁波到无界空间：波动方程和麦克斯韦方程</li></ul><h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><h4 id="驻波"><a href="#驻波" class="headerlink" title="驻波"></a>驻波</h4><blockquote><p>相反方向传播的振幅、频率都相同的波。（实验中一般利用反射）</p></blockquote><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/20110602210602364.jpg" alt="20110602210602364"></p><h4 id="回波损耗"><a href="#回波损耗" class="headerlink" title="回波损耗"></a>回波损耗</h4><blockquote><p>表示天线如何与特性阻抗50ohm的传输线皮诶。一个理想天线会发射所有功率，不产生任何反射。</p></blockquote><p>回波损耗大于10dB就足够大，90%的功率可被辐射。</p><script type="math/tex; mode=display">Return Loss(dB) = 10 * log(\frac{Incident Power}{Reflect Power})</script><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210603110340705.png" alt="image-20210603110340705"></p><p>上图显示的是MIFA在2.44GHz频率时完整的3D辐射增益图，再给自定义应用设置MIFA天线时，该信息非常有用，有助于在需要的方向上得到最大的辐射。</p><h4 id="带宽"><a href="#带宽" class="headerlink" title="带宽"></a>带宽</h4><p>无线频率响应。表示在采用的整个频带上。（在该频率时回波损耗最小）。</p><h4 id="辐射效率"><a href="#辐射效率" class="headerlink" title="辐射效率"></a>辐射效率</h4><p>非反射功耗中消耗在天线中的热量。</p><h4 id="增益"><a href="#增益" class="headerlink" title="增益"></a>增益</h4><p>与一个理想无方向天线对比辐射的场强。</p><h4 id="调制"><a href="#调制" class="headerlink" title="调制"></a>调制</h4><p>将原始信号变成适合信道传输的高频信号。</p><h2 id="射频PCB指南"><a href="#射频PCB指南" class="headerlink" title="射频PCB指南"></a>射频PCB指南</h2><ol><li>置于角落PCB，保持间距</li><li>切勿在所有层的天线禁区放置任何组件、迹线、平面</li><li>塑料介电常数 &gt; 空气，无形中降低谐振频率</li><li>无线近场不允许金属</li><li>方向的一致性</li><li>天线匹配网络提供配置，天线参数变化改变阻抗，可能重新调谐，π、T网络提供配置，串联元件填充0Ω</li><li>场景验证</li><li>天线下方不能有任何接地</li><li>遵循制造商推荐的接地方式</li><li>Wifi区域记得去除上下层的绿油</li><li>最短RF</li><li>避免RF弯曲</li><li>避免短路和分支</li><li>不要任何走线平行于RF</li><li>不要测试点</li><li>元件放置在RF路径上</li><li>将一层完全用于接地</li></ol><p>另外：阻抗匹配、天线调试、RF传输线、PCB堆叠 等</p><p>死铜移除：孤岛形成天线效应，会增加周围辐射强度，并且有天线接收效应，引入电磁干扰，造成EMI问题。</p><h4 id="多层板"><a href="#多层板" class="headerlink" title="多层板"></a>多层板</h4><p>四层板：射频 + GND + PWR +非射频</p><p>二层板：PWR、信号、天线、RF + GND（完整）</p><h4 id="GND"><a href="#GND" class="headerlink" title="GND"></a>GND</h4><ol><li>一层完全接地better</li><li>过孔间距 &lt; 波长 1/20，与多层板地平面良好接地，避免天线效应。</li><li>不要分流接地</li><li>RF走线下地平面宽敞</li><li>迹线两边GND通孔保护，EMC、EMI性能提升</li><li>电源层周围GND瞳孔包围，EMI性能提升</li></ol><h4 id="电源解耦"><a href="#电源解耦" class="headerlink" title="电源解耦"></a>电源解耦</h4><ol><li>滤除不同频率的噪声</li><li>满足浪涌电流的大电容设计</li><li>组件靠近电源引脚</li><li>小电容靠近</li><li>去耦电容相同层</li><li>避免电源通孔</li><li>四层板设计，每个电源引脚独立的过孔和电源层，不共享过孔</li></ol><h4 id="过孔"><a href="#过孔" class="headerlink" title="过孔"></a>过孔</h4><ol><li>间距 &lt; $\lambda/20$</li><li>多过孔减小寄生电感</li><li>不共用过孔，分别设置</li><li>QFN大量过孔</li><li>RF拒绝过孔</li><li>射频周围GND过孔形成栅栏，隔离电路其余部分</li></ol><h2 id="NFC电路设计——以ST25R3911B为例"><a href="#NFC电路设计——以ST25R3911B为例" class="headerlink" title="NFC电路设计——以ST25R3911B为例"></a>NFC电路设计——以ST25R3911B为例</h2><p>PCB板卡工艺：</p><ul><li>4层板设计，EMI friendly</li><li>PCB左侧数字走线，右侧模拟线</li><li>差分驱动，空间小，完全对称</li><li>通孔缝合——低阻抗<br>通孔屏蔽——通孔壁创建垂直铜屏障，防止串扰和电磁干扰问题</li><li>RFI记录道和AAT车道靠近</li><li>中间层GND低欧姆直流路径</li><li>中间层配电，5V+3V3</li><li>重要模拟轨迹用GND包围</li></ul><p>芯片相关：</p><ul><li>AAT自动调谐</li><li>差分低阻抗天线驱动器</li><li>低功耗（电容+幅度和相位测量）</li></ul><p>参考：<a href="https://www.cypress.com/file/136236/download">Antenna Design and RF Layout Guidelines</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/v2-385f04e0edfe4a3200a289c8e31da640_r.jpg&quot; alt=&quot;v2-385f04e0edfe4a3200a289c8e31da640_r&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="EMBEDDED" scheme="http://www.ts1989.cn/categories/EMBEDDED/"/>
    
    
    <category term="HARDWARE" scheme="http://www.ts1989.cn/tags/HARDWARE/"/>
    
  </entry>
  
  <entry>
    <title>正交编码</title>
    <link href="http://www.ts1989.cn/2021/06/04/QEP/"/>
    <id>http://www.ts1989.cn/2021/06/04/QEP/</id>
    <published>2021-06-03T23:34:29.000Z</published>
    <updated>2021-06-11T08:56:21.942Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/Screen.png" alt="Screen"></p><span id="more"></span><h2 id="正交编码器"><a href="#正交编码器" class="headerlink" title="正交编码器"></a>正交编码器</h2><blockquote><p>正交编码器（又名双通道增量式编码器），用于将线性移位转换为脉冲信号。通过监控脉冲的数目和两个信号的相对相位，用户可以跟踪旋转位置、旋转方向和速度。另外，第三个通道称为索引信号，可用于对位置计数器进行复位，从而确定绝对位置。</p></blockquote><p>两个信号相位相差90度，这两个信号就称为正交。</p><h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>增量型编码器通过内部光敏接收管将编码器的转向转化为A相和B相脉冲的时序和相位关系。编码器每转还输出一个Z相脉冲以代表零位参考位。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/71a50536gw1ewzcnk3emlg20go0900uc-20210603011740427.gif" alt="71a50536gw1ewzcnk3emlg20go0900uc" style="zoom: 67%;" /></p><p>通过A、B输出波形可知每个运动周期的时序为</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210602162125040-20210603011740475.png" alt=""></p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210602162135148-20210603011740521.png" alt=""></p><h3 id="编码器的中断"><a href="#编码器的中断" class="headerlink" title="编码器的中断"></a>编码器的中断</h3><p>编码器的中断实际上就是定时器的中断。也就是说定时器是每隔一定时间加一个数（或减一个数 ），当数到达预设值时就产生中断，而编码器是每一个有效脉冲就加一个数（或减一个数 ），当数到达预设值时就产生中断。若预设值为1000则编码器与定时器中断不同的是，当编码器反转时值到达999产生一次中断，而当编码器正转到达0时同 样产生一次中断。在硬件上这两个中断是没法区分的，这也就造成了有种情况的误判。</p><p>想象一下，如果编码器的预设值为1000，当某次我们使得编码器正转产生中断后，立即反转则又该怎么办呢？根据上面的说法，这时候会产生两次一样的中断。 如果在算法上没有处理的话，极有可能认为是行走了两次正向。但实际上并没有。所以这个时候必须结合方向来判断行走的情况（判断方向使用的是DIR寄存器 位）或者在产生中断后读一次count寄存器位（看看是999还是0，以此来判断当前的方向）。只有上一次为正且这一次同样为正，距离才是相加的。</p><p>读取编码器的数据一般有三种方式：</p><p>① 专用硬件模块</p><p>② I/O中断处理</p><p>③ 普通I/O读取并处理</p><p>从①至③，占用的计算资源依次增大，但通用性也依次增大，本文将讲解第三种读取方式的原理和实现方式。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210602170725944-20210603011740569.png" alt=""></p><p>两相数据都发生变化时，无法判定是顺时针或逆时针旋转，于是都假定变化后数据是在 A相跳变时采集的数据。当采样频率足够高时，两相数据同时发生变化的概率很小，这样的计算方式是足够精确的。</p><p>用C语言来表示以上表格的含义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint8_t</span> state = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Update</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//Read new state bits</span></span><br><span class="line"><span class="keyword">if</span> (digitalRead(A))</span><br><span class="line">&#123;</span><br><span class="line">state |= <span class="number">0x02</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (dagitalRead(B))</span><br><span class="line">&#123;</span><br><span class="line">state |= <span class="number">0x01</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (state)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x01</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x07</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x08</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x0E</span>:</span><br><span class="line">position -= <span class="number">1</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x02</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x04</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x0B</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x0D</span>:</span><br><span class="line">position += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x03</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x0C</span>:</span><br><span class="line">position -= <span class="number">2</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x06</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x09</span>:</span><br><span class="line">position += <span class="number">2</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="comment">//case 0x00:</span></span><br><span class="line"><span class="comment">//case 0x05:</span></span><br><span class="line"><span class="comment">//case 0x0A:</span></span><br><span class="line"><span class="comment">//case 0x0F:</span></span><br><span class="line"><span class="comment">//position += 0;</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Update the old state</span></span><br><span class="line">state &lt;&lt;= <span class="number">2</span>;</span><br><span class="line"><span class="comment">//Keep the old state bits and clear other bits</span></span><br><span class="line">state &amp;= <span class="number">0x0C</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>循环调用以上的函数，就可以得到编码器旋转的栅格数，从而计算出旋转速度和距离。</p><h3 id="STM32的编码器模式"><a href="#STM32的编码器模式" class="headerlink" title="STM32的编码器模式"></a>STM32的编码器模式</h3><p>在STM32中，编码器使用的是定时器接口，通过数据手册可知，定时器1，2，3，4，5和8有编码器的功能，而其他没有。编码器输入信号TI1,TI2经过输入滤波，边沿检测产生TI1FP1，TI2FP2接到编码器模块，通过配置编码器的工作模式，即可以对编码器进行正向/反向计数。</p><h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><ol><li>编码器有个转速上限,超过这个上限是不能正常工作的,这个是硬件的限制,原则上线数越多转速就越低,这点在选型时要注意,编码器的输出一般是开漏的,所以单片机的IO一定要上拉输入状态</li><li>定时器初始化好以后,任何时候CNT寄存器的值就是编码器的位置信息,正转他会加反转他会减这部分是不需要软件干预的,初始化时给的TIM_Period 值应该是码盘整圈的刻度值,在减溢出会自动修正为这个数.加超过此数值就回0</li><li>如果要扩展成多圈计数需要溢出中断,程序上圈计数加减方向位就行了</li><li>每个定时器的输入脚可以通过软件设定滤波</li><li>应用中如果没有绝对位置信号或者初始化完成后还没有收到绝对位置信号前的计数只能是相对计数.收到绝对位置信号后重新修改一次CNT的值就行了.码盘一般都有零位置信号,结合到定时器捕获输入就行.上电以后要往返运动一下找到这个位置</li><li>即便有滤波计数值偶尔也会有出错误的情况,一圈多计一个或少计一个数都是很正常的特别是转速比较高的时候尤其明显,有个绝对位置信号做修正是很有必要的.绝对位置信号不需要一定在零位置点,收到这个信号就将CNT修正为一个固定的数值即可</li><li>开启定时器的输入中断可以达到每个步计数都作处理的效果,但是高速运转的时候你可能处理不过来</li></ol><p>参考：<a href="https://blog.csdn.net/cyj972628089/article/details/112852960">STM32——编码器测速原理及STM32编码器模式</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/Screen.png&quot; alt=&quot;Screen&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="EMBEDDED" scheme="http://www.ts1989.cn/categories/EMBEDDED/"/>
    
    
    <category term="HARDWARE" scheme="http://www.ts1989.cn/tags/HARDWARE/"/>
    
  </entry>
  
  <entry>
    <title>关于线性稳压器(LDO)的选型</title>
    <link href="http://www.ts1989.cn/2021/05/30/LDO/"/>
    <id>http://www.ts1989.cn/2021/05/30/LDO/</id>
    <published>2021-05-30T11:55:21.000Z</published>
    <updated>2021-06-09T06:18:30.374Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/268182-20150918151814148-1793256196.png" alt="268182-20150918151814148-1793256196"></p><span id="more"></span><h3 id="关于该充电板遇到的问题"><a href="#关于该充电板遇到的问题" class="headerlink" title="关于该充电板遇到的问题"></a>关于该充电板遇到的问题</h3><h4 id="IP5306"><a href="#IP5306" class="headerlink" title="IP5306"></a>IP5306</h4><p>首先是在充电芯片上遇到的问题，我选用的是英集芯的一款 IP5306 做锂电池的充放电管理。作为一款在充电宝中广泛运用的芯片，也踩了一些坑。由于早些时候就用IP5306做过设计，所以这次电路基本是照搬的原先的设计，但是在因为没有用到pin 8，就默认将其悬空了。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/picgo/image-20210609121858151.png" alt="image-20210609121858151"></p><p>IP6306，BAT脚降压给电池充电，Vout脚升压5V输出。电路基本按照手册设计，但是每次充电管理芯片每次上电不到三分钟，电池端直接短路保护。因为这个电路用过好多次了，一度以为是后续电路造成的问题。</p><p>事实证明很多时候遇到问题不要盲目尝试，而要多思考推断，得出基本结论后再进行修改。测试的时候也要分步进行，确认电路出问题的部分。</p><p>思考后认为是8脚悬空造成的问题，由于升压电感输出如果没有后续电容去存储能量，维持恒定电压，电感充放电电压在pin 8内部直接击穿了芯片。于是我在pin8脚加了两个22uF的电容，问题就解决了。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/picgo/image-20210609123702286.png" alt="image-20210609123702286"></p><p>由于手头的芯片比较紧张，还没有用示波器实测浮空8脚的电压情况。</p><h4 id="MP2451"><a href="#MP2451" class="headerlink" title="MP2451"></a>MP2451</h4><p>本来需求给我的只是要求输出两种不同的电压，并没有对电源纹波有任何要求，于是实际实验中使用该电源板供电，输出波形经过几重算法滤波后还是有很明显的噪声干扰。</p><p>简单研究了一下电路发现，其中的3V端接到某几个模拟信号的输出端，工作电压输入后在3V端出现波动剧烈波形，而在原先接3V干电池的情况下电压可以被稳定。</p><p>于是我需要把原先的开关电源换成一个参数良好的LDO，于是需要对LDO的重要参数有一定的了解。</p><p id="div-border-top-red" align="center">以下正文</p><h2 id="关于线性稳压器-LDO-的选型"><a href="#关于线性稳压器-LDO-的选型" class="headerlink" title="关于线性稳压器(LDO)的选型"></a>关于线性稳压器(LDO)的选型</h2><h3 id="LDO的基本原理"><a href="#LDO的基本原理" class="headerlink" title="LDO的基本原理"></a>LDO的基本原理</h3><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/picgo/image-20210602111328822.png" alt="image-20210602111328822" style="zoom:80%;" /></p><p>LDO是个负反馈系统，Vout增大，运放输出电压增大，PMOS的VGS减小，输出电流减小，输出电压随之减小。</p><p>LDO具有很好的噪声隔离作用，具体指标是PSRR，在一些噪声敏感电路中，AD/DA等必须选择高PSRR的LDO。</p><h4 id="关于线性稳压器的启动"><a href="#关于线性稳压器的启动" class="headerlink" title="关于线性稳压器的启动"></a>关于线性稳压器的启动</h4><h5 id="电流软启动"><a href="#电流软启动" class="headerlink" title="电流软启动"></a>电流软启动</h5><p>第一种方法是电流软启动。大多数稳压器具有电流限值；电流软启动是缓升或步进到该电流限值。由于输出电容充电量远远小于最大负载电流，软启动使得输出电压缓慢上升。电流软启动的优点是稳压器输入电流稳定上升，不会将负载启动的瞬态电流传递到输入。</p><p>使能负载时，大家可能会注意到输出电压斜率突然改变方向的一个点。这是因为负载电路打开并尝试在稳压器处于限流的条件下启动工作。如果负载电流超过软启动电流，负载本身将进入欠压状态，造成复位。随着负载电流的打开和关闭，这种循环会不断持续。最后软启动电流达到足够高的水平，能够支持负载供电，释放复位，负载电路正常唤醒。</p><h5 id="电压软启动"><a href="#电压软启动" class="headerlink" title="电压软启动"></a>电压软启动</h5><p>第二种软启动是缓升输出电压。缓升输出电压会在输出电压上产生单调变化，当下游电路开启时不产生任何电压瞬变。这样也能防止负载多次进入复位状态，因为输出电压仅穿越负载欠压门限一次。</p><p>电压软启动期间的浪涌电流取决于输出电压和输出电压的变化斜率，在加上负载吸收的电流。典型情况下，按照浪涌电流大约为最大额定输出电流的1%至10% (使用推荐的最小输出电容)来设置输出电压斜率。将浪涌电流设置为小于最大负载电流的10%，为负载及任何额外输出电容需要的电流提供了裕量。其缺点是输入电流与负载变化有关，不能直接控制；优点是能够避免系统多次复位。</p><h4 id="静态电流与压差的关系"><a href="#静态电流与压差的关系" class="headerlink" title="静态电流与压差的关系"></a>静态电流与压差的关系</h4><p>输入与输出之间的压差达到很小的状态。此时的线性稳压器，即使负载电流非常小，也会强制FET导通，最大程度地减小输入与输出之间的压降。工作在最低压差时的潜在问题是，驱动稳压器输出FET的栅极驱动电路将消耗较大电流。使得“待机模式”变为“电池快速放电模式”。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/picgo/image-20210602140412631.png" alt="LDO低压差待机"></p><p>即使很好的IC设计，静态电流在最低压差条件下增大的现象也并不罕见。小压差下的电源电流提高2倍很常见，有些设计甚至增大10倍或更多。有些器件在EC表或静态电流与输入电压关系的典型工作特性曲线中给出压差与电源电流的对应关系。但更多情况下，数据手册给出的是叫高压差下的电源电流。</p><p>对于具体应用，如果低压差条件下的静态电流非常重要，应选择提供该信息的LDO，或者进行实际测量，确定性能满足要求。</p><h4 id="负载瞬态响应"><a href="#负载瞬态响应" class="headerlink" title="负载瞬态响应"></a>负载瞬态响应</h4><p>负载快速变化期间，多数稳压器都具备一定的能力使输出保持在稳压范围内。负载变化时，输出FET栅极驱动需要随之变化。而栅极驱动达到新水平所需的时间决定了输出电压的瞬态下冲或过冲。</p><p>满载时的快速瞬变会造成最差情况下的瞬态下冲。选择稳压器之前，须务必检查瞬态响应。与从1%满载作为初始条件相比，从10%满载开始通常会给出更好的结果；因为10%负载预偏置与1%负载预偏置相比，输出FET栅极电压更接近其最终值。负载从空载变为满载，要想获得较好的负载瞬态响应比较困难。</p><p>保证稳压器输出负载最小在一定程度上可以规避大的负载瞬变，但这不是有效的解决方案。当稳压器从满载跃变到轻载时，往往会发生输出过冲。而稳压器从过冲状态恢复的过程中，器件处于比较敏感状态 —— 此时的输出FET完全没有偏置。这种状态下，如果出现另一次负载阶跃，输出则出现下冲，比第一次更为严重。</p><p>如果存在任何快速开启、关断负载的情况，最好在类似条件下检查每个稳压器的负载瞬态响应。(<strong>图3</strong>)所示为双脉冲负载瞬变期间的性能。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/picgo/image-20210602140654847.png" alt="负载瞬态响应"></p><h3 id="功能需求"><a href="#功能需求" class="headerlink" title="功能需求"></a>功能需求</h3><p>使能输入：LDO使能电平高低用于启动或关断LDO。使能输入允许外部控制LDO的关闭和启动，这是多电压轨系统中调整电源上电顺序的一个重要特性。</p><p>软启动：可编程软启动有助于减小启动时的浪涌电流和提供上电顺序。对于启动时要求浪涌电流受控的应用，有些LDO提供了可编程的软启动（SS）功能。为了实现软启动，在SS和地引脚之间需要连接一个小的陶瓷电容。</p><h3 id="选型细节"><a href="#选型细节" class="headerlink" title="选型细节"></a>选型细节</h3><p>输出可调型号LDO，FB电阻需靠近芯片且在电容之后，还需确认规格书对阻值的要求。一般电阻越小抗干扰性越强，但是取样电阻上的损耗会增大，加大电阻可能导致输出电压不稳定。</p><p>LDO输出稳定性：LDO是负反馈系统，Vin和Vout 上的电容值及电容的ESR都会影响系统的稳定性，最主要是ESR。LDO规格书都会列出对输入电容Cin和输出电容Cout及其ESR的要求，一定要严格遵守。LDO的Cin和Cout都会在1uF以上，ESR越低越好，最好低于100mΩ。</p><p>LDO输出端接有其它电压源时需要考虑LDO内部MOS的体二极管，需要选防倒灌的型号。</p><p>自放电功能：LDO关闭后，负载电容上仍然有电量，在下次输出时会因为这个电量产生一个快速Voltage Spike。虽然幅度不高，但是对后级电路具有破坏性。带自放电功能的LDO在关闭输出后，泄放输出电容上的电量。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/picgo/image-20210602140122712.png" alt="电流软启动和电压软启动对比"></p><h3 id="重要参数："><a href="#重要参数：" class="headerlink" title="重要参数："></a>重要参数：</h3><p>PD（Power Disspation，耗散功率）：LDO通过PD可以计算出在常温环境中的最大电流输出能力。</p><ul><li>比如某一LDO输入5V输出3.3V，在25°C环境下PD=0.43，该LDO在常温25°C环境下最大电流输出能力为$0.43/(5-3.3)=253mA$ </li></ul><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/picgo/image-20210602095534551.png" alt="Power Disspation"></p><p>Dropout Voltage（最小压降）</p><p>Quiescent Current（静态电流）：休眠阶段电源消耗成为影响电池寿命的关键因素，想降低睡眠期间的功率消耗，需要选择具有极低静态电流的器件。IQ受温度和输入电压的影响较为明显。</p><p>PSRR（Power Supply Ripple Rejection，电源抑制比）：在射频设计中，对电源纹波极为敏感，需要考虑低噪声LDO，PSRR量化了对不同频率输入电源纹波抑制能力，反映了LDO不受噪声和电压波动，保持输出电压稳定的能力。</p><script type="math/tex; mode=display">PSRR = 20log(\frac{V_{outNoize}}{V_{inNoize}})</script><p>Load Transient Response（负载瞬态响应）：负载电流变化时，输出电压的变化率。与输出端电容值、电容的ESR、LDO控制环路的增益带宽以及负载电流变化的大小和速率有关。LDO是一个负反馈汇率，相位裕量越大，负载瞬态响应越好。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/picgo/image-20210602103150215.png" alt="Load Transient Response"></p><p>Line Transient Response（线路瞬态响应）：当Vin阶跃变化时，Vout的变化情况，输出电压偏差显示了环路带宽和PSRR特性。LTR随负载电流增加而变差，因为LDO的总环路增益不断降低。</p>]]></content>
    
    
    <summary type="html">前段时间帮别人设计了一个简单的充放电小电路板，在LDO选型和电池管理芯片上遇到了一些小问题，现对LDO选型参数做一些深入了解。</summary>
    
    
    
    <category term="EMBEDDED" scheme="http://www.ts1989.cn/categories/EMBEDDED/"/>
    
    
    <category term="HARDWARE" scheme="http://www.ts1989.cn/tags/HARDWARE/"/>
    
  </entry>
  
  <entry>
    <title>晶体管入门</title>
    <link href="http://www.ts1989.cn/2021/01/12/Transistor/"/>
    <id>http://www.ts1989.cn/2021/01/12/Transistor/</id>
    <published>2021-01-11T17:02:12.000Z</published>
    <updated>2021-06-11T09:08:03.647Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/03-big-intel-sandy-bridge.jpg" alt="03-big-intel-sandy-bridge"></p><span id="more"></span><h2 id="PN结简介"><a href="#PN结简介" class="headerlink" title="PN结简介"></a>PN结简介</h2><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210604104425717.png" alt="image-20210604104425717" style="zoom: 80%;" /></p><blockquote><p>在硅、锗、砷化镓等具有共价键的本征半导体材料中，使用特殊工艺（高温扩散、离子注入等）掺杂一定浓度的其它特定原子，在不破坏元半导体共价键的的情况下，使杂质在晶格的某些位置上替代原来材料的原子。因为原晶体共价键结构的存在，以及杂质原子与晶体原子的自有电子数目不相等，那么在形成共价键后，杂质原子就会多出自由电子或者被共价键牵引而缺少自由电子（空穴）。整个材料特性在外接呈电中性，但是因为自由电子以及空穴的存在，电子为多子的成为Negative型半导体，空穴为掺杂材料的称为Positive型半导体。</p><p>将P型半导体和N型半导体进行原子级结合就形成PN结，因P型半导体中的空穴、N型半导体中的电子互相“渗透”会形成接触电场，方向从N到P。所以PN结能够呈现出单向导电性，也由于接触电场的存在，会在结上形成一个固定压降。</p></blockquote><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210604104520795.png" alt="image-20210604104520795" style="zoom:67%;" /></p><p>上图为PN结伏安特性曲线，V1为反向击穿电压，在V1时导通电阻很小，击穿后电流不加以限制容易烧毁二极管，V1的电压他笑可以通过半导体加工工艺来改变。</p><h5 id="反向击穿"><a href="#反向击穿" class="headerlink" title="反向击穿"></a>反向击穿</h5><p>PN结反向击穿分为齐纳击穿和雪崩击穿。</p><p>齐纳击穿：在掺杂浓度较高的条件下，PN结宽度很小，较小的反向电压就可以形成很强的结内反向电场。若电场强度超过 $10^{+6}V/m$ 时，有些共价键上的电子会被电场力拉出，载流子迅速增加。其击穿与电流的关系不大，也就是说电压较稳。</p><p>雪崩击穿：在PN结宽度较宽时，较高的反向结电压还不能产生过强的结内电场，但是由于载流子穿过结的路程比较长，不断被电场加速，将其它价电子撞出了共价键，产生新的电子-空穴对，这些载流子又去撞击其它共价键不断产生链式反应，最后导致PN结反向电流剧烈增加。</p><p>一般对于反压小于4V的称为齐纳击穿，反压大于7V的称为雪崩击穿，两者之间两种模式可能同时存在。只要有外界电流限制，两种模式都不会损坏PN结。</p><h2 id="双极性三极管（Bipolarity-Junction-Transistor）"><a href="#双极性三极管（Bipolarity-Junction-Transistor）" class="headerlink" title="双极性三极管（Bipolarity Junction Transistor）"></a>双极性三极管（Bipolarity Junction Transistor）</h2><h3 id="J-FET常用参数"><a href="#J-FET常用参数" class="headerlink" title="J-FET常用参数"></a>J-FET常用参数</h3><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210604153026568.png" alt="常用参数"></p><p id="div-border-top-red">双极性三极管是否可以互换发射极和集电极</p><p>看似对称设计的双极性三极管其实在制作工艺上是区分发射极和集电极的。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210604115000056.png" alt="基本结构"></p><p>并且【为了优化性能】，BJT的CE掺杂浓度是不同的。CE互换的话beta值会下降很多，是否互换需要看BJT在电路中的作用。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/343a89d9c66a7a25f5b5a91cf32fde4a_720w.jpg" alt="343a89d9c66a7a25f5b5a91cf32fde4a_720w" style="zoom:50%;" /></p><p>何为优化性能？CE掺杂浓度为何不同？</p><p>下图显示了存在于正偏架构的PNP型BJT的电流分量。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/a.jpg" alt="a"></p><p>可以明显看出，从发射机注入的hole电流，将分成两个部分。</p><ul><li>由于base为N掺杂，所以当hole流经base的时候，将会有电子空穴对复合产生，消耗空穴电流。</li><li>电流最终由发射极注入集电极的空穴电流</li></ul><p>同时可以看到从base流向发射极的电子电流，这也是发射极电流的一个来源（总发射极电流 $I_e = 1 + 2 + 5$ ）</p><p>3电流是集电极和base之间PN junction的反偏漏电流，如果制程正常的话数值不会很大。</p><p>现在考虑发射极的情况。发射极电流的组成有两种，包括发射极空穴电流1+2以及发射极电子电流5。我们可以利用突变PN junction假设和junction law，得到以下的近似：<br>Iep = 1+2  ∝ <img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/equation.svg" alt="equation"><br>Ien = 5  ∝<img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/picgo/equation.svg" alt="equation"><br>很显然，为了让“有用”的电流尽量大，也就是让 Iep&gt;&gt;Ien，一个通常的做法就是是的Nd&lt;&lt;Na，也就是说，发射极的掺杂浓度要远高于base才可以实现较高的放大系数。</p><p>实际的BJT掺杂如下所示：</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210604121355272.png" alt="image-20210604121355272"></p><p>可以看到在emitter-base的PN结确实是发射极的掺杂浓度将高于base。同时我们注意到，出于设计上的考量，量产化的BJT的集电极的掺杂浓度一般是比较低的。甚至将低过base。<br>如果如题主所述，将E和C调换使用，其造成的结果就是最终可以利用到的电流量将会大大减少，甚至会使得整个管子失去了放大的特性。</p><blockquote><p>三极管的贝塔值主要取决于基区复合率：NPN管正置时，发射结放”水”，集电结吸“水”，由于集电结面积大且电场强，故吸的快，并且水量巨大，来势汹涌（发射区重掺杂），电子在基区停留时间很短，复合率低，贝塔大。倒置时，集电结放水，发射结吸水，由于违背了设计初衷，一方面水流小且慢（集电区轻掺杂），像快干涸的小溪，另一方面发射结电场弱吸力不够，导致基区电子运动缓慢，复合率高，贝塔小。</p></blockquote><h2 id="场效应晶体管（Field-Effection-Transistor）"><a href="#场效应晶体管（Field-Effection-Transistor）" class="headerlink" title="场效应晶体管（Field Effection Transistor）"></a>场效应晶体管（Field Effection Transistor）</h2><p>晶体管（Transistor）英文里的原意应是跨阻器，是跨越、变阻器这两个词的缩写：</p><blockquote><p>Transistor. This is an abbreviated combination of the words “<a href="https://en.wikipedia.org/wiki/Transconductance">transconductance</a>“ or “transfer”, and “<a href="https://en.wikipedia.org/wiki/Varistor">varistor</a>“. The device logically belongs in the varistor family, and has the transconductance or transfer impedance of a device having gain, so that this combination is descriptive.</p><p>​                                            — Bell Telephone Laboratories — Technical Memorandum (May 28, 1948)</p></blockquote><p>场效应管根据结构的不同分为：结型场效应管（JFET）和绝缘栅型场效应管（JGFET）。在绝缘栅型场效应管中应用最广泛的是MOSFET（Metal Oxide Semiconductor FET，金属-氧化物-半导体场效应管）。此外还有PMOS、NMOS、VMOS功率场效应管，以及刚问世的πMOS场效应管、VMOS功率模块等。</p><h3 id="MOSFET的构造"><a href="#MOSFET的构造" class="headerlink" title="MOSFET的构造"></a>MOSFET的构造</h3><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/09183505451969.png" alt="09183505451969"></p><p>MOSFET的核心是位于中央的MOS电容，左右两侧是它的源极与漏极。源极与漏极的特性必须同为N或P。</p><p>图中NMOS的源极与漏极上标示的「N＋」代表着两方面涵义：（1）N代表掺杂（doped）在源极与漏极区域的杂质极性为N；（2）「＋」代表这个区域为高掺杂浓度区域（heavily doped region），也就是这个区域的电子浓度远高于其他区域。在源极与漏极之间被一个极性相反的区域隔开，也就是所谓的基极（or基体）区域。</p><p>对这个NMOS而言，真正用来作为沟道、让载流子通过的只有MOS电容正下方半导体的表面区域。当一个正电压施加在栅极上，带负电的电子就会被吸引至表面，形成沟道，让N型半导体的多数载流子—电子可以从源极流向漏极。如果这个电压被移除，或是放上一个负电压，那么沟道就无法形成，载流子也无法在源极与漏极之间流动，也就是可以透过栅极的电压控制沟道的开关。</p><p>假设工作的对象换成PMOS，那么源极与漏极为P型、基体则是N型。在PMOS的栅极上施加负电压，则半导体上的空穴会被吸引到表面形成沟道，半导体的多数载流子—空穴则可以从源极流向漏极。假设这个负电压被移除，或是加上正电压，那么沟道无法形成，一样无法让载流子在源极和漏极间流动。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210604154013064.png" alt="image-20210604154013064"></p><h5 id="体二极管"><a href="#体二极管" class="headerlink" title="体二极管"></a>体二极管</h5><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/v2-2e9ac1384904fc89c0e497ca55ff9bfa_720w.png" alt="体二极管在MOS管构造中的体现"></p><p>如图所示，P-Base与Source电极相连。反向电流可以从Source流入P-Base，通过PN结（P-Base/N-Dift）流入Drain。这个PN结就是MOSFET中的Body diode。其作用是导通电感负载传导来的反向电流（ H-bridge，half bridge or many other bridges）。值得注意的是，当P-Base与Source电极相连可以阻止parasitic NPN transistor的形成（N+／P-Base／N-Drift），使MOSFET工作在可控的状态。</p><h4 id="MOSFET的主要参数"><a href="#MOSFET的主要参数" class="headerlink" title="MOSFET的主要参数"></a>MOSFET的主要参数</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210604153328848.png" alt="image-20210604153328848"></p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210604153340451.png" alt="image-20210604153340451"></p><h4 id="使用MOSFET应该考虑的问题"><a href="#使用MOSFET应该考虑的问题" class="headerlink" title="使用MOSFET应该考虑的问题"></a>使用MOSFET应该考虑的问题</h4><ol><li>正确的参数选择和计算</li><li>防静电操作：MOSFET栅源之间距离很短，又绝缘，很少量的电荷就足以将绝缘栅击穿而使mos管损坏。在电路调试、焊接、安装过程中，一定要严格按照防静电程序操作。</li><li>散热：大功率MOSFET需要注意散热问题</li><li>电场干扰：高频应用场合的MOSFET，由于GS间阻抗极高，对电场干扰十分敏感，若使用高频MOSFET作为高频前端放大器，电路一定要设计良好的电场屏蔽结构。</li></ol><h4 id="BJT和FET的区别"><a href="#BJT和FET的区别" class="headerlink" title="BJT和FET的区别"></a>BJT和FET的区别</h4><ol><li>参与导电过程<ul><li>BJT有两种载流子参与导电过程，多子是电子，少子是空穴（以NPN为例）。少子容易受温度影响，热稳定性差。</li><li>FET只有一种载流子参与导电，也称为单极性管，受温度影响较低，热稳定性好</li></ul></li><li>BJT输入输出回路都有电流参与，功耗较大。FET只有一个回路参与导电，功耗较低。<ul><li>三极管属于电流控制器件，有输入电流才会有输出电流； <strong>场效应管</strong>属于电压控制器件，没有输入电流也会有输出电流。</li><li>信号源小电流用场效应管，反之用BJT。</li></ul></li><li>BJT输入阻抗小，FET输入阻抗大</li><li>FET频率特性不如三极管</li><li>FET噪声系数小，适用低噪声放大器的前置</li><li>FET最小可制作纳米级</li></ol><p>扩展：<a href="http://blog.sciencenet.cn/blog-68158-1060065.html">手工制作锗晶体管</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/03-big-intel-sandy-bridge.jpg&quot; alt=&quot;03-big-intel-sandy-bridge&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="EMBEDDED" scheme="http://www.ts1989.cn/categories/EMBEDDED/"/>
    
    
    <category term="HARDWARE" scheme="http://www.ts1989.cn/tags/HARDWARE/"/>
    
  </entry>
  
  <entry>
    <title>运放入门</title>
    <link href="http://www.ts1989.cn/2021/01/11/OPA1/"/>
    <id>http://www.ts1989.cn/2021/01/11/OPA1/</id>
    <published>2021-01-10T16:24:34.000Z</published>
    <updated>2021-06-11T09:59:02.325Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/OPA-20210611163852981-20210611164131694.jpg" alt="OPA"></p><span id="more"></span><h2 id="第一节-基础知识"><a href="#第一节-基础知识" class="headerlink" title="第一节 基础知识"></a>第一节 基础知识</h2><h4 id="什么是OPA？"><a href="#什么是OPA？" class="headerlink" title="什么是OPA？"></a>什么是OPA？</h4><p>OPA，Operational Amplifier，运算放大器。主要有同相输入端、反向输入端和输出端构成。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210610140422005-20210611163853028-20210611164131775.png" alt="image-20210610140422005" style="zoom: 50%;" /></p><p>理想OPA：</p><ul><li>输入阻抗无穷大</li><li>输出阻抗为零</li><li>带宽无穷大</li><li>开环增益无穷大</li><li>没有DC/AC误差</li></ul><h4 id="OPA内部构成"><a href="#OPA内部构成" class="headerlink" title="OPA内部构成"></a>OPA内部构成</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210610142625841-20210611163853120-20210611164131864.png" alt="image-20210610142625841"></p><p>运放常用封装有DFN、CSP等小封装和BT封装形式。</p><h4 id="运放基本作用"><a href="#运放基本作用" class="headerlink" title="运放基本作用"></a>运放基本作用</h4><ul><li>小信号放大</li><li>阻抗匹配</li><li>信号隔离</li><li>滤波（低通滤波、高通滤波、带通滤波）</li><li>驱动</li><li>做小功率电源</li></ul><h4 id="OPA的供电"><a href="#OPA的供电" class="headerlink" title="OPA的供电"></a>OPA的供电</h4><ul><li><p>单电源供电系统使用LDO给OPA供电</p></li><li><p>双电源系统，负压。LDO可选型号较少，一般用电荷泵负压芯片产生，输出务必做好滤波处理。</p></li></ul><p>如果使用DC-DC供电，系统噪声是很难处理的。</p><h4 id="运放分类"><a href="#运放分类" class="headerlink" title="运放分类"></a>运放分类</h4><ul><li>超低功耗运放</li><li>低功耗运放</li><li>高速运放</li><li>高精度运放</li><li>低噪声运放</li><li>差分放大器</li><li>功率放大器</li><li>音频放大器</li><li>仪表放大器</li><li>其它专用放大器</li></ul><h5 id="轨对轨运放："><a href="#轨对轨运放：" class="headerlink" title="轨对轨运放："></a>轨对轨运放：</h5><blockquote><p>所谓轨对轨运放指的是放大器输入和输出电压摆幅非常接近或几乎等于电源电压值。</p><p>轨对轨意思是，可以最大限度的输出信号，接近于电源的电压。</p></blockquote><p>不是所有的rail2rail运放输入和输出都接近电源，有的只是输入、有的只是输出。当然也有输入输出都是rail2rail的，该类运放的最大特点就是可以扩展信号的电压范围，但一般输出电流比较小，在大电流情况下并不能保证rail2rail。</p><p>在低电源电压和单电源电压下可以有宽的输入共模电压范围和输出摆幅。</p><p>轨对轨输入输出的运放，耗电相对来说一般比较小。</p><h4 id="运放常用参数"><a href="#运放常用参数" class="headerlink" title="运放常用参数"></a>运放常用参数</h4><ul><li>输入失调电压（Input Offset Voltage）Vos</li><li>输入失调电压温漂（Offset Voltage Drift）</li><li>输入偏置电流（Input Bias Current）IB</li><li>输入失调电流（Input Offset Current）Ios</li><li>共模电压输入范围（Input Common-Mode Voltage Range）Vcm</li><li>输出特性（Output Characteristics）</li><li>输出电流限制（Short Circuit Limit）</li><li>工作电压范围 VDD</li><li>静态工作电流（Quiescent Current）Iq</li><li>增益带宽积（Gain Bandwidth Product）GBP</li><li>压摆率（Slew Rate）SR</li><li>开环增益（Open-Loop Voltage Gain）Aol</li><li>电压噪声密度（Voltage Noise Density）en</li><li>相位裕度（Phase Margin）</li><li>共模信号抑制比（Common Mode Rejection）</li><li>电源纹波抑制比（Supply Voltage Rejection）</li></ul><h4 id="虚短和虚断"><a href="#虚短和虚断" class="headerlink" title="虚短和虚断"></a>虚短和虚断</h4><blockquote><p>虚短：负反馈环路下，同向输入端与反向输入端电压基本相当。就像短路一样</p><p>虚断：负反馈环路下，通向输入端和反向输入端流入运放内部的电流非常小。就像断路一样。</p></blockquote><p>用万用表测量同向端和反向端电压是没有办法测量运放的，万用表是用电阻分压的方式来测量待测点的电压的，电表流入电阻网络的电流是远远大于pA级的。万用表会成为一个负载，会分掉相当一部分的电压，所以测到同向端和反向端电压是不同的。用万用表测量的时候也引入了相当一部分的干扰，输出信号就偏离更多。</p><p>测量的话可以用示波器，把示波器设置为衰减10倍。衰减10倍之后输入阻抗会比运放的输入阻抗不在一个级别上，这时候可以看到同向端和反向端电压是很近似的。</p><h3 id="运放的选择"><a href="#运放的选择" class="headerlink" title="运放的选择"></a>运放的选择</h3><p>直流信号</p><ul><li>输入失调电压</li><li>温漂</li><li>输入失调电流</li><li>耗电要求</li><li>工作电压</li><li>输入输出特性</li></ul><p>交流信号</p><ul><li>交流信号频率</li><li>增益带宽</li><li>开环增益</li><li>电压噪声密度</li><li>耗电要求</li><li>工作电压</li><li>输入输出特性</li></ul><h4 id="直流"><a href="#直流" class="headerlink" title="直流"></a>直流</h4><h5 id="首先分析信号的特性。"><a href="#首先分析信号的特性。" class="headerlink" title="首先分析信号的特性。"></a>首先分析信号的特性。</h5><ul><li><p>原信号输出，比如直流信号，那么就要考虑原信号的输出阻抗有多大、带载能力有多大。带载能力很小就说明输出阻抗越小，运放的输入阻抗要远高于原信号的输出阻抗。如果他们在同一个级别，那么运放的输入偏置电流对原信号影响会非常明显，那么采集的信号和实际采集信号就像差很远了</p></li><li><p>输入失调电压是叠加在输入信号上的，正负都可能，要考虑对原直流信号的影响。输入失调信号一定要在待处理信号的 1/10 以内。输入失调电压越小，运放价格越贵。                                                                                                                                                                                                                                                                                                                                                                                                                            </p></li></ul><h5 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h5><ul><li>纯电池系统考虑耗电要求</li></ul><h3 id="交流"><a href="#交流" class="headerlink" title="交流"></a>交流</h3><p>首先考虑信号特性</p><ul><li>交流信号的频率、幅值、以及后续的采集电路所要识别的电压，比如计算放大倍数。1mV、1kHz、采集系统识别1V。意味着需要放大1000倍，那么增益带宽积已经在1MHz了。那么选增益带宽积在1MHz的运放差不多可以满足了。但是收到开环增益、压摆率等等的要求，实际上选择运放的时候还需要乘以一个系数。</li></ul><script type="math/tex; mode=display">信号频率 * 放大倍数 * N \le GBP，N=[5,10]，N最小不小于3</script><ul><li>对电压噪声的有要求的电路，比如音频电路。（手机靠近音响的高频噪声，没有音响输入时音响的低频噪声），一定要考虑电压噪声密度。需要选电压噪声密度比较小的运放。</li></ul><p>电源系统</p><ul><li>电池系统电压不高，选运放首选轨对轨输入输出的，要保证输入幅值的动态范围。采用电荷泵的方式产生负压，成本较高。在考虑工作电压，需要考虑低压供电选择轨对轨输入输出的。<br>如果不是轨对轨输入输出，动态范围比较小，比如LM1358，5V供电输入动态范围只到3.5，电压再高的话就会被钳位掉，交流信号的话会被削顶或者削底。</li></ul><h2 id="第二节-运放基本参数（以AD8551为例）"><a href="#第二节-运放基本参数（以AD8551为例）" class="headerlink" title="第二节 运放基本参数（以AD8551为例）"></a>第二节 运放基本参数（以AD8551为例）</h2><p><a href="http://ts1989.oss-cn-shanghai.aliyuncs.com/AD8551_8552_8554.pdf">AD8551.pdf</a></p><h4 id="Input-Offset-Voltage-amp-Drift"><a href="#Input-Offset-Voltage-amp-Drift" class="headerlink" title="Input Offset Voltage &amp; Drift"></a>Input Offset Voltage &amp; Drift</h4><p>输入失调电压Vos及其温漂</p><blockquote><p>将运放两个输入端接地，理想运放输出为0，但是实际运放输出不为0。将输出增益除以增益得到的等效输入电压称为输入失调电压。</p><p>一般定义为：运放输出为零时，两个输入端之间所加的补偿电压。该值反映了运放哪部对称性，对称性越好，输出失调电压越小，运放精度越高，价格也越贵。</p></blockquote><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210610173247624-20210611163853218-20210611164131914.png" alt="image-20210610173247624"></p><p>图中为一定数量的运放在一定温度和某一确定Vcm下芯片漂移个数，整体呈高斯分布，大部分在典型值附近。</p><p>在设计的时候参数以 <strong>全温度下的最大值</strong> 作为考量，因为我们不知道我们的产品工作在什么样的环境。我们用温漂（温度系数）来表示在温度下Vos的变化，作为输入失调低钠呀的补充，便于计算在给定的工作范围内，放大电路由于温度变化造成的输入失调电压漂移大小。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210610173228477-20210611163853270-20210611164131964.png" alt="image-20210610173228477" style="zoom:50%;" /></p><h4 id="Input-Bias-Current-amp-Input-Offset-Current"><a href="#Input-Bias-Current-amp-Input-Offset-Current" class="headerlink" title="Input Bias Current &amp; Input Offset Current"></a>Input Bias Current &amp; Input Offset Current</h4><p>输入偏置电流和输入失调电流</p><blockquote><p>定义为当运放输出的直流电压为零时，运放两输入端流进或流出直流电流的平均值。</p></blockquote><p>影响：对原信号影响，原信号输出电流有一部分进入运放，如果 $I_b$比较大，对原信号影响比较大。$I_b$ 一般受制于工艺，CMOS、FET一般能做到pA级。输入偏置电流对进行高阻信号放大、积分电路等对输入阻抗有要求的地方有较大影响。输入偏置电流与制造工艺有一定关系。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210610172733764-20210611163853320-20210611164132021.png" alt="image-20210610172733764" style="zoom:50%;" /></p><p>Ib 和 Vos 等效示意图，Vos可能为正也可能为负，如果为正值，就是在原信号叠加的值，负值就是在原信号减去一个值。运放其实都是线性的，但是由于Vos存在，在时间轴上就会出现一个偏移。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210610173329614-20210611163853370-20210611164132069.png" alt="image-20210610173329614" style="zoom: 50%;" /></p><p>Ib 受温度影响比较明显，是需要重点考虑的参数。</p><blockquote><p>输入失调电流 Ios：是对Ib的补充，当运放的输出直流电压为0时，其两输入端偏置电流的差值。输入失调电流同样反应了运放内部的电路对称性，对称性越好输入失调电流越小。</p></blockquote><h4 id="Input-Common-Mode-Voltage-Range"><a href="#Input-Common-Mode-Voltage-Range" class="headerlink" title="Input Common-Mode Voltage Range"></a>Input Common-Mode Voltage Range</h4><p>共模电压输入范围Vcm</p><blockquote><p>运放两输入端与地间能加的共模电压的范围。Vcm 包括正、负电源电压时为理想特性。所谓 “Rail to Rail Input” 就是指输入共模电压范围十分接近电源轨。一般可以低于负电源轨，而稍微低于正电源轨。</p></blockquote><h4 id="输出特性"><a href="#输出特性" class="headerlink" title="输出特性"></a>输出特性</h4><p>输出动态范围特性</p><blockquote><p>即输出电压范围，所谓轨对轨输出，即输出Voh、Vol极为接近供电轨，但无法等于供电轨，会有十几mV压差，也与负载有关。</p></blockquote><p>输出电流特性</p><blockquote><p>即运放的带载能力，一般会给出Sink、Source电流大，也有运放只给出短路时的极限电流。</p></blockquote><p>Condition：VS = 2.7 V, VCM = 1.35 V, VO = 1.35 V, TA = 25°C, unless otherwise noted.</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210610175913191-20210611163853418-20210611164132127.png" alt="image-20210610175913191"></p><ul><li>输出高电平，在100k负载下，输出最小电压在2.685，压降很小很小，不同电压下输出高电平向下拉的电压是不一样的。</li><li>输出低电平，在100k负载下，输出最大值在全温度下有10mV的差异。</li><li>短路极限电流 10mA</li><li>输出带载能力在全温度下 5mA（源电流和灌电流），在设计的时候不能指望这个运放能驱动多大的负载或流进多大的电流。</li></ul><h4 id="Slew-Rate"><a href="#Slew-Rate" class="headerlink" title="Slew Rate"></a>Slew Rate</h4><p>压摆率（SR）</p><blockquote><p>即转换速率，其定义为：运放接成闭环条件下，讲一个大信号（含阶跃信号）输入到运放的输入端，从运放输出端测量运放输出上升的速率。</p><p>由于在转换期间，运放输入级处于开关状态，所以运放反馈回路不起作用，也就是转换速率与闭环增益无关。</p></blockquote><p>压摆率越大，对应运放的带宽就越高。压摆率与增益带积大的所谓的高速运放，对应的压摆率也要很快。上升下降沿的时间会牺牲掉相当大部分的频率时间。</p><h4 id="Gain-Bandwidth-Product"><a href="#Gain-Bandwidth-Product" class="headerlink" title="Gain Bandwidth Product"></a>Gain Bandwidth Product</h4><p>增益带宽积（GBP）</p><blockquote><p>单位增益带宽定义为，运放的闭环增益为1倍条件下，将一个恒幅正弦小信号输入到运放的输入端，从运放输出端测得闭环电压增益下降3dB（相当于运放输入信号的0.707）所对应的信号频率。</p></blockquote><p>GBP是在处理交流信号非常关注的一个参数，增益和输入信号频率是相关的，输入信号频率✖️增益受制于GBP这个参数，要远小于GBP。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611100223051-20210611163853479-20210611164132178.png" alt="image-20210611100223051" style="zoom: 50%;" /></p><p>上图的运放在一倍增益下，最大也就只能处理到1MHz了。</p><h4 id="Open-Loop-Voltage-Gain"><a href="#Open-Loop-Voltage-Gain" class="headerlink" title="Open-Loop Voltage Gain"></a>Open-Loop Voltage Gain</h4><p>开环增益（Aol）</p><blockquote><p>定义为当运放工作在线性区时，运放输出电压与差模电压输入电压的比值。</p></blockquote><p>由于差模开环直流电压增益很大，大多数运放差模开环直流电压增益一般在数万倍或更多，用数值直接表示不方便比较，所以一般采用分贝方式记录和比较。</p><p>理想运放开环增益为无穷大，实际运放一般在80dB～150dB。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611101859281-20210611163853528-20210611164132230.png" alt="image-20210611101859281" style="zoom:50%;" /></p><p>开环增益曲线配和增益带宽积，就可以看出把运放增益设置在哪个范围内是安全的。上图给出的是开环增益、相移和频率的一个关系，当增益过大时，信号相位也会往后有一个偏移。一般设置在左上角三角形区域内比较安全。</p><h4 id="Common-Mode-Rejection"><a href="#Common-Mode-Rejection" class="headerlink" title="Common Mode Rejection"></a>Common Mode Rejection</h4><p>共模信号抑制比（CMRR）</p><blockquote><p>共模抑制比定义为当运放工作于线性区时，运放的差模增益和共模增益的比值。即运放两输入端与地之间加相同信号时，输入、输出间的增益称为共模电压增益AVC，则 CMRR = AV/AVC （差模增益/共模增益）。</p></blockquote><p>共模抑制比是一个极为重要的指标，它能够抑制共模输入的干扰信号。值越大，抑制共模干扰能力越强。高精度运放共模信号抑制比很高。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611103248182-20210611163853590-20210611164132275.png" alt="image-20210611103248182" style="zoom:50%;" /></p><p>信号处理频率越高，CMRR越小。所以在高频处理中，需要选用CMRR越大的运放。</p><h4 id="Power-Supply-Voltage-Rejection"><a href="#Power-Supply-Voltage-Rejection" class="headerlink" title="Power Supply Voltage Rejection"></a>Power Supply Voltage Rejection</h4><p>电源纹波抑制比（PSRR）</p><blockquote><p>定义为当运放工作于线性区时，运放输入失调电压随电源电压的变化比值。即正、负电源电压变化时，该变化量出现在运放的输出中，并将其转换为运放输入的值。</p></blockquote><p>若电源变化 $\Delta V<em>s$ 时，等效换算电压为 $\Delta V</em>{in}$ ，则 $PSRR=\frac{\Delta V<em>{s}}{\Delta V</em>{in}}$</p><p>电源电压抑制比反映了电源变化对运放输出的影响。</p><p>但是运放的供电还是要求用LDO提供电源，因为LDO输出相对干净很多，但是运放自身也是有抑制能力的，但是不能指望运放自身的抑制能力去对抗电源的变化。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611104219774-20210611163853640-20210611164132331.png" alt="image-20210611104219774" style="zoom:50%;" /></p><p>由上图可知，运放对抗高频噪声是比较难的。</p><h4 id="Noise-Density"><a href="#Noise-Density" class="headerlink" title="Noise Density"></a>Noise Density</h4><p>噪声密度</p><blockquote><p>运放本身内部电路固有的噪声，分为电压噪声和电流噪声。参数越小，运放自身引入到系统的噪声也越小。</p><p>通常规格书中用 nV/rtHz 和 pA/rtHz 表示。</p></blockquote><p>参数越小，运放自身引入到系统的噪声也越小。1/f噪声，白噪声，目前的机制尚不了解，</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611105444391-20210611163853738-20210611164132428.png" alt="image-20210611105444391" style="zoom:50%;" /></p><p>频率越低，噪声指标越高。在1kHz以上，变化就比较小了，而且相对平稳。</p><h4 id="极限参数"><a href="#极限参数" class="headerlink" title="极限参数"></a>极限参数</h4><ul><li>Supply Voltage</li><li>Input Voltage</li><li>Differential Input Voltage（差模，有些运放厂家不会提供）</li><li>Operating Temperature Range</li><li>Input Current（输入电流很多厂家会不提供，通向反向端可承受电流的极限值，可能会对保护二极管造成损伤，改变运放的参数）</li><li>ESD Susceptibility（静电）</li></ul><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611110302936-20210611163853785-20210611164132485.png" alt="image-20210611110302936" style="zoom:50%;" /></p><h2 id="第三节-基本运放电路"><a href="#第三节-基本运放电路" class="headerlink" title="第三节 基本运放电路"></a>第三节 基本运放电路</h2><h3 id="同向输入放大电路"><a href="#同向输入放大电路" class="headerlink" title="同向输入放大电路"></a>同向输入放大电路</h3><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611142221019-20210611163853924-20210611164132544.png" alt="image-20210611142221019" style="zoom: 50%;" /></p><p>此电路要在双电源供电模式下工作，或者直流信号可单电源供电。在运放内部同向输入端和反向输入端都有一个保护的等效二极管，如果单电源工作模式输入交流信号，同向端输入的交流信号负半周就被削掉了。</p><p>共模电压输入范围参数，不是运放在任何供电下的电压范围，而是与供电电压相关的。比如共模电压输入范围[-5,5]，单电源供电模式，负电源轨就是0，可接受电压范围为[0,VCC]。</p><ul><li>虚短：V+ = V-</li><li>虚断：反馈回路根据基尔霍夫定律列等式</li></ul><script type="math/tex; mode=display">V_-=V_+=V_i</script><script type="math/tex; mode=display">V_-=\frac{R_2}{R_1+R_2}V_o</script><p>由此可得</p><script type="math/tex; mode=display">V_o=(1+\frac{R_1}{R_2})V_i</script><h3 id="反向输入放大电路"><a href="#反向输入放大电路" class="headerlink" title="反向输入放大电路"></a>反向输入放大电路</h3><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611143523584-20210611163853987-20210611164132594.png" alt="image-20210611143523584" style="zoom:50%;" /></p><p>反向输入放大电路就是输出和输入的相位发生180度的变化。</p><ul><li>平衡电阻为同向端提供偏置电流回路，阻值要求不严格</li><li>运放为双电源工作模式或者单电源工作下输入信号为直流信号</li></ul><script type="math/tex; mode=display">V_- = V_+ = 0</script><p>由此可得：</p><script type="math/tex; mode=display">V_o = V_i*(-\frac{R_2}{R_1})</script><h3 id="差分输入放大（减法器）电路"><a href="#差分输入放大（减法器）电路" class="headerlink" title="差分输入放大（减法器）电路"></a>差分输入放大（减法器）电路</h3><p>输入信号通常来自低阻抗源，因为该电路的输 入阻抗由电阻网络决定。通常使用差分放大器来放大差分输入信号并抑制共模电压。共模电压是两个输入共 用的电压。差分放大器抑制共模信号功能的有效性称为共模抑制比 (CMRR)。差分放大器的 CMRR 取决于 电阻器的容差。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611150702788-20210611163854030-20210611164132645.png" alt="image-20210611150702788" style="zoom:50%;" /></p><p>差分输入放大电路对运放的要求比较高，尤其是对共模输入抑制比比较高。因为外围电阻精度如果不匹配的话，那么会影响到CMRR。运用差分输入放大电路时，一定要选择高精度电阻。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611151037559-20210611163854082-20210611164132716.png" alt="image-20210611151037559" style="zoom: 50%;" /></p><h5 id="运用"><a href="#运用" class="headerlink" title="运用"></a>运用</h5><p>音频系统、High-side电流检测电路、芯片信号检测、心率信号检测等</p><p>电流检测集成芯片内部电阻精度可以做到万分之一，而在外面设置的电阻通常是选择1%的。差分放大电路成本较高，在电流检测电路运用比较少，往往选择集成芯片。</p><h3 id="跟随器-射随器"><a href="#跟随器-射随器" class="headerlink" title="跟随器/射随器"></a>跟随器/射随器</h3><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611151228339-20210611163854127-20210611164132765.png" alt="image-20210611151228339" style="zoom:50%;" /></p><ul><li>$R_f$ 对实际应用影响很小，k级电阻，电阻过大的话会引入电阻的热噪声。</li><li>输入端电阻不仅仅是平衡电阻，对运放输入也是一个保护，可以衰减电流，抗浪涌。限制输入电流，防止接入信号瞬间产生的浪涌电流偏大。</li><li>相比同向放大电路，反向端没有对地的电阻了。</li></ul><h3 id="I-V转换电路"><a href="#I-V转换电路" class="headerlink" title="I-V转换电路"></a>I-V转换电路</h3><p>光敏二极管在光照会产生微弱的电流，计算这个电流有两种做法：</p><ul><li>在二极管输出之后挂一个对地电阻，把电流转换成电压。但是劣势很明显，在电阻阻值的选择上，小电阻输出电流带不动，而电阻大的时候，引入的噪声也特别大。</li></ul><p>所以一般在处理光敏二极管，用一个运放做I-V转换，靠反馈回路的 $R_F$ 电阻，把电流转换成电压输出。</p><p>这里对运放也是有要求的：</p><ul><li><p>$V_{OS}$ 会叠加在输出上，要小</p></li><li><p>$I_B$ 会叠加在输出上，要小</p></li></ul><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611153503411-20210611163854182-20210611164132836.png" alt="image-20210611153503411" style="zoom:50%;" /></p><ul><li>运放的输入偏置电流 $I<em>B$ 和输入失调电压 $V</em>{os}$ 对输出电压的影响分别为：$I<em>B*R_F$ 和 $V</em>{os}*(1+\frac{R_F}{R_S})$，$R_S$ 为光敏管内阻。</li><li>故需要选择偏置电流和失调电压均很低的运算放大器。</li><li>可以单电源供电，输出为正值。</li><li>电容起滤波和稳定运放（相位补偿）的作用。</li></ul><h3 id="同相加法电路（求和电路）"><a href="#同相加法电路（求和电路）" class="headerlink" title="同相加法电路（求和电路）"></a>同相加法电路（求和电路）</h3><p>应用：多路音源的叠加</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611154533423-20210611163854241-20210611164132937.png" alt="image-20210611154533423" style="zoom:50%;" /></p><p>做加法电路的时候很少会引入增益。</p><h3 id="反相加法电路"><a href="#反相加法电路" class="headerlink" title="反相加法电路"></a>反相加法电路</h3><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611160226057-20210611163854302-20210611164132986.png" alt="image-20210611160226057" style="zoom:50%;" /></p><h3 id="一阶低通滤波电路"><a href="#一阶低通滤波电路" class="headerlink" title="一阶低通滤波电路"></a>一阶低通滤波电路</h3><ul><li>-3dB截止频率都是 $\frac{1}{2\Pi RC}$ </li><li>同相输入电路可以同时加入放大</li><li>反向输入电路有争议，大部分时候会把 $C_F$ 当作相位补偿电容，防止运放震荡。<ul><li>运放的输入电容、分布电容都会导致相位的滞后，当相位滞后达到一定程度时，就会导致输出的是一个震荡的信号。所以加入一个反馈补偿电容的方式，来破环震荡条件。</li></ul></li></ul><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611160332384-20210611163854379-20210611164133042.png" alt="image-20210611160332384" style="zoom:67%;" /></p><p>很多高阶滤波电路的电阻选择都是非标值，比较复杂，不利于生产。</p><h4 id="二阶低通滤波"><a href="#二阶低通滤波" class="headerlink" title="二阶低通滤波"></a>二阶低通滤波</h4><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611161240894-20210611163854431-20210611164133107.png" alt="image-20210611161240894" style="zoom: 50%;" /></p><p>压控电压源电路和无线增益多路反馈电路。建议用网络提供的工具来直接计算</p><h3 id="一阶高通滤波电路"><a href="#一阶高通滤波电路" class="headerlink" title="一阶高通滤波电路"></a>一阶高通滤波电路</h3><p>把电容和电阻位置对掉一下。</p><p><img src="https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/image-20210611161455695-20210611163854521-20210611164133232.png" alt="image-20210611161455695" style="zoom:50%;" /></p><p>低阶滤通转折很平缓，和理想的滤通还是有差距的。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://ts1989ed.oss-cn-shenzhen.aliyuncs.com/uPic/OPA-20210611163852981-20210611164131694.jpg&quot; alt=&quot;OPA&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="EMBEDDED" scheme="http://www.ts1989.cn/categories/EMBEDDED/"/>
    
    
    <category term="HARDWARE" scheme="http://www.ts1989.cn/tags/HARDWARE/"/>
    
  </entry>
  
  <entry>
    <title>Linux思维导图整理复习总结</title>
    <link href="http://www.ts1989.cn/2019/09/02/Linux_xmind/"/>
    <id>http://www.ts1989.cn/2019/09/02/Linux_xmind/</id>
    <published>2019-09-01T20:21:23.000Z</published>
    <updated>2019-11-04T13:34:19.636Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-09-03%2F1567491964.png" alt=""></p><span id="more"></span><p>思维导图工具——MindNode</p><h2 id="学习结构"><a href="#学习结构" class="headerlink" title="学习结构"></a>学习结构</h2><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/Picture/learningplan.png" alt=""></p><h2 id="Linux文件、目录、和磁盘格式"><a href="#Linux文件、目录、和磁盘格式" class="headerlink" title="Linux文件、目录、和磁盘格式"></a>Linux文件、目录、和磁盘格式</h2><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/Picture/filecategory.png" alt=""></p><h2 id="Shell与Shell-Script"><a href="#Shell与Shell-Script" class="headerlink" title="Shell与Shell Script"></a>Shell与Shell Script</h2><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/Picture/shell%26script.png" alt=""></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-09-03%2F1567491964.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="Linux" scheme="http://www.ts1989.cn/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Daenerys Targaryen - The Queen</title>
    <link href="http://www.ts1989.cn/2019/08/29/Daenerys-Targaryen/"/>
    <id>http://www.ts1989.cn/2019/08/29/Daenerys-Targaryen/</id>
    <published>2019-08-28T16:52:30.000Z</published>
    <updated>2021-05-21T08:09:26.372Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div id="dplayer1" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer1"),"video":{"url":"http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/Daenerys1.mp4","pic":"http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-28%2F1566927552.png"},"danmaku":{"id":"Khaleesi","api":"https://dplayer.moerats.com/"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script><span id="more"></span>]]></content>
    
    
    <summary type="html">She&#39;s a girl who walked into a fire with three stones, and walked out with three dragons. How could she not believe in destiny?</summary>
    
    
    
    <category term="Video" scheme="http://www.ts1989.cn/categories/Video/"/>
    
    
    <category term="Share" scheme="http://www.ts1989.cn/tags/Share/"/>
    
    <category term="Inspirational" scheme="http://www.ts1989.cn/tags/Inspirational/"/>
    
  </entry>
  
  <entry>
    <title>数据分析中的MySQL</title>
    <link href="http://www.ts1989.cn/2019/08/21/MySQL-dataanalysis/"/>
    <id>http://www.ts1989.cn/2019/08/21/MySQL-dataanalysis/</id>
    <published>2019-08-20T21:07:04.000Z</published>
    <updated>2019-08-26T13:10:06.154Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566824966.png" alt=""></p><span id="more"></span><h2 id="MySQL简单总结"><a href="#MySQL简单总结" class="headerlink" title="MySQL简单总结"></a>MySQL简单总结</h2><h3 id="条件查找"><a href="#条件查找" class="headerlink" title="条件查找"></a>条件查找</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select * from dataAnalyst</span><br><span class="line">where (city = &#x27;上海&#x27;</span><br><span class="line">and education = &#x27;本科&#x27;)</span><br><span class="line">or </span><br><span class="line">(city = &#x27;北京&#x27;</span><br><span class="line">and education = &#x27;硕士&#x27;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select * from dataAnalyst</span><br><span class="line">where (city = &#x27;上海&#x27;</span><br><span class="line">and education = &#x27;本科&#x27;)</span><br><span class="line">or workYear = &#x27;1-3年&#x27;</span><br><span class="line"># 翻译：上海和本科同时满足，或者只满足workyear</span><br><span class="line"></span><br><span class="line">select * from dataAnalyst</span><br><span class="line">where city = &#x27;上海&#x27;</span><br><span class="line">and (education = &#x27;本科&#x27;</span><br><span class="line">or workYear = &#x27;1-3年&#x27;)</span><br><span class="line"># 翻译：上海的，学历或者工作经验满足</span><br></pre></td></tr></table></figure><h5 id="模糊查找"><a href="#模糊查找" class="headerlink" title="模糊查找"></a>模糊查找</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> dataAnalyst</span><br><span class="line">where</span><br><span class="line">secondType like <span class="string">&#x27;%开发%&#x27;</span></span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> dataAnalyst</span><br><span class="line">where</span><br><span class="line">secondType like <span class="string">&#x27;后端%&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Groupby"><a href="#Groupby" class="headerlink" title="Groupby"></a>Groupby</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select city from dataAnalyst</span><br><span class="line">group by city</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select city,count(positionId) from dataAnalyst</span><br><span class="line">group by city</span><br><span class="line"> # count(positionId) = count(1) = count(*)</span><br><span class="line"> # 对于包不包含控制计算有细微差异</span><br><span class="line">select city,count(1),count(*) from dataAnalyst</span><br><span class="line">group by city</span><br></pre></td></tr></table></figure><h5 id="去重复——DISTINCT"><a href="#去重复——DISTINCT" class="headerlink" title="去重复——DISTINCT"></a>去重复——DISTINCT</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select city,count(positionId),count(distinct companyId) from dataAnalyst</span><br><span class="line">group by city</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select city,education,count(1) from dataAnalyst</span><br><span class="line">group by city,education</span><br></pre></td></tr></table></figure><h5 id="Having"><a href="#Having" class="headerlink" title="Having"></a>Having</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># having 就是对groupby进行过滤的</span><br><span class="line">select city,education,count(1) from dataAnalyst</span><br><span class="line">group by city,education</span><br><span class="line">having count(positionId) &gt;= 100</span><br></pre></td></tr></table></figure><h5 id="Like"><a href="#Like" class="headerlink" title="Like"></a>Like</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 获取字段含有“电子商务”的用like</span><br><span class="line">select city,count(1) from dataAnalyst</span><br><span class="line">where industryField like &#x27;%电子商务%&#x27;</span><br><span class="line">group by city</span><br><span class="line">having count(positionId) &gt;= 50</span><br></pre></td></tr></table></figure><h5 id="count-if"><a href="#count-if" class="headerlink" title="count if"></a>count if</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 这里只输出城市（嵌套查询）</span><br><span class="line">select city from dataAnalyst</span><br><span class="line">group by city</span><br><span class="line">having count(if(industryField like &#x27;%电子商务%&#x27;,1,null)) &gt;= 50</span><br></pre></td></tr></table></figure><p><strong>不同城市下面电商占这个城市的招聘人数的占比并过滤大于10</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select city,count(1),</span><br><span class="line">count(if(industryField like &#x27;%电子商务%&#x27;,industryField,null)),</span><br><span class="line">count(if(industryField like &#x27;%电子商务%&#x27;,industryField,null))/count(1)</span><br><span class="line">from dataAnalyst</span><br><span class="line">GROUP BY city</span><br><span class="line">having count(if(industryField like &#x27;%电子商务%&#x27;,industryField,null)) &gt;= 10</span><br><span class="line">ORDER BY count(if(industryField like &#x27;%电子商务%&#x27;,industryField,null))</span><br></pre></td></tr></table></figure><p>优雅的写法——As</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select city,count(1),</span><br><span class="line">count(if(industryField like &#x27;%电子商务%&#x27;,industryField,null)) as emarket,</span><br><span class="line">count(if(industryField like &#x27;%电子商务%&#x27;,industryField,null))/count(1)</span><br><span class="line">from dataAnalyst</span><br><span class="line">GROUP BY city </span><br><span class="line">having emarket &gt;= 10</span><br><span class="line">ORDER BY emarket desc</span><br></pre></td></tr></table></figure><h3 id="SQL函数"><a href="#SQL函数" class="headerlink" title="SQL函数"></a>SQL函数</h3><h5 id="left和locate和right"><a href="#left和locate和right" class="headerlink" title="left和locate和right"></a>left和locate和right</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select left(salary,locate(&#x27;k&#x27;,salary)-1),salary from dataAnalyst</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-25%2F1566740102.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">left(salary,locate(&#x27;k&#x27;,salary)-1),</span><br><span class="line">locate(&#x27;-&#x27;,salary),</span><br><span class="line">length(salary),</span><br><span class="line">left(RIGHT(salary,length(salary)-locate(&#x27;-&#x27;,salary)),length(salary)-locate(&#x27;-&#x27;,salary)-1),</span><br><span class="line">salary</span><br><span class="line">salary from dataAnalyst</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566784918.png" alt=""></p><h5 id="substr"><a href="#substr" class="headerlink" title="substr"></a>substr</h5><blockquote><p>substr(字符串，从哪里开始，截取长度)</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">left(salary,locate(&#x27;k&#x27;,salary)-1),</span><br><span class="line">substr(salary,locate(&#x27;-&#x27;,salary)+1,length(salary)-locate(&#x27;-&#x27;,salary)-1),</span><br><span class="line">salary from dataAnalyst</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566785617.png" alt=""></p><h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><blockquote><p>基于查询结果的查询，嵌套查询</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select (bottom + top)/2 from(</span><br><span class="line">select </span><br><span class="line">left(salary,locate(&#x27;k&#x27;,salary)-1) as bottom,</span><br><span class="line">substr(salary,locate(&#x27;-&#x27;,salary)+1,length(salary)-locate(&#x27;-&#x27;,salary)-1) as top,</span><br><span class="line">salary </span><br><span class="line">from dataAnalyst) as t</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566785931.png" alt=""></p><h5 id="分组——case-when"><a href="#分组——case-when" class="headerlink" title="分组——case when"></a>分组——case when</h5><blockquote><p>主要用来数据清洗</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">case </span><br><span class="line">when (bottom+top)/2 &lt;= 10 then &#x27;0-10&#x27;</span><br><span class="line">when (bottom+top)/2 between 10 and 20 then &#x27;10-20&#x27;</span><br><span class="line">when (bottom+top)/2 &lt;= 30 then &#x27;10-30&#x27;</span><br><span class="line">else &#x27;30+&#x27;</span><br><span class="line">end,</span><br><span class="line">salary from(</span><br><span class="line">select </span><br><span class="line">left(salary,locate(&#x27;k&#x27;,salary)-1) as bottom,</span><br><span class="line">substr(salary,locate(&#x27;-&#x27;,salary)+1,length(salary)-locate(&#x27;-&#x27;,salary)-1) as top,</span><br><span class="line">salary </span><br><span class="line">from dataAnalyst) as t</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566786165.png" alt=""></p><h5 id="过滤——where-in"><a href="#过滤——where-in" class="headerlink" title="过滤——where in"></a>过滤——where in</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from dataAnalyst</span><br><span class="line">where city in(</span><br><span class="line">select city from dataAnalyst</span><br><span class="line">group by city having count(positionId) &gt;= 100)</span><br></pre></td></tr></table></figure><h3 id="多表聚合查询——Join"><a href="#多表聚合查询——Join" class="headerlink" title="多表聚合查询——Join"></a>多表聚合查询——Join</h3><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566789886.png" alt=""></p><p><strong>某一个公司招聘职位，在另一个表中查找信息</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from dataAnalyst</span><br><span class="line">where companyId = (</span><br><span class="line">select companyId from company</span><br><span class="line">where companyShortName = &#x27;唯医网&#x27;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="连结两张表"><a href="#连结两张表" class="headerlink" title="连结两张表"></a>连结两张表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select * from dataAnalyst❌</span><br><span class="line">join company on companyId = companyId ❌</span><br><span class="line"># 没结果，因为companyId不唯一</span><br><span class="line"></span><br><span class="line">#正确写法</span><br><span class="line">select * from dataAnalyst as d</span><br><span class="line">join company as c on d.companyId = c.companyId</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566790201.png" alt="各种Join"></p><h5 id="左连接"><a href="#左连接" class="headerlink" title="左连接"></a>左连接</h5><blockquote><p>保留左边，右边硬凑，没有就null</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from dataAnalyst as d</span><br><span class="line">left join(select * from company</span><br><span class="line">where companySize = &#x27;150-500人&#x27;) as t</span><br><span class="line">on t.companyId = d.companyId</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566790514.png" alt=""></p><p><code>join</code>就是取交集，<code>left join</code>就是A是全部B是部分</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 排除法统计</span><br><span class="line">select * from dataAnalyst as d</span><br><span class="line">left join(select * from company</span><br><span class="line">where companySize = &#x27;150-500人&#x27;) as t</span><br><span class="line">on t.companyId = d.companyId</span><br><span class="line">where t.companyId is null  # 过滤重复的部分</span><br></pre></td></tr></table></figure><p>150-500人的占比</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select count(1),count(t.companyId),count(t.companyId)/count(1) from dataAnalyst as d</span><br><span class="line">left join(select * from company</span><br><span class="line">where companySize = &#x27;150-500人&#x27;) as t</span><br><span class="line">on t.companyId = d.companyId</span><br></pre></td></tr></table></figure><h3 id="LeetCode——训练刷题"><a href="#LeetCode——训练刷题" class="headerlink" title="LeetCode——训练刷题"></a>LeetCode——训练刷题</h3><h3 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select now()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">paidTime,date(paidTime),date_format(paidTime,&#x27;%Y-%m-%d&#x27;),</span><br><span class="line">date_format(date_add(paidTime,interval -1 day),&#x27;%Y-%m-%d&#x27;)</span><br><span class="line">from orderinfo</span><br></pre></td></tr></table></figure><h2 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h2><blockquote><p>统计不同月份的下单人数<br>统计用户三月份的回购率和复购率<br>统计男女用户的消费频次是否有差异<br>统计多次消费的用户，第一次和最后一次消费间隔是多少?<br>统计不同年龄段，用户的消费金额是否有差异?<br>统计消费的二八法则，消费的top20%用户，贡献了多少额度</p></blockquote><h4 id="统计不同月份的下单人数"><a href="#统计不同月份的下单人数" class="headerlink" title="统计不同月份的下单人数"></a>统计不同月份的下单人数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select month(paidTime),count(distinct userId)</span><br><span class="line">from orderinfo</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">GROUP BY month(paidTime)</span><br></pre></td></tr></table></figure><h4 id="统计用户三月份的回购率和复购率"><a href="#统计用户三月份的回购率和复购率" class="headerlink" title="统计用户三月份的回购率和复购率"></a>统计用户三月份的回购率和复购率</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 统计用户三月份的复购率</span><br><span class="line">select count(ct),count(if(ct&gt;1,1,null)),count(if(ct&gt;1,1,null))/count(ct) from(</span><br><span class="line">select userId,count(userId) as ct from orderinfo</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">and month(paidTime) = 3</span><br><span class="line">group by userId) as t</span><br></pre></td></tr></table></figure><p>不是很好的方法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 统计用户三月份的回购率</span><br><span class="line">SELECT count(DISTINCT userId) from orderinfo</span><br><span class="line">where userId in (</span><br><span class="line">select userId from orderinfo</span><br><span class="line">  where isPaid = &#x27;已支付&#x27;</span><br><span class="line">and month(paidTime) = 3)</span><br><span class="line">and month(paidTime) = 4</span><br><span class="line"></span><br><span class="line">select count(DISTINCT userId) from orderinfo</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">and month(paidTime) = 3</span><br></pre></td></tr></table></figure><p>首先查找出userId在每个月份的支付情况</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select userId,date_format(paidTime,&#x27;%Y-%m&#x27;) as m from orderinfo</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">GROUP BY userId,date_format(paidTime,&#x27;%Y-%m&#x27;)</span><br></pre></td></tr></table></figure><p>然后左连接两张相同的表：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select * from(</span><br><span class="line">select userId,date_format(paidTime,&#x27;%Y-%m&#x27;) as m from orderinfo</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">GROUP BY userId,date_format(paidTime,&#x27;%Y-%m&#x27;)) t1</span><br><span class="line">left join(</span><br><span class="line">select userId,date_format(paidTime,&#x27;%Y-%m&#x27;) as m from orderinfo</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">GROUP BY userId,date_format(paidTime,&#x27;%Y-%m&#x27;)) t2</span><br><span class="line">on t1.userId = t2.userId</span><br></pre></td></tr></table></figure><p>此时得到的是两张表的笛卡尔积（<strong>左连接非唯一字段，是局部笛卡尔积。</strong>）</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566815588.png" alt=""></p><p>然后增加条件筛选，此时添加了非唯一条件，笛卡尔积自动去除</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">可以统计所有的月份：</span><br><span class="line">select t1.m,count(t1.m),count(t2.m),count(t2.m)/count(t1.m) from(</span><br><span class="line">select userId,date_format(paidTime,&#x27;%Y-%m-01&#x27;) as m from orderinfo</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">GROUP BY userId,date_format(paidTime,&#x27;%Y-%m-01&#x27;)) t1</span><br><span class="line">left join(</span><br><span class="line">select userId,date_format(paidTime,&#x27;%Y-%m-01&#x27;) as m from orderinfo</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">GROUP BY userId,date_format(paidTime,&#x27;%Y-%m-01&#x27;)) t2</span><br><span class="line">on t1.userId = t2.userId and t1.m = date_sub(t2.m,interval 1 month)</span><br><span class="line">GROUP BY t1.m</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566816321.png" alt=""></p><h4 id="统计男女用户的消费频次是否有差异"><a href="#统计男女用户的消费频次是否有差异" class="headerlink" title="统计男女用户的消费频次是否有差异"></a>统计男女用户的消费频次是否有差异</h4><h5 id="平均数"><a href="#平均数" class="headerlink" title="平均数"></a>平均数</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select sex,avg(ct) from (</span><br><span class="line">select o.userId,sex,count(1) as ct from orderinfo as o</span><br><span class="line">inner join(</span><br><span class="line">select * from userinfo </span><br><span class="line">where sex is not null) t</span><br><span class="line">on o.userId = t.userId</span><br><span class="line">group by userId,sex) t2</span><br><span class="line">group by sex</span><br></pre></td></tr></table></figure><h4 id="统计多次消费的用户，第一次和最后一次消费间隔是多少"><a href="#统计多次消费的用户，第一次和最后一次消费间隔是多少" class="headerlink" title="统计多次消费的用户，第一次和最后一次消费间隔是多少?"></a>统计多次消费的用户，第一次和最后一次消费间隔是多少?</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select userId,datediff(max(paidTime),min(paidTime)) from orderinfo</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">group by userId having count(1) &gt; 1</span><br><span class="line"># datediff把秒数变成天数</span><br></pre></td></tr></table></figure><h4 id="统计不同年龄段，用户的消费金额是否有差异"><a href="#统计不同年龄段，用户的消费金额是否有差异" class="headerlink" title="统计不同年龄段，用户的消费金额是否有差异?"></a>统计不同年龄段，用户的消费金额是否有差异?</h4><p>年龄除10然后取整数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select o.userId,age,count(o.userId) from orderinfo o</span><br><span class="line">inner join(</span><br><span class="line">select userId,ceil((year(now())-year(birth))/10) as age from userinfo</span><br><span class="line">where birth &gt; &#x27;1900-00-00&#x27;)t</span><br><span class="line">on o.userId = t.userId</span><br><span class="line">group by o.userId,age</span><br></pre></td></tr></table></figure><p>平均数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select age,avg(ct) from (</span><br><span class="line">select o.userId,age,count(o.userId) as ct from orderinfo o</span><br><span class="line">inner join(</span><br><span class="line">select userId,ceil((year(now())-year(birth))/10) as age from userinfo</span><br><span class="line">where birth &gt; &#x27;1900-00-00&#x27;)t</span><br><span class="line">on o.userId = t.userId</span><br><span class="line">group by o.userId,age)t2</span><br><span class="line">group by age</span><br></pre></td></tr></table></figure><h4 id="统计消费的二八法则，消费的top20-用户，贡献了多少额度"><a href="#统计消费的二八法则，消费的top20-用户，贡献了多少额度" class="headerlink" title="统计消费的二八法则，消费的top20%用户，贡献了多少额度"></a>统计消费的二八法则，消费的top20%用户，贡献了多少额度</h4><p><strong>先统计总人数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select count(userId)*0.2 from(</span><br><span class="line">select userId,sum(price) as total from orderinfo o</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">group by userId</span><br><span class="line">order by total desc)as t</span><br></pre></td></tr></table></figure><p><strong>统计贡献</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select count(userId),sum(total) from(</span><br><span class="line">select userId,sum(price) as total from orderinfo o</span><br><span class="line">where isPaid = &#x27;已支付&#x27;</span><br><span class="line">group by userId</span><br><span class="line">order by total desc</span><br><span class="line">limit 17000)t</span><br></pre></td></tr></table></figure><p>SQL连接PowerBI</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-26%2F1566824966.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Notes" scheme="http://www.ts1989.cn/categories/Notes/"/>
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="MySQL" scheme="http://www.ts1989.cn/tags/MySQL/"/>
    
    <category term="Data Analysis" scheme="http://www.ts1989.cn/tags/Data-Analysis/"/>
    
  </entry>
  
  <entry>
    <title>一天入门数据分析</title>
    <link href="http://www.ts1989.cn/2019/08/20/introduction-to-data-analysis/"/>
    <id>http://www.ts1989.cn/2019/08/20/introduction-to-data-analysis/</id>
    <published>2019-08-19T16:41:21.000Z</published>
    <updated>2019-08-19T09:40:53.213Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566204364.png" alt=""></p><span id="more"></span><h2 id="一、数据分析框架——15分钟"><a href="#一、数据分析框架——15分钟" class="headerlink" title="一、数据分析框架——15分钟"></a>一、数据分析框架——15分钟</h2><h4 id="七门课程"><a href="#七门课程" class="headerlink" title="七门课程"></a>七门课程</h4><ol><li>数据思维</li><li>业务知识</li><li>Excel</li><li>数据可视化</li><li>SQL</li><li>统计学</li><li>Python</li></ol><ul><li>分析师既可以用Excel完成一份最基础的数据报告，也能用Python深入挖掘</li><li>真正决定数据分析师上限的是<strong>能力</strong>，而不是工具</li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566117893.png" alt="数据分析技能框架"></p><p>数据分析是解决问题的，锻炼出解决问题的思路框架，奠定能力发展的基础</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566105315.png" alt="能力权重"></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566105344.png" alt="学习方法"></p><h2 id="二、数据分析思维——2小时"><a href="#二、数据分析思维——2小时" class="headerlink" title="二、数据分析思维——2小时"></a>二、数据分析思维——2小时</h2><h3 id="1-三种核心思维"><a href="#1-三种核心思维" class="headerlink" title="1. 三种核心思维"></a>1. 三种核心思维</h3><ol><li>结构化</li><li>公式化</li><li>业务化</li></ol><h4 id="结构化思维"><a href="#结构化思维" class="headerlink" title="结构化思维"></a>结构化思维</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566105612.png" alt=""></p><blockquote><p>现在有一个线下销售的产品。我们发现8月的销售额度下降，和去年同比下降了20%。我想先观察时间趋势下的波劢，看是突然暴跌，还是逐渐下降。再按照丌同地区的数据看一下差异，有没有地区性的因素影响。我也准备问几个销售员，看一下现在的市场环境怎么样，听说有几家竞争对手也缩水了，看一下是丌是这个原因。顾客访谈也要做，但是往常一直找丌出原因，这次我也丌抱希望，姑且试试吧。要是还找丌出原因，那我也很绝望.</p></blockquote><p>思维的缺陷：</p><ul><li>想到一点是一点</li><li>做假设，但乱打一枪</li><li>一次性分析，没有复用性</li><li>业务看了会流泪，老板看了想打人</li><li>还是没结果</li></ul><p>将分析思维结构化 </p><ul><li>将论点归纳和整理</li><li>将论点递迚和拆解</li><li>将论点完善和补充</li></ul><p>结构化思维：</p><ol><li><strong>核心论点</strong>：可以是假设、是问题、是预测、是原因</li><li><strong>结构拆解</strong>：自上而下，将核心论点层层拆解成分论点，上下之间呈因果或者依赖关系</li><li><strong>MECE</strong>：相互独立、完全穷尽。论点之间避免交叉和重复，分论点尽量完善</li><li><strong>验证</strong>：论点可量化——用数据说话——可验证性</li></ol><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566105978.png" alt=""></p><p><strong>思维导图式的思维方式</strong></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566106595.png" alt="分析问题案例"></p><ul><li>查看资料及背景，将结论列成一张表/卡片</li><li>把表上的结论，依据主题分类</li><li>将同一类型的结论，按顺序区分</li><li>讨论同一级别的共通结论，将其结论放在上一段位置</li></ul><h4 id="公式化"><a href="#公式化" class="headerlink" title="公式化"></a>公式化</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566107042.png" alt="什么是公式化思维？"></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566107122.png" alt="结构化案例"></p><h4 id="业务化"><a href="#业务化" class="headerlink" title="业务化"></a>业务化</h4><h5 id="如何预估上海地区共享单车投放量？"><a href="#如何预估上海地区共享单车投放量？" class="headerlink" title="如何预估上海地区共享单车投放量？"></a>如何预估上海地区共享单车投放量？</h5><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566107532.png" alt=""></p><p>单车是有<strong>损耗</strong>的，计算公式中应该考虑单车的消耗因素</p><p>结构化+公式化——<strong>理性思考</strong></p><p>业务化——<strong>感性分析</strong></p><ul><li>有没有从业务方的角度思考？</li><li>真的分析出原因了吗？</li><li>能不能将分析结果落地？</li></ul><p>用<strong>结构化思考+公式化</strong>拆解，获得的最终分析论点。很多时候，是现象。数据是某个结果的体现，但<strong>不代表原因</strong>。</p><p><strong>换位思考</strong>也是业务化重要思维。</p><h3 id="2-数据分析的思维技巧"><a href="#2-数据分析的思维技巧" class="headerlink" title="2. 数据分析的思维技巧"></a>2. 数据分析的思维技巧</h3><h4 id="七种方法"><a href="#七种方法" class="headerlink" title="七种方法"></a>七种方法</h4><ol><li>象限法</li><li>假设法</li><li>对比法</li><li>二八法</li><li>指数法</li><li>多维法</li><li>漏斗法</li></ol><h4 id="象限法"><a href="#象限法" class="headerlink" title="象限法"></a>象限法</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566111123.png" alt=""></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566111142.png" alt=""></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566111157.png" alt=""></p><p>核心：象限法是一种策略驱动的思维</p><p>应用：适用范围广、戓略分析、产品分析、市场分析、客户管理、用户管理、商品管理等</p><p>优点：直观，清晰，对数据迚行人工的划分。划分结果可以直接应用于策略</p><p>须知：象限法划分可以按中位数，也可以按平均数，或者经验</p><h4 id="多维法"><a href="#多维法" class="headerlink" title="多维法"></a>多维法</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566111314.png" alt=""></p><p>用户统计维度:性别、年龄…<br>用户行为维度:注册用户、用户偏好、用户兴趣、用户流失…<br>消费维度:消费金额、消费频率、消费水平…<br>商品维度:商品品类、商品品牌、商品属性…</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566111425.png" alt="辛普森悖论"></p><p><img src="/Users/biandudu/Library/Application Support/typora-user-images/image-20190818145744471.png" alt="image-20190818145744471"></p><h4 id="假设法"><a href="#假设法" class="headerlink" title="假设法"></a>假设法</h4><blockquote><p>没数据的时候怎么分析</p></blockquote><p>很多时候，数据分析是没有数据可明确参考的:比如新迚入一个市场，公司开拓某样产品。老板让你预测一年后的销量，戒者产品的数据基础非常糟糕，你拿丌到数据。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566111895.png" alt=""></p><p>核心：假设法是一种启发思考驱动的思维</p><p>应用：它更多的是一种思考方式，假设——验证——判断</p><p>优点：当没有直观数据或者线索分析时，以假设先行的方式进行推断，这是一个论证的过程。</p><p>须知：不知可以假设前提，也能假设概率或者比例，一切都能假设，只要能自圆其说。</p><h4 id="指数法"><a href="#指数法" class="headerlink" title="指数法"></a>指数法</h4><blockquote><p>中国今年的经济指标如何?<br>美国NBA最佳球星是谁?<br>竞争对手产品表现的如何?<br>哪位是天善学院最帅的男人?</p></blockquote><p>NBA比赛数据贡献值: </p><p>(得分+篮板+劣攻+抢断+封盖)-(出手次数-命中次数)-(罚球次数- 罚球命中次数)-(失误次数/球员上场比赛的场次) </p><p>很多时候，我们有数据，但丌知道怎么应用。就是因为缺乏了一个有效性的方向。这个方向可以成为<strong>目标指数</strong>。通过设置不同的<strong>权重</strong>，将<strong>数据加工成指数</strong>，达到<strong>聚焦</strong>的目的。</p><h5 id="指数法举例："><a href="#指数法举例：" class="headerlink" title="指数法举例："></a>指数法举例：</h5><h6 id="反比例："><a href="#反比例：" class="headerlink" title="反比例："></a>反比例：</h6><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566120043.png" alt="反比例函数达到一个收敛的效果"></p><h6 id="收敛得更厉害："><a href="#收敛得更厉害：" class="headerlink" title="收敛得更厉害："></a>收敛得更厉害：</h6><p>log/log加线性权重</p><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>核心：指数法是一种目标驱动的思维</p><p>应用：和假设法不同，假设法是缺乏有效的数据，指数法是无法利用数据，指数法是无法利用数据将其加工可利用的。</p><p>优点：目标驱动力强，直观、简洁、有效。对业务有一定的指导作用。一旦设立指数，不易频繁变动。</p><p>须知：指数法没统一的标准，很多指数更依赖经验的加工。</p><h4 id="二八法"><a href="#二八法" class="headerlink" title="二八法"></a>二八法</h4><p>百分之八十的数据是没有价值的，只有20%的用户才是有价值的</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566120837.png" alt="帕累托图"></p><blockquote><p>数据中20%的变量将直接产生80%的效果。</p><p>持续关注TopN的数据，是一个非常好的习惯</p><p>虽然指标很多，但是往往某些指标更有价值，二八法则不仅能分析数据，也能管理数据。</p></blockquote><h5 id="二八法："><a href="#二八法：" class="headerlink" title="二八法："></a>二八法：</h5><p>核心：二八法是一种抓重点的思维</p><p>应用：二八法则存在于几乎所有的领域，所以这种分析思维没有局限</p><p>优点：和业务紧密相关，和KPI更紧密相关。几乎花费最少的精力就能达到不错的效果，性价比很优</p><p>须知：在条件允许的情况下，数据分析依旧不能放弃全局 ，否则会让思路变得狭隘</p><h4 id="对比法"><a href="#对比法" class="headerlink" title="对比法"></a>对比法</h4><blockquote><p>节日大促，女生消费占比从60%变为70%，女生节日爱消费 ：</p><ul><li>这个结论是有问题的 </li><li>占比提高了，不代表绝对值提高了。某商品平时销售 额100万女生占60万，节日销售额80万女生占56 万，女生真的消费变高了? </li><li>谁说节日销售额会提高？别忘了竞争对手 </li><li>孤数不证 </li></ul></blockquote><ol><li>竞争对手对比</li><li>类别对比</li><li>特征和属性对比</li><li>时间同比环比</li><li>转化对比</li><li>前后变化对比</li></ol><h5 id="对比法："><a href="#对比法：" class="headerlink" title="对比法："></a>对比法：</h5><p>核心：对比法是一种挖掘数据规律的思考方式</p><p>应用：对比更多是一种习惯，是数据分析的牛角尖，一次合格的分析，一定要用到N次对比</p><p>优点：对比法可以发想很多数据间的规律，它可以与任何<strong>思维技巧</strong>结合，比如多维对比、象限对比、假设对比等</p><p>须知：在条件允许的情况下，数据分析依旧不能放弃全局，否则会让思路变得狭隘。</p><h3 id="3-如何在业务时间锻炼数据分析思维"><a href="#3-如何在业务时间锻炼数据分析思维" class="headerlink" title="3. 如何在业务时间锻炼数据分析思维"></a>3. 如何在业务时间锻炼数据分析思维</h3><h4 id="好奇心"><a href="#好奇心" class="headerlink" title="好奇心"></a>好奇心</h4><h5 id="尿布旁边放啤酒，增加啤酒的销量"><a href="#尿布旁边放啤酒，增加啤酒的销量" class="headerlink" title="尿布旁边放啤酒，增加啤酒的销量"></a>尿布旁边放啤酒，增加啤酒的销量</h5><font size=6 >**是假的**！！</font><ul><li>买了尿布的人会买啤酒，但是买啤酒的人会买尿布么?</li><li>尿布旁边应该摆放其他东西么?啤酒是否是最好选择?</li><li>怎么摆放啤酒?部分还是全部品类?</li><li>场景型的摆放是否比品类摆放更好?</li><li>数据呢? </li></ul><h5 id="生活中的练习"><a href="#生活中的练习" class="headerlink" title="生活中的练习"></a>生活中的练习</h5><p>走在夜市：</p><ul><li>这个夜市一天的人流量是多少?一年的</li><li>人流量又是多少?</li><li>「现煮小卷」每天的营业额是多少?</li><li>这个夜市，哪家店的利润是最高的?它 比最低的高出多少?原因是什么? </li><li>如何从数据分析的角度提高最低店的营业额?</li><li>夜店准备弄一次活劢，如何设计一套数 据评估方案评估活劢效果? </li></ul><p>工作中：</p><ul><li>为什么领导戒者同事丌认同这次分析?原因是什么?</li><li>如果我的职位比现在高两级，我会去怎么分析?</li><li>让我再次分析一年前做的那个案例，我 会怎么去优化和改迚? </li><li>我的历史分析，能用三种核心思维去优化和迭代吗?</li></ul><h2 id="三、业务——2小时"><a href="#三、业务——2小时" class="headerlink" title="三、业务——2小时"></a>三、业务——2小时</h2><h3 id="1-为什么业务重要？"><a href="#1-为什么业务重要？" class="headerlink" title="1. 为什么业务重要？"></a>1. 为什么业务重要？</h3><p><strong>惟有理解业务，才能建立业务数据模型</strong></p><h3 id="2-经典业务分析指标"><a href="#2-经典业务分析指标" class="headerlink" title="2. 经典业务分析指标"></a>2. 经典业务分析指标</h3><h4 id="模型未动-，-指标先行"><a href="#模型未动-，-指标先行" class="headerlink" title="模型未动 ， 指标先行"></a>模型未动 ， 指标先行</h4><p>如果你不能衡量它，你就无法增长它</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566124304.png" alt="指标"></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566124343.png" alt="建立指标雏形"></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566124364.png" alt="建立指标雏形"></p><p>指标可以让老板更好地管理，需要建立分析框架，必须确立好指标</p><p>应该选取哪些指标分析：</p><ol><li>核心指标</li><li>好的指标应该是比率</li><li>好的指标应该能带来显著效果</li><li>好的指标不应该虚荣</li><li>好的指标不应该复杂</li></ol><h4 id="2-1-市场营销指标"><a href="#2-1-市场营销指标" class="headerlink" title="2.1 市场营销指标"></a>2.1 市场营销指标</h4><h5 id="客户-用户生命周期"><a href="#客户-用户生命周期" class="headerlink" title="客户/用户生命周期"></a>客户/用户生命周期</h5><ul><li>企业/产品和消费者在整个业务关系阶<br>段的周期。</li><li>不同业务划分的阶段丌同。传统营销中， 分为潜在用户，兴趣用户，新客户，老/ 熟客户，流失客户。 </li></ul><h5 id="用户价值"><a href="#用户价值" class="headerlink" title="用户价值"></a>用户价值</h5><ul><li><p>业务领域千千万万，怎么<strong>定义最有效的用户</strong>呢?请出指数法，将业务最关注的几个指标一起加工吧。</p></li><li><p>用户贡献 = 产出量/投入量*100%</p></li><li><p>用户价值 = (贡献1+贡献2+……) </p></li><li><p>比如金融行业会以存款+贷款+信用卡+ 年费+……-风险-流失 </p></li></ul><h5 id="RFM模型"><a href="#RFM模型" class="headerlink" title="RFM模型"></a>RFM模型</h5><p>用户生命周期中，衡量客户价值的立方体模型。利用<strong>R最近一次消费时间，M总消费金额，F消费频次</strong>，将用户划分成多个群体。</p><h5 id="用户分群，营销矩阵"><a href="#用户分群，营销矩阵" class="headerlink" title="用户分群，营销矩阵"></a>用户分群，营销矩阵</h5><p>用户分群是市场营销中的一种常见策略，它提取用户的几个核心维度，用象限法将其归纳和分类。</p><h5 id="AARRR框架"><a href="#AARRR框架" class="headerlink" title="AARRR框架"></a>AARRR框架</h5><p>Acquisition用户获取、Activation用户活跃、Retention用户留存、Revenue营收、Refer传播。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566125006.png" alt=""></p><h5 id="用户获取"><a href="#用户获取" class="headerlink" title="用户获取"></a>用户获取</h5><ul><li>渠道到达量: 俗称<strong>曝光量</strong>。有多少人看到了产品推广相关的线索。</li><li>渠道<strong>转化率</strong>: 有多少用户因为曝光而心 劢Cost Per，包含CPM、CPC、CPS、 CPD、CPT等。 </li><li>渠道ROI: 推广营销的熟悉KPI，<strong>投资回报率</strong>，利润/投资*100%。 </li></ul><h5 id="用户获取-1"><a href="#用户获取-1" class="headerlink" title="用户获取"></a>用户获取</h5><ul><li>日应用下载量: app的下载量，这里指 点击下载，丌代表下载完成 </li><li>日新增用户数: 以用户<strong>注册</strong>提交资料为基准</li><li><strong>获客成本</strong>: 为获取一位用户需要支付的成本</li><li>一次会话用户数占比: 指新用户下载完 App，仅打开过产品一次，且该次使用 时长在2分钟以内。「防止机器人刷单，灰色流量」 </li></ul><h5 id="用户活跃"><a href="#用户活跃" class="headerlink" title="用户活跃"></a>用户活跃</h5><ul><li>日/周/月活跃用户应用下载量:活跃 标准是用户用过产品，广义上，网页浏 览内容算「用」，在公众号下单算 「用」，不限于打开APP。 </li><li>活跃用户占比:活跃用户数在总用户数的比例，衡量的是产品健康程度</li></ul><h5 id="用户活跃："><a href="#用户活跃：" class="headerlink" title="用户活跃："></a>用户活跃：</h5><ul><li>用户会话session次数: 用户打开产品操 作和使用，直到退出产品的整个周期。5 分钟内没有操作，默讣会话操作结束。 </li><li>用户访问时长: 一次会话的持续时间。</li><li>用户平均访问次数: 一段时间内的用户平均产生会话次数。</li></ul><h5 id="用户留存"><a href="#用户留存" class="headerlink" title="用户留存"></a>用户留存</h5><ul><li>用户在某段时间内使用产品，过了一段时间后仍旧继续使用的用户。</li><li>假设产品某天新增用户1000个，第二天 仍旧活跃的用户有350个，那么称次日 留存率有35%，如果第七天仍旧活跃的 用户有100个，那么称七日留存率为 10%。 </li></ul><h5 id="营收："><a href="#营收：" class="headerlink" title="营收："></a>营收：</h5><ul><li><p>付费用户数: 花了钱的 </p></li><li><p>付费用户数占比: 每日付费用户占活跃用户数比，也可以计算总付费用户占总用户数比</p></li><li>ARPU: 某时间段内每位用户平均收入 </li><li>ARPPU: 某时间段内每位付费用户平均 收入，排除了未付费的 </li></ul><h5 id="营收：-1"><a href="#营收：-1" class="headerlink" title="营收："></a>营收：</h5><ul><li>客单价: 每一位用户平均贩买商品的金额。销售总额/顾客总数</li><li>LTV: 用户生命周期价值，和市场营销 的客户价值接近，经常用在游戏运营电 商运营中。 </li><li>LTV = ARPU * 1/流失率 </li></ul><h5 id="传播"><a href="#传播" class="headerlink" title="传播"></a>传播</h5><h4 id="2-2-用户行为指标"><a href="#2-2-用户行为指标" class="headerlink" title="2.2 用户行为指标"></a>2.2 用户行为指标</h4><h5 id="用户行为"><a href="#用户行为" class="headerlink" title="用户行为"></a>用户行为</h5><ul><li>用户行为的数据分析是一个很广泛的课题，丌同业务领域背景的用户行为分析不一样。</li><li>这里简单概括说几个方法。</li></ul><h5 id="功能使用"><a href="#功能使用" class="headerlink" title="功能使用"></a>功能使用</h5><ul><li>功能使用率/渗透率:使用某功能的用户占总活跃数之比。</li><li>比如点赞、评论、收藏、关注、搜索、添加好友，均可以算做功能使用。这些指标在特定业务中均有作用。</li></ul><h5 id="用户会话"><a href="#用户会话" class="headerlink" title="用户会话"></a>用户会话</h5><p>会话session:也叫做session，是用户 在一次访问过程中，从开始到结束的整 个过程。 在网页端，30分钟内没有操作， 默讣会话操作结束。 </p><h5 id="用户路径"><a href="#用户路径" class="headerlink" title="用户路径"></a>用户路径</h5><p>路径图:用户在一次会话的过程中，其访问产品内部的浏览轨迹。通过此，可以加工出关键路径转化率。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566126969.png" alt=""></p><h4 id="2-3-电子商务指标"><a href="#2-3-电子商务指标" class="headerlink" title="2.3 电子商务指标"></a>2.3 电子商务指标</h4><h5 id="购物篮分析"><a href="#购物篮分析" class="headerlink" title="购物篮分析"></a>购物篮分析</h5><ul><li>笔单价:用户每次贩买支付的金额，即每笔订单的支出。和客单价对应。件单价:商品的平均价格。</li><li>成交率:支付成功的用户在总的客流量中的占比。</li><li>贩物篮系数:平均每笔订单中，卖出了多少商品。贩物篮系数是多多益善，它也和商品关联规则有关系。</li></ul><h5 id="好基友-复购率和回购率"><a href="#好基友-复购率和回购率" class="headerlink" title="好基友:复购率和回购率"></a>好基友:复购率和回购率</h5><ul><li>复贩率是一段时间内多次消费的用户占 总消费用户数乊比。有例如4月有1000 位用户消费，其中500位消费了两次以 上，则复贩率是50%。 </li><li>回贩率是一段时间内消费过的用户，在 下一段时间内仍旧消费的占比。例如4月 的消费用户数1000，其中600位在5月 继续消费，则回贩率为60%。 </li></ul><h4 id="2-4-流量指标"><a href="#2-4-流量指标" class="headerlink" title="2.4 流量指标"></a>2.4 流量指标</h4><h5 id="浏览量和访客量"><a href="#浏览量和访客量" class="headerlink" title="浏览量和访客量"></a>浏览量和访客量</h5><ul><li>PV: 浏览次数。互联网早起的统计指标， 用户在网页的一次访问请求可以看作一 个PV，用户看了十个网页，则PV为10。 </li><li>UV: 是一定时间内访问网页的人数，正式名称独立访客数。在同一天内，丌管 用户访问了多少网页，他都只算一个独立访客。 </li><li>技术上，UV会通过cookie或IP衡量。 </li></ul><h5 id="访客行为"><a href="#访客行为" class="headerlink" title="访客行为"></a>访客行为</h5><ul><li>新老访客占比: 衡量网站的生命力</li><li>访客时间: 衡量内容质量丌是看内容的 UV，而是看内容的访问时间。 </li><li>新老访客占比: 衡量网站的生命力</li><li>来源: 访客从哪里来，技术上，通过来 源网站的参数提取，可以区分SEM， SEO或者外链等。 </li></ul><h5 id="退出率和跳出率"><a href="#退出率和跳出率" class="headerlink" title="退出率和跳出率"></a>退出率和跳出率</h5><ul><li>退出率: 从该页退出的页面访问数/进入该页的访问数。</li><li>跳出率: 浏览单页即推出的次数/访问次数。</li><li>跳出率一般衡量各个落地页，营销页等页面。退出率则更偏产品，仸何页面都有退出率</li></ul><h4 id="2-5-怎么生成指标"><a href="#2-5-怎么生成指标" class="headerlink" title="2.5 怎么生成指标"></a>2.5 怎么生成指标</h4><blockquote><p>访客访问时长 + UV = 重度访问用户占比 浏览时间5分钟以上的用户在整个访客中占比.<br>用户会话次数 + 成交率 = 有效消费会话占比 用户在所有的会话中，其中有多少次有消费?</p></blockquote><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566128514.png" alt=""></p><h3 id="3-业务的分析框架"><a href="#3-业务的分析框架" class="headerlink" title="3. 业务的分析框架"></a>3. 业务的分析框架</h3><h4 id="3-1-如何建立业务分析框架"><a href="#3-1-如何建立业务分析框架" class="headerlink" title="3.1 如何建立业务分析框架"></a>3.1 如何建立业务分析框架</h4><p>用指标建立业务分析框架</p><ol><li>从指标的角度出发</li><li>从业务的角度出发</li><li>从流程的角度出发</li></ol><h4 id="市场营销模型"><a href="#市场营销模型" class="headerlink" title="市场营销模型"></a>市场营销模型</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566129100.png" alt="市场营销模型"></p><h5 id="对机会客户线性加权的加工："><a href="#对机会客户线性加权的加工：" class="headerlink" title="对机会客户线性加权的加工："></a>对机会客户线性加权的加工：</h5><ol><li>潜在客户转化率</li><li>机会客户转化率</li><li>新客付费转化率</li><li>不同渠道在新客中的占比</li><li>不同渠道在新客中的付费转化率</li></ol><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566131113.png" alt="核心客户"></p><h4 id="AARRR模型"><a href="#AARRR模型" class="headerlink" title="AARRR模型"></a>AARRR模型</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566131181.png" alt="AARRR模型分析框架"></p><h5 id="二次激活的线性加权加工："><a href="#二次激活的线性加权加工：" class="headerlink" title="二次激活的线性加权加工："></a>二次激活的线性加权加工：</h5><ul><li>推送激活转化率</li><li>有效推送成功率</li><li>有效推送到达率</li><li>用户打开率</li><li>不同推送的转化率</li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566131325.png" alt="漏斗图"></p><h4 id="用户行为模型（内容平台）"><a href="#用户行为模型（内容平台）" class="headerlink" title="用户行为模型（内容平台）"></a>用户行为模型（内容平台）</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566131375.png" alt=""></p><h5 id="点赞-评论-收藏的线性加权："><a href="#点赞-评论-收藏的线性加权：" class="headerlink" title="点赞/评论/收藏的线性加权："></a>点赞/评论/收藏的线性加权：</h5><ul><li>点赞用户活跃占比</li><li>评论用户活跃占比</li><li>收藏用户活跃占比</li><li>内容指数</li></ul><h4 id="电子商务模型"><a href="#电子商务模型" class="headerlink" title="电子商务模型"></a>电子商务模型</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566131814.png" alt=""></p><h5 id="购物车的线性加权："><a href="#购物车的线性加权：" class="headerlink" title="购物车的线性加权："></a>购物车的线性加权：</h5><ul><li>不同商品类别的占比（对比法）</li><li>不同价格档次的占比（象限法）</li><li>不同商品下单支付率（漏斗法）</li></ul><h4 id="流量模型"><a href="#流量模型" class="headerlink" title="流量模型"></a>流量模型</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566131960.png" alt=""></p><h5 id="搜索引擎流量、搜索引擎优化的线性加权"><a href="#搜索引擎流量、搜索引擎优化的线性加权" class="headerlink" title="搜索引擎流量、搜索引擎优化的线性加权"></a>搜索引擎流量、搜索引擎优化的线性加权</h5><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566131932.png" alt=""></p><h4 id="3-2-应对各类业务场景"><a href="#3-2-应对各类业务场景" class="headerlink" title="3.2 应对各类业务场景"></a>3.2 应对各类业务场景</h4><blockquote><p>Step.1 练习<br>Step.2 熟悉业务<br>Step.3 应用三种核心思维<br>Step.4 归纳和整理出指标<br>Step.5 画出框架<br>Step.6 检查、应用、修正<br>Step.7 应用和迭代</p></blockquote><font size=5 color=pink>//TODO 视频2.30必看</font><h3 id="4-数据化管理业务"><a href="#4-数据化管理业务" class="headerlink" title="4. 数据化管理业务"></a>4. 数据化管理业务</h3><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566132051.png" alt=""></p><h2 id="四、Excel——2小时（多练习）"><a href="#四、Excel——2小时（多练习）" class="headerlink" title="四、Excel——2小时（多练习）"></a>四、Excel——2小时（多练习）</h2><blockquote><p>不会因为你会Python而成为数据分析师，而是能用任何工具解决问题</p></blockquote><h3 id="1-为什么用Excel？"><a href="#1-为什么用Excel？" class="headerlink" title="1. 为什么用Excel？"></a>1. 为什么用Excel？</h3><h4 id="1-1-Excel的学习路径"><a href="#1-1-Excel的学习路径" class="headerlink" title="1.1 Excel的学习路径"></a>1.1 Excel的学习路径</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566142020.png" alt="知识点"></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566142081.png" alt="Excel为Python打下基础"></p><ol><li>Excel保证新版本</li><li>培养好的数据表格习惯</li><li>主动性搜索</li><li>多练习</li></ol><h4 id="1-2-Excel的常见函数"><a href="#1-2-Excel的常见函数" class="headerlink" title="1.2 Excel的常见函数"></a>1.2 Excel的常见函数</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566142222.png" alt="常见函数类"></p><h5 id="文本清洗函数"><a href="#文本清洗函数" class="headerlink" title="文本清洗函数"></a>文本清洗函数</h5><blockquote><p>1 bit = 两种可能性，用0戒1存储<br>1 byte = 8 bit，如00000001，一共有256种可能性<br>1 byte可以存256个字符编码，最初的存储方式ASCII，就存了英文+数字+符号<br>汉字远远大于256种可能性，于是用2byte组合表示，叫做GB2312<br>后来为了表示更多的汉子，用了GBK，它是拓展版，连繁体字都包括了<br>可是中国还有少数民族啊!少数民族的文字怎么办?于是又多了GB18030<br>可是全世界有多少国家多少名族?于是@#¥%……&amp;<em><br>于是发明了一个万国码，叫做<em>*unicode</em></em></p></blockquote><div class="table-container"><table><thead><tr><th style="text-align:center">字符</th><th style="text-align:center">ASCII</th><th style="text-align:center">Unicode</th><th style="text-align:center">UTF-8</th></tr></thead><tbody><tr><td style="text-align:center">A</td><td style="text-align:center">01000001</td><td style="text-align:center">00000000 01000001</td><td style="text-align:center">01000001</td></tr><tr><td style="text-align:center">中</td><td style="text-align:center">x</td><td style="text-align:center">01001110 00101101</td><td style="text-align:center">11100100 10111000 10101101</td></tr></tbody></table></div><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566177086.png" alt=""></p><div class="table-container"><table><thead><tr><th style="text-align:center">Find</th><th style="text-align:center">Substitute</th></tr></thead><tbody><tr><td style="text-align:center">Left Right Mid(提取需要的部分)</td><td style="text-align:center">Text(转换格式)</td></tr><tr><td style="text-align:center">Concatenate(拼接函数)</td><td style="text-align:center">Trim(规整字符串)</td></tr><tr><td style="text-align:center">Replace(替换函数)</td><td style="text-align:center">Len(长度)</td></tr></tbody></table></div><font size=5 color=pink>//TODO EXCEL操作见`DataAnalyst`</font><h5 id="关联匹配函数"><a href="#关联匹配函数" class="headerlink" title="关联匹配函数"></a>关联匹配函数</h5><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566180871.png" alt=""></p><div class="table-container"><table><thead><tr><th style="text-align:center">Lookup</th><th style="text-align:center">Row</th></tr></thead><tbody><tr><td style="text-align:center">Vlookup(另一个表主键匹配添加)</td><td style="text-align:center">Column</td></tr><tr><td style="text-align:center">Index(索引)</td><td style="text-align:center">Offset(偏移)</td></tr><tr><td style="text-align:center">Match(查找相对位置)</td><td style="text-align:center">Hyperlink(超链接)</td></tr></tbody></table></div><p>Index和Match联合引用——「Match匹配出来的值的另一列」</p><h5 id="逻辑运算函数"><a href="#逻辑运算函数" class="headerlink" title="逻辑运算函数"></a>逻辑运算函数</h5><blockquote><p>条件判断</p></blockquote><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566181386.png" alt=""></p><div class="table-container"><table><thead><tr><th style="text-align:center">And</th><th style="text-align:center">Not</th></tr></thead><tbody><tr><td style="text-align:center">Or</td><td style="text-align:center">False True</td></tr><tr><td style="text-align:center">IF (加在后面加条件)</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">Is</td></tr></tbody></table></div><h5 id="计算统计函数"><a href="#计算统计函数" class="headerlink" title="计算统计函数"></a>计算统计函数</h5><div class="table-container"><table><thead><tr><th style="text-align:center">Sum</th><th style="text-align:center">Rank(排名)</th><th style="text-align:center">Stdev</th></tr></thead><tbody><tr><td style="text-align:center">Sumproduct(累加相乘)</td><td style="text-align:center">Rand RandBetween(随机函数)</td><td style="text-align:center">Substotal</td></tr><tr><td style="text-align:center">Count</td><td style="text-align:center">Average</td><td style="text-align:center">Int(取整)</td></tr><tr><td style="text-align:center">Max Min</td><td style="text-align:center">Quartile(分位数)</td><td style="text-align:center">Round(取整)</td></tr></tbody></table></div><h5 id="时间序列函数"><a href="#时间序列函数" class="headerlink" title="时间序列函数"></a>时间序列函数</h5><blockquote><p>2017/02/27</p></blockquote><div class="table-container"><table><thead><tr><th style="text-align:center">Year</th><th style="text-align:center">Day</th></tr></thead><tbody><tr><td style="text-align:center">Month</td><td style="text-align:center">Date</td></tr><tr><td style="text-align:center">Weekday(判断一周中的周几)</td><td style="text-align:center">Now(返回当前的时间)</td></tr><tr><td style="text-align:center">Weeknum(一年中的第几周)</td><td style="text-align:center">Today(返回当前的日期)</td></tr></tbody></table></div><h4 id="1-3-Excel常见技巧"><a href="#1-3-Excel常见技巧" class="headerlink" title="1.3 Excel常见技巧"></a>1.3 Excel常见技巧</h4><p>快捷键：</p><ul><li>Ctrl+方向键</li><li>Ctrl+Shift +方向键</li><li>Ctrl+空格键</li><li>Shift+空格键</li><li>Ctrl+A 选择整张表</li><li>Alt+Enter 换行</li></ul><h5 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h5><h5 id="数据透视表"><a href="#数据透视表" class="headerlink" title="数据透视表"></a>数据透视表</h5><h5 id="条件格式和迷你图"><a href="#条件格式和迷你图" class="headerlink" title="条件格式和迷你图"></a>条件格式和迷你图</h5><h5 id="分列"><a href="#分列" class="headerlink" title="分列"></a>分列</h5><h5 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h5><h5 id="自定义名称"><a href="#自定义名称" class="headerlink" title="自定义名称"></a>自定义名称</h5><h5 id="自定义下拉菜单"><a href="#自定义下拉菜单" class="headerlink" title="自定义下拉菜单"></a>自定义下拉菜单</h5><h5 id="冻结"><a href="#冻结" class="headerlink" title="冻结"></a>冻结</h5><h5 id="删除重复项"><a href="#删除重复项" class="headerlink" title="删除重复项"></a>删除重复项</h5><h5 id="分析工具库"><a href="#分析工具库" class="headerlink" title="分析工具库"></a>分析工具库</h5><h5 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h5><h4 id="1-4-用Excel进行数据分析"><a href="#1-4-用Excel进行数据分析" class="headerlink" title="1.4 用Excel进行数据分析"></a>1.4 用Excel进行数据分析</h4><h5 id="现在你有一份的餐食数据，我想通过Excel知道-："><a href="#现在你有一份的餐食数据，我想通过Excel知道-：" class="headerlink" title="现在你有一份的餐食数据，我想通过Excel知道 ："></a>现在你有一份的餐食数据，我想通过Excel知道 ：</h5><ul><li>全国点评数最高的饭店是哪家?</li><li>哪个城市的饭店人均口味最好?</li><li>哪个类型的餐饮评价最好?</li><li>类型为川菜的店中，有多少个带「辣」字，又有多少个带「麻」字?</li><li>口味、环境、服务，三个评价都在8.0以上的饭店有几家?它们在哪个城市的占比最多? </li><li><p>上海地区中，各个类型饭店服务前五名?</p></li><li><p>没有评价的饭店有几家? </p></li><li>将人均价格划分成0~50，50~100，100~150，150~200，200+这几个档次， 各个城市分别有几家?其中占比又是多少? </li><li>将点评、人均、口味、环境、服务这几个指标加工出一个综合评价系数，并且计算</li><li>哪十家店是最好的(开放题)。</li><li>对上海地区的日本料理，做一次描述性分析(开放题)</li></ul><h2 id="五、数据可视化——2小时（下载Power-BI、熟悉基本操作）"><a href="#五、数据可视化——2小时（下载Power-BI、熟悉基本操作）" class="headerlink" title="五、数据可视化——2小时（下载Power BI、熟悉基本操作）"></a>五、数据可视化——2小时（下载Power BI、熟悉基本操作）</h2><h3 id="1-数据可视化"><a href="#1-数据可视化" class="headerlink" title="1. 数据可视化"></a>1. 数据可视化</h3><h4 id="数据可视化之美"><a href="#数据可视化之美" class="headerlink" title="数据可视化之美"></a>数据可视化之美</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566185105.png" alt=""></p><p>数据可视化 </p><ul><li>数据可视化的目的是让数据更高效</li><li>让读者更高效阅读，而不单是自己使用</li><li>突出数据背后的规律</li><li>突出重要的因素</li><li>最后是美观 </li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566185278.png" alt="交通热度图"></p><blockquote><p>只要能从图中看到我所要的规律，那么就是靠谱的</p></blockquote><h3 id="2-常见初级图表"><a href="#2-常见初级图表" class="headerlink" title="2. 常见初级图表"></a>2. 常见初级图表</h3><h4 id="图表的基础概念"><a href="#图表的基础概念" class="headerlink" title="图表的基础概念"></a>图表的基础概念</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566185328.png" alt="维度和度量"></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566185431.png" alt=""></p><h4 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566185495.png" alt="散点图"></p><p><strong>散点图</strong></p><ul><li>散点图主要解释数据之间的规律。<ul><li>维度:0+，作为颜色 </li><li>度量:2 </li></ul></li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566206567.png" alt=""></p><p><strong>气泡图</strong> </p><ul><li>气泡图是散点图的变种，引入了第三个度量作为气泡的大小。<ul><li>维度:1+，作为颜色 </li><li>度量:3，其中1个是气泡大小 </li></ul></li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566206586.png" alt=""></p><p><strong>单轴散点图</strong> </p><ul><li>维度作Y轴，更倾向于洞 察数据在不同类别下的 数据规律 <ul><li>维度:1+，Y轴 </li><li>度量:2 </li></ul></li></ul><p><strong>客户消费维度</strong> </p><ul><li>消费金额和消费次数的关系</li><li>消费金额和最后一次距今消费天数的关系</li><li>消费次数和最后一次距今消费天数的关系</li></ul><p><strong>客户其他消费维度</strong> </p><ul><li>消费金额和消费折扣的关系</li><li>消费金额和会员积分的关系</li><li>消费次数和会员距离的关系</li></ul><p><strong>垂直领域消费维度</strong> </p><ul><li>投资金额和投资次数的关系(金融) </li><li>最近一次距今消费和使用次数(SaaS) </li></ul><h4 id="折线图"><a href="#折线图" class="headerlink" title="折线图"></a>折线图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566185809.png" alt="折线图"></p><p><strong>折线图</strong></p><ul><li>折线图经常用来观察数据随时间变化的趋势。</li><li>折线图中的维度不宜过多，否则会非常混乱和复杂。<ul><li>维度:1+</li><li>可对比度量:1+ </li><li>时间维度:X轴 </li></ul></li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566185928.png" alt="堆叠区域图"></p><p><strong>面积图</strong></p><ul><li>面积图是折线图的变种。</li><li>面积图更注重数据类别之间随着时间趋势的变化关系。<ul><li>维度:1 </li><li>度量:2 </li></ul></li></ul><h4 id="柱形图"><a href="#柱形图" class="headerlink" title="柱形图"></a>柱形图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566185978.png" alt="柱形图"></p><p><strong>柱形图</strong></p><ul><li>柱形图是类别之间的关系。<ul><li>维度:2 </li><li>度量:1+ </li></ul></li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186011.png" alt="直方图"></p><p><strong>直方图</strong> </p><ul><li>柱形图的统计型变种。 <ul><li>维度:0 </li><li>度量:1 </li></ul></li></ul><h4 id="饼图"><a href="#饼图" class="headerlink" title="饼图"></a>饼图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186082.png" alt="饼图"></p><p><strong>饼图（没什么屁用）</strong></p><ul><li>饼图可以理解为环状的 柱形图。</li><li>饼图的类别不宜过多。饼图除了PPT， 分析时没啥用。 <ul><li>维度:1 </li><li>度量:1 </li></ul></li></ul><h4 id="漏斗图"><a href="#漏斗图" class="headerlink" title="漏斗图"></a>漏斗图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186134.png" alt="漏斗图"></p><p><strong>漏斗图（也没啥用）</strong></p><ul><li>漏斗图是对转化过程的 直观展示。单一的漏斗 图没啥用，也是面向 PPT。漏斗图的转化步 骤不应该超过七个。 <ul><li>维度:1 </li><li>度量:1 </li></ul></li></ul><h4 id="雷达图"><a href="#雷达图" class="headerlink" title="雷达图"></a>雷达图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186171.png" alt="雷达图"></p><p><strong>雷达图</strong></p><ul><li>适用于个体的数据和属 性可视化，比较偏描述性数据，常见于CRM， 用户画像。 <ul><li>维度:1+ </li><li>度量:1+ </li></ul></li></ul><h3 id="3-常见的高级图表"><a href="#3-常见的高级图表" class="headerlink" title="3. 常见的高级图表"></a>3. 常见的高级图表</h3><h4 id="树形图"><a href="#树形图" class="headerlink" title="树形图"></a>树形图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186360.png" alt="树形图"></p><p><strong>树形图（大数据量）</strong> </p><ul><li>适合<strong>数据量较大</strong>的情况， 尤其类别较多。比如各 类电商的SKU <ul><li>·维度:1+ </li><li>度量:1 </li></ul></li></ul><h4 id="桑基图"><a href="#桑基图" class="headerlink" title="桑基图"></a>桑基图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186400.png" alt="桑葚图"></p><p><strong>桑基图（网站流量、行为轨迹、活跃状态变化）</strong> </p><ul><li>桑吉图是揭示数据复杂变化趋势的图表。面积图是线性维度，而桑基图可以一对多或者多对一。<ul><li>维度:2 source,target </li><li>度量:1 </li></ul></li></ul><h4 id="热力图"><a href="#热力图" class="headerlink" title="热力图"></a>热力图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186505.png" alt="热力图1"></p><p><strong>热力图</strong> </p><ul><li>数据在空间上的变化规律。譬如地理空间，譬如网页浏览<ul><li>维度:2 </li><li>度量:1 </li></ul></li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186552.png" alt="热力图2"></p><p><strong>热力图（github、特殊的时间规律）</strong> </p><ul><li>空间不一定是纯粹空间，也可以是属性和维度的规律组合，比如把它变成星期表。<ul><li>维度:1 </li><li>度量:1 </li></ul></li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186594.png" alt="热力图3"></p><h4 id="关系图"><a href="#关系图" class="headerlink" title="关系图"></a>关系图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186777.png" alt="关系图"></p><p><strong>关系图（社交、「很少用到」）</strong> </p><ul><li>展现不同类别之间的数据关系，常见于各类社交社会媒体。<ul><li>维度:2 source target </li><li>度量:0+ </li></ul></li></ul><h4 id="箱线图"><a href="#箱线图" class="headerlink" title="箱线图"></a>箱线图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186808.png" alt="箱线图"></p><p><strong>箱线图（数据的分布规律、统计学）</strong> </p><ul><li>箱线图是统计用图表，用来研究和观察数据分布，也能对比数据分布。<ul><li>维度:1+ </li><li>度量:1 </li></ul></li></ul><h4 id="标靶图"><a href="#标靶图" class="headerlink" title="标靶图"></a>标靶图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186827.png" alt="标靶图"></p><p><strong>标靶图（销售业绩）</strong> </p><ul><li>也称为子弹图，是变种的条形图。常用于衡量业务销售完成情况。<ul><li>维度:1+ </li><li>度量:2 </li></ul></li></ul><h4 id="词云图"><a href="#词云图" class="headerlink" title="词云图"></a>词云图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186899.png" alt="词云图"></p><p><strong>词云图（大数据必备图表）</strong> </p><ul><li>文本分析利器，PPT常 客，卖弄大数据之必备 图表 <ul><li>维度:1 </li><li>度量:0 </li></ul></li></ul><h4 id="地理图"><a href="#地理图" class="headerlink" title="地理图"></a>地理图</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566186918.png" alt="地理图"></p><p><strong>地理图</strong> </p><ul><li>数据和空间之间的关系。地理图即可以通过经纬度的数值度量绘制，也能通过省市的类别维度绘制。<ul><li>维度:1(经纬或行政) </li><li>度量:1 </li></ul></li></ul><h3 id="4-图表绘制"><a href="#4-图表绘制" class="headerlink" title="4. 图表绘制"></a>4. 图表绘制</h3><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566188201.png" alt=""></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566188221.png" alt=""></p><font size=5 color=pink>//TODO 具体见视频4.47～4.55</font><h3 id="5-可视化BI"><a href="#5-可视化BI" class="headerlink" title="5. 可视化BI"></a>5. 可视化BI</h3><blockquote><p>BI（Business Intelligence）即商务智能，它是一套完整的解决方案，用来<strong>将企业中现有的数据进行有效的整合</strong>，快速准确地<strong>提供报表并提出决策依据</strong>，帮助企业做出明智的业务经营决策。它是一种<strong>产品/服务</strong>，这个<strong>产品/服务</strong>可能包含报表，分析，管理等等利用<strong>计算机和编程技术自动化一些商业过程的行为</strong>。</p><p>商业智能 BI 就是一个把数据变为信息的过程 —— 将企业中的各个部分、各个业务系统中的数据统一的按照一定规则的抽取、清洗，最后加载到一个统一而集中的数据库中。在这个数据库之上，可以做报表展现、也可以做数据分析，最后这些展现和分析的结果将能成为一些决策的重要数据支持，这就是描述商业智能 BI 的一个最简单的价值。简单概括这个过程所体现的三个大的部分就是：Data Source 数据源，Data Warehouse 数据仓库的数据准备，Reporting 报表系统提供报表展现和数据分析。</p></blockquote><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566194071.png" alt="简单的商业智能BI项目架构"></p><p>你的图表，是原因，还是现象?</p><blockquote><p>数据分析师在地理图上发现A省B省C省的某个指标 下跌了，你兴奋的告诉老大这是上个月数据表现不佳的原因。 </p><p>老大肯定抽你，这是现象。具体的原因要结合更深的分析，这些省市经济程度如何、人口如何、有何 数据共性，这是地理图不会告诉你的</p></blockquote><font size=5 color=pink>**工具：Power BI**</font><font size=5 color=pink>//TODO Power BI的基本使用——视频4.57~4.60</font><font size=5>**单一图表的可视化没有意义——**</font><font size=6 color=skyblue>**三表成虎**</font><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566188337.png" alt="BI"></p><h4 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h4><blockquote><p>Who 是谁在使用?<br>What 用户的目的是什么?<br>How 用户怎么使用?</p></blockquote><font color=red>Prower BI有监控，可以知道哪些人看了哪些图表。可以进行简单地调研，来改进自己的BI。后台调用监控日志，砍掉不需要的BI，加强需要的BI。</font><h5 id="主次分明"><a href="#主次分明" class="headerlink" title="主次分明"></a>主次分明</h5><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566188522.png" alt="主次分明"></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566188593.png" alt="国外的第三方数据平台"></p><h5 id="贴合场景"><a href="#贴合场景" class="headerlink" title="贴合场景"></a>贴合场景</h5><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566188537.png" alt=""></p><h5 id="指标结构"><a href="#指标结构" class="headerlink" title="指标结构"></a>指标结构</h5><blockquote><p>DashBoard是一个不断改进不断更新的过程。</p></blockquote><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566188559.png" alt=""></p><h2 id="六、数据库——1小时（有基础、多练习）"><a href="#六、数据库——1小时（有基础、多练习）" class="headerlink" title="六、数据库——1小时（有基础、多练习）"></a>六、数据库——1小时（有基础、多练习）</h2><h3 id="1-数据库"><a href="#1-数据库" class="headerlink" title="1. 数据库"></a>1. 数据库</h3><p>数据库相关</p><ol><li>数据库是数据存储的集合，表是数据结构化的信息</li><li>列存储表中的组织信息，行存储表中的明细信息</li><li>主键是表中唯一标识，主键不具备业务意义</li></ol><p>Tips：</p><blockquote><p>表的主键不做强制要求，但建议设立<br>主键值必须唯一<br>每行必须有一个主键，不可为空<br>主键值不可被修改<br>主键值被删除后不可重用<br>表A的主键，可以做为表B的字段，此时不受约束</p></blockquote><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566197179.png" alt=""></p><h3 id="2-Join"><a href="#2-Join" class="headerlink" title="2. Join"></a>2. Join</h3><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566197247.png" alt=""></p><blockquote><p>Students.addressId = Address.id<br>Students.id = Scores.studentId<br>Scores.courseId = Courses.id</p></blockquote><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566197478.png" alt="JOINS"></p><h3 id="3-SQL练习题"><a href="#3-SQL练习题" class="headerlink" title="3. SQL练习题"></a>3. SQL练习题</h3><p>统计不同月份的下单人数<br>统计用户三月份的回购率和复购率<br>统计男女用户的消费频次是否有差异<br>统计多次消费的用户，第一次和最后一次消费间隔是多少?<br>统计不同年龄段，用户的消费金额是否有差异?<br>统计消费的二八法则，消费的top20%用户，贡献了多少额度</p><h2 id="八、Python——N小时（数据分析、爬虫、深度学习）"><a href="#八、Python——N小时（数据分析、爬虫、深度学习）" class="headerlink" title="八、Python——N小时（数据分析、爬虫、深度学习）"></a>八、Python——N小时（数据分析、爬虫、深度学习）</h2><h3 id="1-Python的数据科学环境"><a href="#1-Python的数据科学环境" class="headerlink" title="1. Python的数据科学环境"></a>1. Python的数据科学环境</h3><h3 id="2-Python基础"><a href="#2-Python基础" class="headerlink" title="2. Python基础"></a>2. Python基础</h3><h3 id="3-NumPy和Pandas"><a href="#3-NumPy和Pandas" class="headerlink" title="3. NumPy和Pandas"></a>3. NumPy和Pandas</h3><h3 id="4-数据可视化"><a href="#4-数据可视化" class="headerlink" title="4. 数据可视化"></a>4. 数据可视化</h3><h3 id="5-数据分析案例"><a href="#5-数据分析案例" class="headerlink" title="5. 数据分析案例"></a>5. 数据分析案例</h3><h3 id="6-数据分析平台"><a href="#6-数据分析平台" class="headerlink" title="6. 数据分析平台"></a>6. 数据分析平台</h3><h2 id="七、统计学——N小时（配合Python食用）"><a href="#七、统计学——N小时（配合Python食用）" class="headerlink" title="七、统计学——N小时（配合Python食用）"></a>七、统计学——N小时（配合Python食用）</h2><h3 id="1-描述统计学"><a href="#1-描述统计学" class="headerlink" title="1. 描述统计学"></a>1. 描述统计学</h3><p>拿到数据的时候怎么做？</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566141130.png" alt=""></p><p>男——0，女——1 「分类数据」</p><h4 id="分类数据的描述统计"><a href="#分类数据的描述统计" class="headerlink" title="分类数据的描述统计"></a>分类数据的描述统计</h4><ul><li>频数统计——单纯对各分类计数</li><li>频数百分比——单纯对各分类计数就可</li></ul><h4 id="数值数据描述统计"><a href="#数值数据描述统计" class="headerlink" title="数值数据描述统计"></a>数值数据描述统计</h4><blockquote><p>统计度量：</p><p>图形</p></blockquote><h5 id="统计度量："><a href="#统计度量：" class="headerlink" title="统计度量："></a>统计度量：</h5><ol><li>平均数、中位数、众数</li><li>分位数</li></ol><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-18%2F1566141578.png" alt=""></p><font size=5 color=pink>//TODO 阅读 贾俊平版《统计学》</font>]]></content>
    
    
    <summary type="html">Either I will find a way, or I will make one.</summary>
    
    
    
    <category term="Notes" scheme="http://www.ts1989.cn/categories/Notes/"/>
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="Data Analysis" scheme="http://www.ts1989.cn/tags/Data-Analysis/"/>
    
  </entry>
  
  <entry>
    <title>Spring Boot</title>
    <link href="http://www.ts1989.cn/2019/08/15/SpringBoot/"/>
    <id>http://www.ts1989.cn/2019/08/15/SpringBoot/</id>
    <published>2019-08-15T13:55:21.000Z</published>
    <updated>2021-06-02T16:57:52.776Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566207899.png" alt=""></p><span id="more"></span><h1 id="一、Spring-Boot-入门"><a href="#一、Spring-Boot-入门" class="headerlink" title="一、Spring Boot 入门"></a><strong>一、</strong>Spring Boot 入门</h1><h2 id="1、Spring-Boot-简介"><a href="#1、Spring-Boot-简介" class="headerlink" title="1、Spring Boot 简介"></a>1、Spring Boot 简介</h2><blockquote><p>简化Spring应用开发的一个框架；</p><p>整个Spring技术栈的一个大整合；</p><p>J2EE开发的一站式解决方案；</p></blockquote><h2 id="2、微服务"><a href="#2、微服务" class="headerlink" title="2、微服务"></a>2、微服务</h2><p>2014，martin fowler</p><p>微服务：架构风格（服务微化）</p><p>一个应用应该是一组小型服务；可以通过HTTP的方式进行互通；</p><p>单体应用：ALL IN ONE</p><p>微服务：每一个功能元素最终都是一个可独立替换和独立升级的软件单元；</p><p><a href="https://martinfowler.com/articles/microservices.html#MicroservicesAndSoa">详细参照微服务文档</a></p><h2 id="3、环境准备"><a href="#3、环境准备" class="headerlink" title="3、环境准备"></a>3、环境准备</h2><p><a href="http://www.gulixueyuan.com/">http://www.gulixueyuan.com/</a> 谷粒学院</p><p>环境约束</p><p>–jdk1.8：Spring Boot 推荐jdk1.7及以上；java version “1.8.0_112”</p><p>–maven3.x：maven 3.3以上版本；Apache Maven 3.3.9</p><p>–IntelliJIDEA2017：IntelliJ IDEA 2017.2.2 x64、STS</p><p>–SpringBoot 1.5.9.RELEASE：1.5.9；</p><p>统一环境；</p><h3 id="1、MAVEN设置；"><a href="#1、MAVEN设置；" class="headerlink" title="1、MAVEN设置；"></a>1、MAVEN设置；</h3><p>给maven 的settings.xml配置文件的profiles标签添加</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2、IDEA设置"><a href="#2、IDEA设置" class="headerlink" title="2、IDEA设置"></a>2、IDEA设置</h3><p>整合maven进来；</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151045.png" alt="idea设置"></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151112.png" alt="images/"></p><h2 id="4、Spring-Boot-HelloWorld"><a href="#4、Spring-Boot-HelloWorld" class="headerlink" title="4、Spring Boot HelloWorld"></a>4、Spring Boot HelloWorld</h2><p>一个功能：</p><p>浏览器发送hello请求，服务器接受请求并处理，响应Hello World字符串；</p><h3 id="1、创建一个maven工程；（jar）"><a href="#1、创建一个maven工程；（jar）" class="headerlink" title="1、创建一个maven工程；（jar）"></a>1、创建一个maven工程；（jar）</h3><h3 id="2、导入spring-boot相关的依赖"><a href="#2、导入spring-boot相关的依赖" class="headerlink" title="2、导入spring boot相关的依赖"></a>2、导入spring boot相关的依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3、编写一个主程序；启动Spring-Boot应用"><a href="#3、编写一个主程序；启动Spring-Boot应用" class="headerlink" title="3、编写一个主程序；启动Spring Boot应用"></a>3、编写一个主程序；启动Spring Boot应用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> 来标注一个主程序类，说明这是一个Spring Boot应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldMainApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Spring应用启动起来</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4、编写相关的Controller、Service"><a href="#4、编写相关的Controller、Service" class="headerlink" title="4、编写相关的Controller、Service"></a>4、编写相关的Controller、Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5、运行主程序测试"><a href="#5、运行主程序测试" class="headerlink" title="5、运行主程序测试"></a>5、运行主程序测试</h3><h3 id="6、简化部署"><a href="#6、简化部署" class="headerlink" title="6、简化部署"></a>6、简化部署</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这个插件，可以将应用打包成一个可执行的jar包；--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>将这个应用打成jar包，直接使用java -jar的命令进行执行；</p><h2 id="5、Hello-World探究"><a href="#5、Hello-World探究" class="headerlink" title="5、Hello World探究"></a>5、Hello World探究</h2><h3 id="1、POM文件"><a href="#1、POM文件" class="headerlink" title="1、POM文件"></a>1、POM文件</h3><h4 id="1、父项目"><a href="#1、父项目" class="headerlink" title="1、父项目"></a>1、父项目</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">他的父项目是</span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../../spring-boot-dependencies<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">他来真正管理Spring Boot应用里面的所有依赖版本；</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Spring Boot的版本仲裁中心；</p><p>以后我们导入依赖默认是不需要写版本；（没有在dependencies里面管理的依赖自然需要声明版本号）</p><h4 id="2、启动器"><a href="#2、启动器" class="headerlink" title="2、启动器"></a>2、启动器</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>spring-boot-starter</strong>-==web==：</p><p>​    spring-boot-starter：spring-boot场景启动器；帮我们导入了web模块正常运行所依赖的组件；</p><p>Spring Boot将所有的功能场景都抽取出来，做成一个个的starters（启动器），只需要在项目里面引入这些starter相关场景的所有依赖都会导入进来。要用什么功能就导入什么场景的启动器</p><h3 id="2、主程序类，主入口类"><a href="#2、主程序类，主入口类" class="headerlink" title="2、主程序类，主入口类"></a>2、主程序类，主入口类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> 来标注一个主程序类，说明这是一个Spring Boot应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldMainApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Spring应用启动起来</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@<strong>SpringBootApplication</strong>:    Spring Boot应用标注在某个类上说明这个类是SpringBoot的主配置类，SpringBoot就应该运行这个类的main方法来启动SpringBoot应用；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123;</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br></pre></td></tr></table></figure><p>@<strong>SpringBootConfiguration</strong>:Spring Boot的配置类；</p><p>​        标注在某个类上，表示这是一个Spring Boot的配置类；</p><p>​        @<strong>Configuration</strong>:配置类上来标注这个注解；</p><p>​            配置类 ——-  配置文件；配置类也是容器中的一个组件；@Component</p><p>@<strong>EnableAutoConfiguration</strong>：开启自动配置功能；</p><p>​        以前我们需要配置的东西，Spring Boot帮我们自动配置；@<strong>EnableAutoConfiguration</strong>告诉SpringBoot开启自动配置功能；这样自动配置才能生效；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(EnableAutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br></pre></td></tr></table></figure><p>​          @<strong>AutoConfigurationPackage</strong>：自动配置包</p><p>​        @<strong>Import</strong>(AutoConfigurationPackages.Registrar.class)：</p><p>​        Spring的底层注解@Import，给容器中导入一个组件；导入的组件由AutoConfigurationPackages.Registrar.class；</p><p>==将主配置类（@SpringBootApplication标注的类）的所在包及下面所有子包里面的所有组件扫描到Spring容器；==</p><p>​    @<strong>Import</strong>(EnableAutoConfigurationImportSelector.class)；</p><p>​        给容器中导入组件？</p><p>​        <strong>EnableAutoConfigurationImportSelector</strong>：导入哪些组件的选择器；</p><p>​        将所有需要导入的组件以全类名的方式返回；这些组件就会被添加到容器中；</p><p>​        会给容器中导入非常多的自动配置类（xxxAutoConfiguration）；就是给容器中导入这个场景需要的所有组件，并配置好这些组件；        <img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129224104.png" alt="自动配置类"></p><p>有了自动配置类，免去了我们手动编写配置注入功能组件等的工作；</p><p>​        SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class,classLoader)；</p><p>==Spring Boot在启动的时候从类路径下的META-INF/spring.factories中获取EnableAutoConfiguration指定的值，将这些值作为自动配置类导入到容器中，自动配置类就生效，帮我们进行自动配置工作；==以前我们需要自己配置的东西，自动配置类都帮我们；</p><p>J2EE的整体整合解决方案和自动配置都在spring-boot-autoconfigure-1.5.9.RELEASE.jar；</p><p>​        </p><p>==Spring注解版（谷粒学院）==</p><h2 id="6、使用Spring-Initializer快速创建Spring-Boot项目"><a href="#6、使用Spring-Initializer快速创建Spring-Boot项目" class="headerlink" title="6、使用Spring Initializer快速创建Spring Boot项目"></a>6、使用Spring Initializer快速创建Spring Boot项目</h2><h3 id="1、IDEA：使用-Spring-Initializer快速创建项目"><a href="#1、IDEA：使用-Spring-Initializer快速创建项目" class="headerlink" title="1、IDEA：使用 Spring Initializer快速创建项目"></a>1、IDEA：使用 Spring Initializer快速创建项目</h3><p>IDE都支持使用Spring的项目创建向导快速创建一个Spring Boot项目；</p><p>选择我们需要的模块；向导会联网创建Spring Boot项目；</p><p>默认生成的Spring Boot项目；</p><ul><li>主程序已经生成好了，我们只需要我们自己的逻辑</li><li>resources文件夹中目录结构<ul><li>static：保存所有的静态资源； js css  images；</li><li>templates：保存所有的模板页面；（Spring Boot默认jar包使用嵌入式的Tomcat，默认不支持JSP页面）；可以使用模板引擎（freemarker、thymeleaf）；</li><li>application.properties：Spring Boot应用的配置文件；可以修改一些默认设置；</li></ul></li></ul><h3 id="2、STS使用-Spring-Starter-Project快速创建项目"><a href="#2、STS使用-Spring-Starter-Project快速创建项目" class="headerlink" title="2、STS使用 Spring Starter Project快速创建项目"></a>2、STS使用 Spring Starter Project快速创建项目</h3><hr><h1 id="二、配置文件"><a href="#二、配置文件" class="headerlink" title="二、配置文件"></a>二、配置文件</h1><h2 id="1、配置文件"><a href="#1、配置文件" class="headerlink" title="1、配置文件"></a>1、配置文件</h2><p>SpringBoot使用一个全局的配置文件，配置文件名是固定的；</p><p>•application.properties</p><p>•application.yml</p><p>配置文件的作用：修改SpringBoot自动配置的默认值；SpringBoot在底层都给我们自动配置好；</p><p>YAML（YAML Ain’t Markup Language）</p><p>​    YAML  A Markup Language：是一个标记语言</p><p>​    YAML   isn’t Markup Language：不是一个标记语言；</p><p>标记语言：</p><p>​    以前的配置文件；大多都使用的是  <strong>xxxx.xml</strong>文件；</p><p>​    YAML：<strong>以数据为中心</strong>，比json、xml等更适合做配置文件；</p><p>​    YAML：配置例子</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure><p>​    XML：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">port</span>&gt;</span>8081<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、YAML语法："><a href="#2、YAML语法：" class="headerlink" title="2、YAML语法："></a>2、YAML语法：</h2><h3 id="1、基本语法"><a href="#1、基本语法" class="headerlink" title="1、基本语法"></a>1、基本语法</h3><p>k:(空格)v：表示一对键值对（空格必须有）；</p><p>以<strong>空格</strong>的缩进来控制层级关系；只要是左对齐的一列数据，都是同一个层级的</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/hello</span></span><br></pre></td></tr></table></figure><p>属性和值也是大小写敏感；</p><h3 id="2、值的写法"><a href="#2、值的写法" class="headerlink" title="2、值的写法"></a>2、值的写法</h3><h4 id="字面量：普通的值（数字，字符串，布尔）"><a href="#字面量：普通的值（数字，字符串，布尔）" class="headerlink" title="字面量：普通的值（数字，字符串，布尔）"></a>字面量：普通的值（数字，字符串，布尔）</h4><p>​    k: v：字面直接来写；</p><p>​        字符串默认不用加上单引号或者双引号；</p><p>​        “”：双引号；不会转义字符串里面的特殊字符；特殊字符会作为本身想表示的意思</p><p>​                name:   “zhangsan \n lisi”：输出；zhangsan 换行  lisi</p><p>​        ‘’：单引号；会转义特殊字符，特殊字符最终只是一个普通的字符串数据</p><p>​                name:   ‘zhangsan \n lisi’：输出；zhangsan \n  lisi</p><h4 id="对象、Map（属性和值）（键值对）："><a href="#对象、Map（属性和值）（键值对）：" class="headerlink" title="对象、Map（属性和值）（键值对）："></a>对象、Map（属性和值）（键值对）：</h4><p>​    k: v：在下一行来写对象的属性和值的关系；注意缩进</p><p>​        对象还是k: v的方式</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span></span><br><span class="line"><span class="attr">lastName:</span> <span class="string">zhangsan</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><p>行内写法：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span> &#123;<span class="attr">lastName:</span> <span class="string">zhangsan</span>,<span class="attr">age:</span> <span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="数组（List、Set）："><a href="#数组（List、Set）：" class="headerlink" title="数组（List、Set）："></a>数组（List、Set）：</h4><p>用- 值表示数组中的一个元素</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">pig</span></span><br></pre></td></tr></table></figure><p>行内写法</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span> [<span class="string">cat</span>,<span class="string">dog</span>,<span class="string">pig</span>]</span><br></pre></td></tr></table></figure><h2 id="3、配置文件值注入"><a href="#3、配置文件值注入" class="headerlink" title="3、配置文件值注入"></a>3、配置文件值注入</h2><p>配置文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">    <span class="attr">lastName:</span> <span class="string">hello</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">    <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">birth:</span> <span class="number">2017</span><span class="string">/12/12</span></span><br><span class="line">    <span class="attr">maps:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>,<span class="attr">k2:</span> <span class="number">12</span>&#125;</span><br><span class="line">    <span class="attr">lists:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">lisi</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zhaoliu</span></span><br><span class="line">    <span class="attr">dog:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">小狗</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">12</span></span><br></pre></td></tr></table></figure><p>javaBean：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将配置文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>：告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *      prefix = &quot;person&quot;：配置文件中哪个下面的所有属性进行一一映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器中的组件，才能容器提供的<span class="doctag">@ConfigurationProperties</span>功能；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们可以导入配置文件处理器，以后编写配置就有提示了</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入配置文件处理器，配置文件进行绑定就会有提示--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1、properties配置文件在idea中默认utf-8可能会乱码"><a href="#1、properties配置文件在idea中默认utf-8可能会乱码" class="headerlink" title="1、properties配置文件在idea中默认utf-8可能会乱码"></a>1、properties配置文件在idea中默认utf-8可能会乱码</h4><p>调整</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180130161620.png" alt="idea配置乱码"></p><h4 id="2、-Value获取值和-ConfigurationProperties获取值比较"><a href="#2、-Value获取值和-ConfigurationProperties获取值比较" class="headerlink" title="2、@Value获取值和@ConfigurationProperties获取值比较"></a>2、@Value获取值和@ConfigurationProperties获取值比较</h4><div class="table-container"><table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>功能</td><td>批量注入配置文件中的属性</td><td>一个个指定</td></tr><tr><td>松散绑定（松散语法）</td><td>支持</td><td>不支持</td></tr><tr><td>SpEL</td><td>不支持</td><td>支持</td></tr><tr><td>JSR303数据校验</td><td>支持</td><td>不支持</td></tr><tr><td>复杂类型封装</td><td>支持</td><td>不支持</td></tr></tbody></table></div><p>配置文件yml还是properties他们都能获取到值；</p><p>如果说，我们只是在某个业务逻辑中需要获取一下配置文件中的某项值，使用@Value；</p><p>如果说，我们专门编写了一个javaBean来和配置文件进行映射，我们就直接使用@ConfigurationProperties；</p><h4 id="3、配置文件注入值数据校验"><a href="#3、配置文件注入值数据校验" class="headerlink" title="3、配置文件注入值数据校验"></a>3、配置文件注入值数据校验</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class=&quot;Person&quot;&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name=&quot;lastName&quot; value=&quot;字面量/$&#123;key&#125;从环境变量、配置文件中获取值/#&#123;SpEL&#125;&quot;&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastName必须是邮箱格式</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="comment">//@Value(&quot;$&#123;person.last-name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value(&quot;#&#123;11*2&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value(&quot;true&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></table></figure><h4 id="4、-PropertySource-amp-ImportResource-amp-Bean"><a href="#4、-PropertySource-amp-ImportResource-amp-Bean" class="headerlink" title="4、@PropertySource&amp;@ImportResource&amp;@Bean"></a>4、@PropertySource&amp;@ImportResource&amp;@Bean</h4><p>@<strong>PropertySource</strong>：加载指定的配置文件；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将配置文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>：告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *      prefix = &quot;person&quot;：配置文件中哪个下面的所有属性进行一一映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器中的组件，才能容器提供的<span class="doctag">@ConfigurationProperties</span>功能；</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@ConfigurationProperties</span>(prefix = &quot;person&quot;)默认从全局配置文件中获取值；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PropertySource(value = &#123;&quot;classpath:person.properties&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="comment">//@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class=&quot;Person&quot;&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name=&quot;lastName&quot; value=&quot;字面量/$&#123;key&#125;从环境变量、配置文件中获取值/#&#123;SpEL&#125;&quot;&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastName必须是邮箱格式</span></span><br><span class="line">   <span class="comment">// @Email</span></span><br><span class="line">    <span class="comment">//@Value(&quot;$&#123;person.last-name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value(&quot;#&#123;11*2&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value(&quot;true&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@<strong>ImportResource</strong>：导入Spring的配置文件，让配置文件里面的内容生效；</p><p>Spring Boot里面没有Spring的配置文件，我们自己编写的配置文件，也不能自动识别；</p><p>想让Spring的配置文件生效，加载进来；@<strong>ImportResource</strong>标注在一个配置类上</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(locations = &#123;&quot;classpath:beans.xml&quot;&#125;)</span></span><br><span class="line">导入Spring的配置文件让其生效</span><br></pre></td></tr></table></figure><p>不来编写Spring的配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.springboot.service.HelloService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SpringBoot推荐给容器中添加组件的方式；推荐使用全注解的方式</p><p>1、配置类<strong>@Configuration</strong>———&gt;Spring配置文件</p><p>2、使用<strong>@Bean</strong>给容器中添加组件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span>：指明当前类是一个配置类；就是来替代之前的Spring配置文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 在配置文件中用&lt;bean&gt;&lt;bean/&gt;标签添加组件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将方法的返回值添加到容器中；容器中这个组件默认的id就是方法名</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService02</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;配置类@Bean给容器中添加组件了...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4、配置文件占位符"><a href="#4、配置文件占位符" class="headerlink" title="4、配置文件占位符"></a>4、配置文件占位符</h2><h3 id="1、随机数"><a href="#1、随机数" class="headerlink" title="1、随机数"></a>1、随机数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;random.value&#125;、$&#123;random.<span class="type">int</span>&#125;、$&#123;random.<span class="type">long</span>&#125;</span><br><span class="line">$&#123;random.<span class="type">int</span>(<span class="number">10</span>)&#125;、$&#123;random.<span class="type">int</span>[<span class="number">1024</span>,<span class="number">65536</span>]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2、占位符获取之前配置的值，如果没有可以是用-指定默认值"><a href="#2、占位符获取之前配置的值，如果没有可以是用-指定默认值" class="headerlink" title="2、占位符获取之前配置的值，如果没有可以是用:指定默认值"></a>2、占位符获取之前配置的值，如果没有可以是用:指定默认值</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person.last-name</span>=<span class="string">张三$&#123;random.uuid&#125;</span></span><br><span class="line"><span class="attr">person.age</span>=<span class="string">$&#123;random.int&#125;</span></span><br><span class="line"><span class="attr">person.birth</span>=<span class="string">2017/12/15</span></span><br><span class="line"><span class="attr">person.boss</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">person.maps.k1</span>=<span class="string">v1</span></span><br><span class="line"><span class="attr">person.maps.k2</span>=<span class="string">14</span></span><br><span class="line"><span class="attr">person.lists</span>=<span class="string">a,b,c</span></span><br><span class="line"><span class="attr">person.dog.name</span>=<span class="string">$&#123;person.hello:hello&#125;_dog</span></span><br><span class="line"><span class="attr">person.dog.age</span>=<span class="string">15</span></span><br></pre></td></tr></table></figure><h2 id="5、Profile"><a href="#5、Profile" class="headerlink" title="5、Profile"></a>5、Profile</h2><h3 id="1、多Profile文件"><a href="#1、多Profile文件" class="headerlink" title="1、多Profile文件"></a>1、多Profile文件</h3><p>我们在主配置文件编写的时候，文件名可以是   application-{profile}.properties/yml</p><p>默认使用application.properties的配置；</p><h3 id="2、yml支持多文档块方式"><a href="#2、yml支持多文档块方式" class="headerlink" title="2、yml支持多文档块方式"></a>2、yml支持多文档块方式</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span>  <span class="comment">#指定属于哪个环境</span></span><br></pre></td></tr></table></figure><h3 id="3、激活指定profile"><a href="#3、激活指定profile" class="headerlink" title="3、激活指定profile"></a>3、激活指定profile</h3><p>​    1、在配置文件中指定  spring.profiles.active=dev</p><p>​    2、命令行：</p><p>​        java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar —spring.profiles.active=dev；</p><p>​        可以直接在测试的时候，配置传入命令行参数</p><p>​    3、虚拟机参数；</p><p>​        -Dspring.profiles.active=dev</p><h2 id="6、配置文件加载位置"><a href="#6、配置文件加载位置" class="headerlink" title="6、配置文件加载位置"></a>6、配置文件加载位置</h2><p>springboot 启动会扫描以下位置的application.properties或者application.yml文件作为Spring boot的默认配置文件</p><p>–file:./config/</p><p>–file:./</p><p>–classpath:/config/</p><p>–classpath:/</p><p>优先级由高到底，高优先级的配置会覆盖低优先级的配置；</p><p>SpringBoot会从这四个位置全部加载主配置文件；<strong>互补配置</strong>；</p><p>==我们还可以通过spring.config.location来改变默认的配置文件位置==</p><p><strong>项目打包好以后，我们可以使用命令行参数的形式，启动项目的时候来指定配置文件的新位置；指定配置文件和默认加载的这些配置文件共同起作用形成互补配置；</strong></p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar —spring.config.location=G:/application.properties</p><h2 id="7、外部配置加载顺序"><a href="#7、外部配置加载顺序" class="headerlink" title="7、外部配置加载顺序"></a>7、外部配置加载顺序</h2><p><strong>==SpringBoot也可以从以下位置加载配置； 优先级从高到低；高优先级的配置覆盖低优先级的配置，所有的配置会形成互补配置==</strong></p><p><strong>1.命令行参数</strong></p><p>所有的配置都可以在命令行上进行指定</p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar —server.port=8087  —server.context-path=/abc</p><p>多个配置用空格分开； —配置项=值</p><p>2.来自java:comp/env的JNDI属性</p><p>3.Java系统属性（System.getProperties()）</p><p>4.操作系统环境变量</p><p>5.RandomValuePropertySource配置的random.*属性值</p><p>==<strong>由jar包外向jar包内进行寻找；</strong>==</p><p>==<strong>优先加载带profile</strong>==</p><p><strong>6.jar包外部的application-{profile}.properties或application.yml(带spring.profile)配置文件</strong></p><p><strong>7.jar包内部的application-{profile}.properties或application.yml(带spring.profile)配置文件</strong></p><p>==<strong>再来加载不带profile</strong>==</p><p><strong>8.jar包外部的application.properties或application.yml(不带spring.profile)配置文件</strong></p><p><strong>9.jar包内部的application.properties或application.yml(不带spring.profile)配置文件</strong></p><p>10.@Configuration注解类上的@PropertySource</p><p>11.通过SpringApplication.setDefaultProperties指定的默认属性</p><p>所有支持的配置加载来源；</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#boot-features-external-config">参考官方文档</a></p><h2 id="8、自动配置原理"><a href="#8、自动配置原理" class="headerlink" title="8、自动配置原理"></a>8、自动配置原理</h2><p>配置文件到底能写什么？怎么写？自动配置原理；</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#common-application-properties">配置文件能配置的属性参照</a></p><h3 id="1、自动配置原理："><a href="#1、自动配置原理：" class="headerlink" title="1、自动配置原理："></a>1、<strong>自动配置原理：</strong></h3><p>1）、SpringBoot启动的时候加载主配置类，开启了自动配置功能 ==@EnableAutoConfiguration==</p><p><strong>2）、@EnableAutoConfiguration 作用：</strong></p><ul><li>利用EnableAutoConfigurationImportSelector给容器中导入一些组件？</li></ul><ul><li><p>可以查看selectImports()方法的内容；</p></li><li><p>List<String> configurations = getCandidateConfigurations(annotationMetadata,      attributes);获取候选的配置</p><ul><li><p>```java<br>SpringFactoriesLoader.loadFactoryNames()<br>扫描所有jar包类路径下  META-INF/spring.factories<br>把扫描到的这些文件的内容包装成properties对象<br>从properties中获取到EnableAutoConfiguration.class类（类名）对应的值，然后把他们添加在容器中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">**==将 类路径下  META-INF/spring.factories 里面配置的所有EnableAutoConfiguration的值加入到了容器中；==**</span><br><span class="line"></span><br><span class="line">```properties</span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cloud.CloudAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.elasticsearch.jest.JestAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceDelegatingViewResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.SitePreferenceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.reactor.ReactorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityFilterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.FallbackWebSecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.OAuth2AutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.SocialWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.FacebookAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.LinkedInAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.TwitterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.DispatcherServletAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.EmbeddedServletContainerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpEncodingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpMessageConvertersAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.MultipartAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ServerPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketMessagingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>每一个这样的  xxxAutoConfiguration类都是容器中的一个组件，都加入到容器中；用他们来做自动配置；</p><p>3）、每一个自动配置类进行自动配置功能；</p><p>4）、以<strong>HttpEncodingAutoConfiguration（Http编码自动配置）</strong>为例解释自动配置原理；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//表示这是一个配置类，以前编写的配置文件一样，也可以给容器中添加组件</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HttpEncodingProperties.class)</span>  <span class="comment">//启动指定类的ConfigurationProperties功能；将配置文件中对应的值和HttpEncodingProperties绑定起来；并把HttpEncodingProperties加入到ioc容器中</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//Spring底层@Conditional注解（Spring注解版），根据不同的条件，如果满足指定的条件，整个配置类里面的配置就会生效；    判断当前应用是否是web应用，如果是，当前配置类生效</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnClass(CharacterEncodingFilter.class)</span>  <span class="comment">//判断当前项目有没有这个类CharacterEncodingFilter；SpringMVC中进行乱码解决的过滤器；</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.http.encoding&quot;, value = &quot;enabled&quot;, matchIfMissing = true)</span>  <span class="comment">//判断配置文件中是否存在某个配置  spring.http.encoding.enabled；如果不存在，判断也是成立的</span></span><br><span class="line"><span class="comment">//即使我们配置文件中不配置pring.http.encoding.enabled=true，也是默认生效的；</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpEncodingAutoConfiguration</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//他已经和SpringBoot的配置文件映射了</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> HttpEncodingProperties properties;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">//只有一个有参构造器的情况下，参数的值就会从容器中拿</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">HttpEncodingAutoConfiguration</span><span class="params">(HttpEncodingProperties properties)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.properties = properties;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">//给容器中添加一个组件，这个组件的某些值需要从properties中获取</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(CharacterEncodingFilter.class)</span> <span class="comment">//判断容器没有这个组件？</span></span><br><span class="line"><span class="keyword">public</span> CharacterEncodingFilter <span class="title function_">characterEncodingFilter</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderedCharacterEncodingFilter</span>();</span><br><span class="line">filter.setEncoding(<span class="built_in">this</span>.properties.getCharset().name());</span><br><span class="line">filter.setForceRequestEncoding(<span class="built_in">this</span>.properties.shouldForce(Type.REQUEST));</span><br><span class="line">filter.setForceResponseEncoding(<span class="built_in">this</span>.properties.shouldForce(Type.RESPONSE));</span><br><span class="line"><span class="keyword">return</span> filter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据当前不同的条件判断，决定这个配置类是否生效？</p><p>一但这个配置类生效；这个配置类就会给容器中添加各种组件；这些组件的属性是从对应的properties类中获取的，这些类里面的每一个属性又是和配置文件绑定的；</p><p>5）、所有在配置文件中能配置的属性都是在xxxxProperties类中封装者‘；配置文件能配置什么就可以参照某个功能对应的这个属性类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.http.encoding&quot;)</span>  <span class="comment">//从配置文件中获取指定的值和bean的属性进行绑定</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpEncodingProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_CHARSET</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>精髓：</strong></p><p>​    <strong>1）、SpringBoot启动会加载大量的自动配置类</strong></p><p>​    <strong>2）、我们看我们需要的功能有没有SpringBoot默认写好的自动配置类；</strong></p><p>​    <strong>3）、我们再来看这个自动配置类中到底配置了哪些组件；（只要我们要用的组件有，我们就不需要再来配置了）</strong></p><p>​    <strong>4）、给容器中自动配置类添加组件的时候，会从properties类中获取某些属性。我们就可以在配置文件中指定这些属性的值；</strong></p><p>xxxxAutoConfigurartion：自动配置类；</p><p>给容器中添加组件</p><p>xxxxProperties:封装配置文件中相关属性；</p><h3 id="2、细节"><a href="#2、细节" class="headerlink" title="2、细节"></a>2、细节</h3><h4 id="1、-Conditional派生注解（Spring注解版原生的-Conditional作用）"><a href="#1、-Conditional派生注解（Spring注解版原生的-Conditional作用）" class="headerlink" title="1、@Conditional派生注解（Spring注解版原生的@Conditional作用）"></a>1、@Conditional派生注解（Spring注解版原生的@Conditional作用）</h4><p>作用：必须是@Conditional指定的条件成立，才给容器中添加组件，配置配里面的所有内容才生效；</p><div class="table-container"><table><thead><tr><th>@Conditional扩展注解</th><th>作用（判断是否满足当前指定条件）</th></tr></thead><tbody><tr><td>@ConditionalOnJava</td><td>系统的java版本是否符合要求</td></tr><tr><td>@ConditionalOnBean</td><td>容器中存在指定Bean；</td></tr><tr><td>@ConditionalOnMissingBean</td><td>容器中不存在指定Bean；</td></tr><tr><td>@ConditionalOnExpression</td><td>满足SpEL表达式指定</td></tr><tr><td>@ConditionalOnClass</td><td>系统中有指定的类</td></tr><tr><td>@ConditionalOnMissingClass</td><td>系统中没有指定的类</td></tr><tr><td>@ConditionalOnSingleCandidate</td><td>容器中只有一个指定的Bean，或者这个Bean是首选Bean</td></tr><tr><td>@ConditionalOnProperty</td><td>系统中指定的属性是否有指定的值</td></tr><tr><td>@ConditionalOnResource</td><td>类路径下是否存在指定资源文件</td></tr><tr><td>@ConditionalOnWebApplication</td><td>当前是web环境</td></tr><tr><td>@ConditionalOnNotWebApplication</td><td>当前不是web环境</td></tr><tr><td>@ConditionalOnJndi</td><td>JNDI存在指定项</td></tr></tbody></table></div><p><strong>自动配置类必须在一定的条件下才能生效；</strong></p><p>我们怎么知道哪些自动配置类生效；</p><p><strong>==我们可以通过启用  debug=true属性；来让控制台打印自动配置报告==</strong>，这样我们就可以很方便的知道哪些自动配置类生效；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">=========================</span><br><span class="line">AUTO-CONFIGURATION REPORT</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Positive matches:（自动配置类启用的）</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   DispatcherServletAutoConfiguration matched:</span><br><span class="line">      - <span class="meta">@ConditionalOnClass</span> found required class <span class="string">&#x27;org.springframework.web.servlet.DispatcherServlet&#x27;</span>; <span class="meta">@ConditionalOnMissingClass</span> did not find unwanted <span class="title function_">class</span> <span class="params">(OnClassCondition)</span></span><br><span class="line">      - <span class="meta">@ConditionalOnWebApplication</span> (required) found <span class="title function_">StandardServletEnvironment</span> <span class="params">(OnWebApplicationCondition)</span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">Negative matches:（没有启动，没有匹配成功的自动配置类）</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   ActiveMQAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - <span class="meta">@ConditionalOnClass</span> did not find required classes <span class="string">&#x27;javax.jms.ConnectionFactory&#x27;</span>, <span class="string">&#x27;org.apache.activemq.ActiveMQConnectionFactory&#x27;</span> (OnClassCondition)</span><br><span class="line"></span><br><span class="line">   AopAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - <span class="meta">@ConditionalOnClass</span> did not find required classes <span class="string">&#x27;org.aspectj.lang.annotation.Aspect&#x27;</span>, <span class="string">&#x27;org.aspectj.lang.reflect.Advice&#x27;</span> (OnClassCondition)</span><br><span class="line">        </span><br></pre></td></tr></table></figure><h1 id="三、日志"><a href="#三、日志" class="headerlink" title="三、日志"></a>三、日志</h1><h2 id="1、日志框架"><a href="#1、日志框架" class="headerlink" title="1、日志框架"></a>1、日志框架</h2><p> 小张；开发一个大型系统；</p><p>​        1、System.out.println(“”)；将关键数据打印在控制台；去掉？写在一个文件？</p><p>​        2、框架来记录系统的一些运行时信息；日志框架 ；  zhanglogging.jar；</p><p>​        3、高大上的几个功能？异步模式？自动归档？xxxx？  zhanglogging-good.jar？</p><p>​        4、将以前框架卸下来？换上新的框架，重新修改之前相关的API；zhanglogging-prefect.jar；</p><p>​        5、JDBC—-数据库驱动；</p><p>​            写了一个统一的接口层；日志门面（日志的一个抽象层）；logging-abstract.jar；</p><p>​            给项目中导入具体的日志实现就行了；我们之前的日志框架都是实现的抽象层；</p><p><strong>市面上的日志框架；</strong></p><p>JUL、JCL、Jboss-logging、logback、log4j、log4j2、slf4j….</p><div class="table-container"><table><thead><tr><th>日志门面  （日志的抽象层）</th><th>日志实现</th></tr></thead><tbody><tr><td><del>JCL（Jakarta  Commons Logging）</del>    SLF4j（Simple  Logging Facade for Java）    <strong><del>jboss-logging</del></strong></td><td>Log4j  JUL（java.util.logging）  Log4j2  <strong>Logback</strong></td></tr></tbody></table></div><p>左边选一个门面（抽象层）、右边来选一个实现；</p><p>日志门面：  SLF4J；</p><p>日志实现：Logback；</p><p>SpringBoot：底层是Spring框架，Spring框架默认是用JCL；‘</p><p>​    <strong>==SpringBoot选用 SLF4j和logback；==</strong></p><h2 id="2、SLF4j使用"><a href="#2、SLF4j使用" class="headerlink" title="2、SLF4j使用"></a>2、SLF4j使用</h2><h3 id="1、如何在系统中使用SLF4j-https-www-slf4j-org"><a href="#1、如何在系统中使用SLF4j-https-www-slf4j-org" class="headerlink" title="1、如何在系统中使用SLF4j   https://www.slf4j.org"></a>1、如何在系统中使用SLF4j   <a href="https://www.slf4j.org">https://www.slf4j.org</a></h3><p>以后开发的时候，日志记录方法的调用，不应该来直接调用日志的实现类，而是调用日志抽象层里面的方法；</p><p>给系统里面导入slf4j的jar和  logback的实现jar</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(HelloWorld.class);</span><br><span class="line">    logger.info(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>图示；</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/concrete-bindings.png" alt="images/concrete-bindings.png"></p><p>每一个日志的实现框架都有自己的配置文件。使用slf4j以后，<strong>配置文件还是做成日志实现框架自己本身的配置文件；</strong></p><h3 id="2、遗留问题"><a href="#2、遗留问题" class="headerlink" title="2、遗留问题"></a>2、遗留问题</h3><p>a（slf4j+logback）: Spring（commons-logging）、Hibernate（jboss-logging）、MyBatis、xxxx</p><p>统一日志记录，即使是别的框架和我一起统一使用slf4j进行输出？</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/legacy.png" alt=""></p><p><strong>如何让系统中所有的日志都统一到slf4j；</strong></p><p>==1、将系统中其他日志框架先排除出去；==</p><p>==2、用中间包来替换原有的日志框架；==</p><p>==3、我们导入slf4j其他的实现==</p><h2 id="3、SpringBoot日志关系"><a href="#3、SpringBoot日志关系" class="headerlink" title="3、SpringBoot日志关系"></a>3、SpringBoot日志关系</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SpringBoot使用它来做日志功能；</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>底层依赖关系</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131220946.png" alt=""></p><p>总结：</p><p>​    1）、SpringBoot底层也是使用slf4j+logback的方式进行日志记录</p><p>​    2）、SpringBoot也把其他的日志都替换成了slf4j；</p><p>​    3）、中间替换包？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">LogFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J</span> <span class="operator">=</span> <span class="string">&quot;http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">LogFactory</span> <span class="variable">logFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SLF4JLogFactory</span>();</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131221411.png" alt=""></p><p>​    4）、如果我们要引入其他框架？一定要把这个框架的默认日志依赖移除掉？</p><p>​            Spring框架用的是commons-logging；</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>==SpringBoot能自动适配所有的日志，而且底层使用slf4j+logback的方式记录日志，引入其他框架的时候，只需要把这个框架依赖的日志框架排除掉即可；==</strong></p><h2 id="4、日志使用；"><a href="#4、日志使用；" class="headerlink" title="4、日志使用；"></a>4、日志使用；</h2><h3 id="1、默认配置"><a href="#1、默认配置" class="headerlink" title="1、默认配置"></a>1、默认配置</h3><p>SpringBoot默认帮我们配置好了日志；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//记录器</span></span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//System.out.println();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//日志的级别；</span></span><br><span class="line"><span class="comment">//由低到高   trace&lt;debug&lt;info&lt;warn&lt;error</span></span><br><span class="line"><span class="comment">//可以调整输出的日志级别；日志就只会在这个级别以以后的高级别生效</span></span><br><span class="line">logger.trace(<span class="string">&quot;这是trace日志...&quot;</span>);</span><br><span class="line">logger.debug(<span class="string">&quot;这是debug日志...&quot;</span>);</span><br><span class="line"><span class="comment">//SpringBoot默认给我们使用的是info级别的，没有指定级别的就用SpringBoot默认规定的级别；root级别</span></span><br><span class="line">logger.info(<span class="string">&quot;这是info日志...&quot;</span>);</span><br><span class="line">logger.warn(<span class="string">&quot;这是warn日志...&quot;</span>);</span><br><span class="line">logger.error(<span class="string">&quot;这是error日志...&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>    日志输出格式：        %d表示日期时间，        %thread表示线程名，        %-5level：级别从左显示5个字符宽度        %logger&#123;50&#125; 表示logger名字最长50个字符，否则按照句点分割。         %msg：日志消息，        %n是换行符    --&gt;    %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</code></pre><p>SpringBoot修改日志的默认配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.level.com.atguigu</span>=<span class="string">trace</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#logging.path=</span></span><br><span class="line"><span class="comment"># 不指定路径在当前项目下生成springboot.log日志</span></span><br><span class="line"><span class="comment"># 可以指定完整的路径；</span></span><br><span class="line"><span class="comment">#logging.file=G:/springboot.log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 在当前磁盘的根路径下创建spring文件夹和里面的log文件夹；使用 spring.log 作为默认文件</span></span><br><span class="line"><span class="attr">logging.path</span>=<span class="string">/spring/log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#  在控制台输出的日志的格式</span></span><br><span class="line"><span class="attr">logging.pattern.console</span>=<span class="string">%d&#123;yyyy-MM-dd&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span></span><br><span class="line"><span class="comment"># 指定文件中日志输出的格式</span></span><br><span class="line"><span class="attr">logging.pattern.file</span>=<span class="string">%d&#123;yyyy-MM-dd&#125; === [%thread] === %-5level === %logger&#123;50&#125; ==== %msg%n</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>logging.file</th><th>logging.path</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>(none)</td><td>(none)</td><td></td><td>只在控制台输出</td></tr><tr><td>指定文件名</td><td>(none)</td><td>my.log</td><td>输出日志到my.log文件</td></tr><tr><td>(none)</td><td>指定目录</td><td>/var/log</td><td>输出到指定目录的 spring.log 文件中</td></tr></tbody></table></div><h3 id="2、指定配置"><a href="#2、指定配置" class="headerlink" title="2、指定配置"></a>2、指定配置</h3><p>给类路径下放上每个日志框架自己的配置文件即可；SpringBoot就不使用他默认配置的了</p><div class="table-container"><table><thead><tr><th>Logging System</th><th>Customization</th></tr></thead><tbody><tr><td>Logback</td><td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td></tr><tr><td>Log4j2</td><td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td></tr><tr><td>JDK (Java Util Logging)</td><td><code>logging.properties</code></td></tr></tbody></table></div><p>logback.xml：直接就被日志框架识别了；</p><p><strong>logback-spring.xml</strong>：日志框架就不直接加载日志的配置项，由SpringBoot解析日志配置，可以使用SpringBoot的高级Profile功能</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;staging&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span></span><br><span class="line">  可以指定某段配置只在某个环境下生效</span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;stdout&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        日志输出格式：</span></span><br><span class="line"><span class="comment">%d表示日期时间，</span></span><br><span class="line"><span class="comment">%thread表示线程名，</span></span><br><span class="line"><span class="comment">%-5level：级别从左显示5个字符宽度</span></span><br><span class="line"><span class="comment">%logger&#123;50&#125; 表示logger名字最长50个字符，否则按照句点分割。 </span></span><br><span class="line"><span class="comment">%msg：日志消息，</span></span><br><span class="line"><span class="comment">%n是换行符</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ----&gt; [%thread] ---&gt; %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;!dev&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ==== [%thread] ==== %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果使用logback.xml作为日志配置文件，还要使用profile功能，会有以下错误</p><p> <code>no applicable action for [springProfile]</code></p><h2 id="5、切换日志框架"><a href="#5、切换日志框架" class="headerlink" title="5、切换日志框架"></a>5、切换日志框架</h2><p>可以按照slf4j的日志适配图，进行相关的切换；</p><p>slf4j+log4j的方式；</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>切换为log4j2</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h1 id="四、Web开发"><a href="#四、Web开发" class="headerlink" title="四、Web开发"></a>四、Web开发</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><p>使用SpringBoot；</p><p><strong>1）、创建SpringBoot应用，选中我们需要的模块；</strong></p><p><strong>2）、SpringBoot已经默认将这些场景配置好了，只需要在配置文件中指定少量配置就可以运行起来</strong></p><p><strong>3）、自己编写业务代码；</strong></p><p><strong>自动配置原理？</strong></p><p>这个场景SpringBoot帮我们配置了什么？能不能修改？能修改哪些配置？能不能扩展？xxx</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxAutoConfiguration：帮我们给容器中自动配置组件；</span><br><span class="line">xxxxProperties:配置类来封装配置文件的内容；</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2、SpringBoot对静态资源的映射规则；"><a href="#2、SpringBoot对静态资源的映射规则；" class="headerlink" title="2、SpringBoot对静态资源的映射规则；"></a>2、SpringBoot对静态资源的映射规则；</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.resources&quot;, ignoreUnknownFields = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceProperties</span> <span class="keyword">implements</span> <span class="title class_">ResourceLoaderAware</span> &#123;</span><br><span class="line">  <span class="comment">//可以设置和静态资源有关的参数，缓存时间等</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">WebMvcAuotConfiguration：</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">cachePeriod</span> <span class="operator">=</span> <span class="built_in">this</span>.resourceProperties.getCachePeriod();</span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">&quot;/webjars/**&quot;</span>)) &#123;</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>)</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">String</span> <span class="variable">staticPathPattern</span> <span class="operator">=</span> <span class="built_in">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">         <span class="comment">//静态资源文件夹映射</span></span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(staticPathPattern)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="built_in">this</span>.resourceProperties.getStaticLocations())</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//配置欢迎页映射</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(</span></span><br><span class="line"><span class="params">ResourceProperties resourceProperties)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(resourceProperties.getWelcomePage(),</span><br><span class="line"><span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//配置喜欢的图标</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(value = &quot;spring.mvc.favicon.enabled&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FaviconConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ResourceProperties resourceProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">FaviconConfiguration</span><span class="params">(ResourceProperties resourceProperties)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.resourceProperties = resourceProperties;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SimpleUrlHandlerMapping <span class="title function_">faviconHandlerMapping</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SimpleUrlHandlerMapping</span> <span class="variable">mapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleUrlHandlerMapping</span>();</span><br><span class="line">mapping.setOrder(Ordered.HIGHEST_PRECEDENCE + <span class="number">1</span>);</span><br><span class="line">             <span class="comment">//所有  **/favicon.ico </span></span><br><span class="line">mapping.setUrlMap(Collections.singletonMap(<span class="string">&quot;**/favicon.ico&quot;</span>,</span><br><span class="line">faviconRequestHandler()));</span><br><span class="line"><span class="keyword">return</span> mapping;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ResourceHttpRequestHandler <span class="title function_">faviconRequestHandler</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">ResourceHttpRequestHandler</span> <span class="variable">requestHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceHttpRequestHandler</span>();</span><br><span class="line">requestHandler</span><br><span class="line">.setLocations(<span class="built_in">this</span>.resourceProperties.getFaviconLocations());</span><br><span class="line"><span class="keyword">return</span> requestHandler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>==1）、所有 /webjars/** ，都去 classpath:/META-INF/resources/webjars/ 找资源；==</p><p>​    webjars：以jar包的方式引入静态资源；</p><p><a href="http://www.webjars.org/">http://www.webjars.org/</a></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180203181751.png" alt=""></p><p>localhost:8080/webjars/jquery/3.3.1/jquery.js</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入jquery-webjar--&gt;</span>在访问的时候只需要写webjars下面资源的名称即可</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>==2）、”/**” 访问当前项目的任何资源，都去（静态资源的文件夹）找映射==</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;classpath:/META-INF/resources/&quot;, </span><br><span class="line">&quot;classpath:/resources/&quot;,</span><br><span class="line">&quot;classpath:/static/&quot;, </span><br><span class="line">&quot;classpath:/public/&quot; </span><br><span class="line">&quot;/&quot;：当前项目的根路径</span><br></pre></td></tr></table></figure><p>localhost:8080/abc ===  去静态资源文件夹里面找abc</p><p>==3）、欢迎页； 静态资源文件夹下的所有index.html页面；被”/**”映射；==</p><p>​    localhost:8080/   找index页面</p><p>==4）、所有的 **/favicon.ico  都是在静态资源文件下找；==</p><h2 id="3、模板引擎"><a href="#3、模板引擎" class="headerlink" title="3、模板引擎"></a>3、模板引擎</h2><p>JSP、Velocity、Freemarker、Thymeleaf</p><p><img src="images/template-engine.png" alt=""></p><p>SpringBoot推荐的Thymeleaf；</p><p>语法更简单，功能更强大；</p><h3 id="1、引入thymeleaf；"><a href="#1、引入thymeleaf；" class="headerlink" title="1、引入thymeleaf；"></a>1、引入thymeleaf；</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          2.1.6</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">切换thymeleaf版本</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.9.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 布局功能的支持程序  thymeleaf3主程序  layout2以上版本 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- thymeleaf2   layout1--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2、Thymeleaf使用"><a href="#2、Thymeleaf使用" class="headerlink" title="2、Thymeleaf使用"></a>2、Thymeleaf使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.thymeleaf&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_ENCODING</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">MimeType</span> <span class="variable">DEFAULT_CONTENT_TYPE</span> <span class="operator">=</span> MimeType.valueOf(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_SUFFIX</span> <span class="operator">=</span> <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">  <span class="comment">//</span></span><br></pre></td></tr></table></figure><p>只要我们把HTML页面放在classpath:/templates/，thymeleaf就能自动渲染；</p><p>使用：</p><p>1、导入thymeleaf的名称空间</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、使用thymeleaf语法；</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>成功！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--th:text 将div里面的文本内容设置为 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;hello&#125;&quot;</span>&gt;</span>这是显示欢迎信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3、语法规则"><a href="#3、语法规则" class="headerlink" title="3、语法规则"></a>3、语法规则</h3><p>1）、th:text；改变当前元素里面的文本内容；</p><p>​    th：任意html属性；来替换原生属性的值</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/2018-02-04_123955.png" alt=""></p><p>2）、表达式？</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Simple</span> <span class="string">expressions:（表达式语法）</span></span><br><span class="line">    <span class="attr">Variable</span> <span class="string">Expressions: $&#123;...&#125;：获取变量值；OGNL；</span></span><br><span class="line">    <span class="attr">1）、获取对象的属性、调用方法</span></span><br><span class="line">    <span class="attr">2）、使用内置的基本对象：</span></span><br><span class="line"><span class="comment">    #ctx : the context object.</span></span><br><span class="line"><span class="comment">    #vars: the context variables.</span></span><br><span class="line"><span class="comment">                #locale : the context locale.</span></span><br><span class="line"><span class="comment">                #request : (only in Web Contexts) the HttpServletRequest object.</span></span><br><span class="line"><span class="comment">                #response : (only in Web Contexts) the HttpServletResponse object.</span></span><br><span class="line"><span class="comment">                #session : (only in Web Contexts) the HttpSession object.</span></span><br><span class="line"><span class="comment">                #servletContext : (only in Web Contexts) the ServletContext object.</span></span><br><span class="line">                </span><br><span class="line">                <span class="attr">$&#123;session.foo&#125;</span></span><br><span class="line">            <span class="attr">3）、内置的一些工具对象：</span></span><br><span class="line"><span class="comment">#execInfo : information about the template being processed.</span></span><br><span class="line"><span class="comment">#messages : methods for obtaining externalized messages inside variables expressions, in the same way as they would be obtained using #&#123;…&#125; syntax.</span></span><br><span class="line"><span class="comment">#uris : methods for escaping parts of URLs/URIs</span></span><br><span class="line"><span class="comment">#conversions : methods for executing the configured conversion service (if any).</span></span><br><span class="line"><span class="comment">#dates : methods for java.util.Date objects: formatting, component extraction, etc.</span></span><br><span class="line"><span class="comment">#calendars : analogous to #dates , but for java.util.Calendar objects.</span></span><br><span class="line"><span class="comment">#numbers : methods for formatting numeric objects.</span></span><br><span class="line"><span class="comment">#strings : methods for String objects: contains, startsWith, prepending/appending, etc.</span></span><br><span class="line"><span class="comment">#objects : methods for objects in general.</span></span><br><span class="line"><span class="comment">#bools : methods for boolean evaluation.</span></span><br><span class="line"><span class="comment">#arrays : methods for arrays.</span></span><br><span class="line"><span class="comment">#lists : methods for lists.</span></span><br><span class="line"><span class="comment">#sets : methods for sets.</span></span><br><span class="line"><span class="comment">#maps : methods for maps.</span></span><br><span class="line"><span class="comment">#aggregates : methods for creating aggregates on arrays or collections.</span></span><br><span class="line"><span class="comment">#ids : methods for dealing with id attributes that might be repeated (for example, as a result of an iteration).</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Selection</span> <span class="string">Variable Expressions: *&#123;...&#125;：选择表达式：和$&#123;&#125;在功能上是一样；</span></span><br><span class="line">    <span class="attr">补充：配合</span> <span class="string">th:object=&quot;$&#123;session.user&#125;：</span></span><br><span class="line">   <span class="attr">&lt;div</span> <span class="string">th:object=&quot;$&#123;session.user&#125;&quot;&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Name</span>: <span class="string">&lt;span th:text=&quot;*&#123;firstName&#125;&quot;&gt;Sebastian&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Surname</span>: <span class="string">&lt;span th:text=&quot;*&#123;lastName&#125;&quot;&gt;Pepper&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Nationality</span>: <span class="string">&lt;span th:text=&quot;*&#123;nationality&#125;&quot;&gt;Saturn&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">Message</span> <span class="string">Expressions: #&#123;...&#125;：获取国际化内容</span></span><br><span class="line">    <span class="attr">Link</span> <span class="string">URL Expressions: @&#123;...&#125;：定义URL；</span></span><br><span class="line">    <span class="attr">@&#123;/order/process(execId</span>=<span class="string">$&#123;execId&#125;,execType=&#x27;FAST&#x27;)&#125;</span></span><br><span class="line">    <span class="attr">Fragment</span> <span class="string">Expressions: ~&#123;...&#125;：片段引用表达式</span></span><br><span class="line">    <span class="attr">&lt;div</span> <span class="string">th:insert=&quot;~&#123;commons :: main&#125;&quot;&gt;...&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">Literals（字面量）</span></span><br><span class="line">      <span class="attr">Text</span> <span class="string">literals: &#x27;one text&#x27; , &#x27;Another one!&#x27; ,…</span></span><br><span class="line">      <span class="attr">Number</span> <span class="string">literals: 0 , 34 , 3.0 , 12.3 ,…</span></span><br><span class="line">      <span class="attr">Boolean</span> <span class="string">literals: true , false</span></span><br><span class="line">      <span class="attr">Null</span> <span class="string">literal: null</span></span><br><span class="line">      <span class="attr">Literal</span> <span class="string">tokens: one , sometext , main ,…</span></span><br><span class="line"><span class="attr">Text</span> <span class="string">operations:（文本操作）</span></span><br><span class="line">    <span class="attr">String</span> <span class="string">concatenation: +</span></span><br><span class="line">    <span class="attr">Literal</span> <span class="string">substitutions: |The name is $&#123;name&#125;|</span></span><br><span class="line"><span class="attr">Arithmetic</span> <span class="string">operations:（数学运算）</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: + , - , * , / , %</span></span><br><span class="line">    <span class="attr">Minus</span> <span class="string">sign (unary operator): -</span></span><br><span class="line"><span class="attr">Boolean</span> <span class="string">operations:（布尔运算）</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: and , or</span></span><br><span class="line">    <span class="attr">Boolean</span> <span class="string">negation (unary operator): ! , not</span></span><br><span class="line"><span class="attr">Comparisons</span> <span class="string">and equality:（比较运算）</span></span><br><span class="line">    <span class="attr">Comparators</span>: <span class="string">&gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span></span><br><span class="line">    <span class="attr">Equality</span> <span class="string">operators: == , != ( eq , ne )</span></span><br><span class="line"><span class="attr">Conditional</span> <span class="string">operators:条件运算（三元运算符）</span></span><br><span class="line">    <span class="attr">If-then</span>: <span class="string">(if) ? (then)</span></span><br><span class="line">    <span class="attr">If-then-else</span>: <span class="string">(if) ? (then) : (else)</span></span><br><span class="line">    <span class="attr">Default</span>: <span class="string">(value) ?: (defaultvalue)</span></span><br><span class="line"><span class="attr">Special</span> <span class="string">tokens:</span></span><br><span class="line">    <span class="attr">No-Operation</span>: <span class="string">_ </span></span><br></pre></td></tr></table></figure><h2 id="4、SpringMVC自动配置"><a href="#4、SpringMVC自动配置" class="headerlink" title="4、SpringMVC自动配置"></a>4、SpringMVC自动配置</h2><p><a href="https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications">https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications</a></p><h3 id="1-Spring-MVC-auto-configuration"><a href="#1-Spring-MVC-auto-configuration" class="headerlink" title="1. Spring MVC auto-configuration"></a>1. Spring MVC auto-configuration</h3><p>Spring Boot 自动配置好了SpringMVC</p><p>以下是SpringBoot对SpringMVC的默认配置:<strong>==（WebMvcAutoConfiguration）==</strong></p><ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p><ul><li>自动配置了ViewResolver（视图解析器：根据方法的返回值得到视图对象（View），视图对象决定如何渲染（转发？重定向？））</li><li>ContentNegotiatingViewResolver：组合所有的视图解析器的；</li><li>==如何定制：我们可以自己给容器中添加一个视图解析器；自动的将其组合进来；==</li></ul></li><li><p>Support for serving static resources, including support for WebJars (see below).静态资源文件夹路径,webjars</p></li><li><p>Static <code>index.html</code> support. 静态首页访问</p></li><li><p>Custom <code>Favicon</code> support (see below).  favicon.ico</p></li></ul><ul><li><p>自动注册了 of <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> beans.</p><ul><li>Converter：转换器；  public String hello(User user)：类型转换使用Converter</li><li><code>Formatter</code>  格式化器；  2017.12.17===Date；</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc&quot;, name = &quot;date-format&quot;)</span><span class="comment">//在文件中配置日期格式化的规则</span></span><br><span class="line"><span class="keyword">public</span> Formatter&lt;Date&gt; <span class="title function_">dateFormatter</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DateFormatter</span>(<span class="built_in">this</span>.mvcProperties.getDateFormat());<span class="comment">//日期格式化组件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    ==自己添加的格式化器转换器，我们只需要放在容器中即可==</p><ul><li><p>Support for <code>HttpMessageConverters</code> (see below).</p><ul><li><p>HttpMessageConverter：SpringMVC用来转换Http请求和响应的；User—-Json；</p></li><li><p><code>HttpMessageConverters</code> 是从容器中确定；获取所有的HttpMessageConverter；</p><p>==自己给容器中添加HttpMessageConverter，只需要将自己的组件注册容器中（@Bean,@Component）==</p></li></ul></li></ul><ul><li><p>Automatic registration of <code>MessageCodesResolver</code> (see below).定义错误代码生成规则</p></li><li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (see below).</p><p>==我们可以配置一个ConfigurableWebBindingInitializer来替换默认的；（添加到容器）==</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">初始化WebDataBinder；</span><br><span class="line">请求数据=====JavaBean；</span><br></pre></td></tr></table></figure></li></ul><p><strong>org.springframework.boot.autoconfigure.web：web的所有自动场景；</strong></p><p>If you want to keep Spring Boot MVC features, and you just want to add additional <a href="https://docs.spring.io/spring/docs/4.3.14.RELEASE/spring-framework-reference/htmlsingle#mvc">MVC configuration</a> (interceptors, formatters, view controllers etc.) you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurerAdapter</code>, but <strong>without</strong> <code>@EnableWebMvc</code>. If you wish to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code> or <code>ExceptionHandlerExceptionResolver</code> you can declare a <code>WebMvcRegistrationsAdapter</code> instance providing such components.</p><p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>.</p><h3 id="2、扩展SpringMVC"><a href="#2、扩展SpringMVC" class="headerlink" title="2、扩展SpringMVC"></a>2、扩展SpringMVC</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/hello&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;success&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/hello&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>==编写一个配置类（@Configuration），是WebMvcConfigurerAdapter类型；不能标注@EnableWebMvc==</strong>;</p><p>既保留了所有的自动配置，也能用我们扩展的配置；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/atguigu&quot;</span>).setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原理：</p><p>​    1）、WebMvcAutoConfiguration是SpringMVC的自动配置类</p><p>​    2）、在做其他自动配置时会导入；@Import(<strong>EnableWebMvcConfiguration</strong>.class)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">DelegatingWebMvcConfiguration</span> &#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WebMvcConfigurerComposite</span> <span class="variable">configurers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerComposite</span>();</span><br><span class="line"></span><br><span class="line"> <span class="comment">//从容器中获取所有的WebMvcConfigurer</span></span><br><span class="line">     <span class="meta">@Autowired(required = false)</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">             <span class="built_in">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">           <span class="comment">//一个参考实现；将所有的WebMvcConfigurer相关配置都来一起调用；  </span></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">// public void addViewControllers(ViewControllerRegistry registry) &#123;</span></span><br><span class="line">             <span class="comment">//    for (WebMvcConfigurer delegate : this.delegates) &#123;</span></span><br><span class="line">              <span class="comment">//       delegate.addViewControllers(registry);</span></span><br><span class="line">              <span class="comment">//   &#125;</span></span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    3）、容器中所有的WebMvcConfigurer都会一起起作用；</p><p>​    4）、我们的配置类也会被调用；</p><p>​    效果：SpringMVC的自动配置和我们的扩展配置都会起作用；</p><h3 id="3、全面接管SpringMVC；"><a href="#3、全面接管SpringMVC；" class="headerlink" title="3、全面接管SpringMVC；"></a>3、全面接管SpringMVC；</h3><p>SpringBoot对SpringMVC的自动配置不需要了，所有都是我们自己配置；所有的SpringMVC的自动配置都失效了</p><p><strong>我们需要在配置类中添加@EnableWebMvc即可；</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/atguigu&quot;</span>).setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原理：</p><p>为什么@EnableWebMvc自动配置就失效了；</p><p>1）@EnableWebMvc的核心</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(DelegatingWebMvcConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableWebMvc &#123;</span><br></pre></td></tr></table></figure><p>2）、</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br></pre></td></tr></table></figure><p>3）、</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class,</span></span><br><span class="line"><span class="meta">WebMvcConfigurerAdapter.class &#125;)</span></span><br><span class="line"><span class="comment">//容器中没有这个组件的时候，这个自动配置类才生效</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;</span><br></pre></td></tr></table></figure><p>4）、@EnableWebMvc将WebMvcConfigurationSupport组件导入进来；</p><p>5）、导入的WebMvcConfigurationSupport只是SpringMVC最基本的功能；</p><h2 id="5、如何修改SpringBoot的默认配置"><a href="#5、如何修改SpringBoot的默认配置" class="headerlink" title="5、如何修改SpringBoot的默认配置"></a>5、如何修改SpringBoot的默认配置</h2><p>模式：</p><p>​    1）、SpringBoot在自动配置很多组件的时候，先看容器中有没有用户自己配置的（@Bean、@Component）如果有就用用户配置的，如果没有，才自动配置；如果有些组件可以有多个（ViewResolver）将用户配置的和自己默认的组合起来；</p><p>​    2）、在SpringBoot中会有非常多的xxxConfigurer帮助我们进行扩展配置</p><p>​    3）、在SpringBoot中会有很多的xxxCustomizer帮助我们进行定制配置</p><h2 id="6、RestfulCRUD"><a href="#6、RestfulCRUD" class="headerlink" title="6、RestfulCRUD"></a>6、RestfulCRUD</h2><h3 id="1）、默认访问首页"><a href="#1）、默认访问首页" class="headerlink" title="1）、默认访问首页"></a>1）、默认访问首页</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="comment">//@EnableWebMvc   不要接管SpringMVC</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/atguigu&quot;</span>).setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//所有的WebMvcConfigurerAdapter组件都会一起起作用</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//将组件注册在容器</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title function_">webMvcConfigurerAdapter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">WebMvcConfigurerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerAdapter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">                registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">                registry.addViewController(<span class="string">&quot;/index.html&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> adapter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2）、国际化"><a href="#2）、国际化" class="headerlink" title="2）、国际化"></a>2）、国际化</h3><p><strong>1）、编写国际化配置文件；</strong></p><p>2）、使用ResourceBundleMessageSource管理国际化资源文件</p><p>3）、在页面使用fmt:message取出国际化内容</p><p>步骤：</p><p>1）、编写国际化配置文件，抽取页面需要显示的国际化消息</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211130721.png" alt=""></p><p>2）、SpringBoot自动配置好了管理国际化资源文件的组件；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.messages&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageSourceAutoConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Comma-separated list of basenames (essentially a fully-qualified classpath</span></span><br><span class="line"><span class="comment"> * location), each following the ResourceBundle convention with relaxed support for</span></span><br><span class="line"><span class="comment"> * slash based locations. If it doesn&#x27;t contain a package qualifier (such as</span></span><br><span class="line"><span class="comment"> * &quot;org.mypackage&quot;), it will be resolved from the classpath root.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">basename</span> <span class="operator">=</span> <span class="string">&quot;messages&quot;</span>;  </span><br><span class="line">    <span class="comment">//我们的配置文件可以直接放在类路径下叫messages.properties；</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageSource <span class="title function_">messageSource</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">ResourceBundleMessageSource</span> <span class="variable">messageSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceBundleMessageSource</span>();</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.basename)) &#123;</span><br><span class="line">            <span class="comment">//设置国际化资源文件的基础名（去掉语言国家代码的）</span></span><br><span class="line">messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">StringUtils.trimAllWhitespace(<span class="built_in">this</span>.basename)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.encoding != <span class="literal">null</span>) &#123;</span><br><span class="line">messageSource.setDefaultEncoding(<span class="built_in">this</span>.encoding.name());</span><br><span class="line">&#125;</span><br><span class="line">messageSource.setFallbackToSystemLocale(<span class="built_in">this</span>.fallbackToSystemLocale);</span><br><span class="line">messageSource.setCacheSeconds(<span class="built_in">this</span>.cacheSeconds);</span><br><span class="line">messageSource.setAlwaysUseMessageFormat(<span class="built_in">this</span>.alwaysUseMessageFormat);</span><br><span class="line"><span class="keyword">return</span> messageSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3）、去页面获取国际化的值；</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211134506.png" alt=""></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>  <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Signin Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;asserts/css/bootstrap.min.css&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/webjars/bootstrap/4.0.0/css/bootstrap.css&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;asserts/css/signin.css&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/asserts/css/signin.css&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form-signin&quot;</span> <span class="attr">action</span>=<span class="string">&quot;dashboard.html&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;mb-4&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/asserts/img/bootstrap-solid.svg&#125;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;asserts/img/bootstrap-solid.svg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;72&quot;</span> <span class="attr">height</span>=<span class="string">&quot;72&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;h3 mb-3 font-weight-normal&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login.tip&#125;&quot;</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login.username&#125;&quot;</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Username&quot;</span> <span class="attr">th:placeholder</span>=<span class="string">&quot;#&#123;login.username&#125;&quot;</span> <span class="attr">required</span>=<span class="string">&quot;&quot;</span> <span class="attr">autofocus</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login.password&#125;&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span> <span class="attr">th:placeholder</span>=<span class="string">&quot;#&#123;login.password&#125;&quot;</span> <span class="attr">required</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkbox mb-3&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;remember-me&quot;</span>/&gt;</span> [[#&#123;login.remember&#125;]]</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login.btn&#125;&quot;</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;mt-5 mb-3 text-muted&quot;</span>&gt;</span>© 2017-2018<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm&quot;</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm&quot;</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>效果：根据浏览器语言设置的信息切换了国际化；</p><p>原理：</p><p>​    国际化Locale（区域信息对象）；LocaleResolver（获取区域信息对象）；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc&quot;, name = &quot;locale&quot;)</span></span><br><span class="line"><span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.mvcProperties</span><br><span class="line">.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FixedLocaleResolver</span>(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">AcceptHeaderLocaleResolver</span> <span class="variable">localeResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AcceptHeaderLocaleResolver</span>();</span><br><span class="line">localeResolver.setDefaultLocale(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line"><span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br><span class="line">默认的就是根据请求头带来的区域信息获取Locale进行国际化</span><br></pre></td></tr></table></figure><p>4）、点击链接切换国际化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 可以在连接上携带区域信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title class_">LocaleResolver</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Locale <span class="title function_">resolveLocale</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">l</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;l&quot;</span>);</span><br><span class="line">        <span class="type">Locale</span> <span class="variable">locale</span> <span class="operator">=</span> Locale.getDefault();</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(l))&#123;</span><br><span class="line">            String[] split = l.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            locale = <span class="keyword">new</span> <span class="title class_">Locale</span>(split[<span class="number">0</span>],split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyLocaleResolver</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3）、登陆"><a href="#3）、登陆" class="headerlink" title="3）、登陆"></a>3）、登陆</h3><p>开发期间模板引擎页面修改以后，要实时生效</p><p>1）、禁用模板引擎的缓存</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 禁用缓存</span><br><span class="line">spring.thymeleaf.cache=false </span><br></pre></td></tr></table></figure><p>2）、页面修改完成以后ctrl+f9：重新编译；</p><p>登陆错误消息的显示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #strings.isEmpty(msg)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4）、拦截器进行登陆检查"><a href="#4）、拦截器进行登陆检查" class="headerlink" title="4）、拦截器进行登陆检查"></a>4）、拦截器进行登陆检查</h3><p>拦截器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登陆检查，</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">//目标方法执行之前</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> request.getSession().getAttribute(<span class="string">&quot;loginUser&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//未登陆，返回登陆页面</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;没有权限请先登陆&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/index.html&quot;</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//已登陆，放行请求</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注册拦截器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//所有的WebMvcConfigurerAdapter组件都会一起起作用</span></span><br><span class="line">  <span class="meta">@Bean</span> <span class="comment">//将组件注册在容器</span></span><br><span class="line">  <span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title function_">webMvcConfigurerAdapter</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="type">WebMvcConfigurerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerAdapter</span>() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">              registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">              registry.addViewController(<span class="string">&quot;/index.html&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">              registry.addViewController(<span class="string">&quot;/main.html&quot;</span>).setViewName(<span class="string">&quot;dashboard&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//注册拦截器</span></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">              <span class="comment">//super.addInterceptors(registry);</span></span><br><span class="line">              <span class="comment">//静态资源；  *.css , *.js</span></span><br><span class="line">              <span class="comment">//SpringBoot已经做好了静态资源映射</span></span><br><span class="line">              registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginHandlerInterceptor</span>()).addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                      .excludePathPatterns(<span class="string">&quot;/index.html&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/user/login&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> adapter;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="5）、CRUD-员工列表"><a href="#5）、CRUD-员工列表" class="headerlink" title="5）、CRUD-员工列表"></a>5）、CRUD-员工列表</h3><p>实验要求：</p><p>1）、RestfulCRUD：CRUD满足Rest风格；</p><p>URI：  /资源名称/资源标识       HTTP请求方式区分对资源CRUD操作</p><div class="table-container"><table><thead><tr><th></th><th>普通CRUD（uri来区分操作）</th><th>RestfulCRUD</th></tr></thead><tbody><tr><td>查询</td><td>getEmp</td><td>emp—-GET</td></tr><tr><td>添加</td><td>addEmp?xxx</td><td>emp—-POST</td></tr><tr><td>修改</td><td>updateEmp?id=xxx&amp;xxx=xx</td><td>emp/{id}—-PUT</td></tr><tr><td>删除</td><td>deleteEmp?id=1</td><td>emp/{id}—-DELETE</td></tr></tbody></table></div><p>2）、实验的请求架构;</p><div class="table-container"><table><thead><tr><th>实验功能</th><th>请求URI</th><th>请求方式</th></tr></thead><tbody><tr><td>查询所有员工</td><td>emps</td><td>GET</td></tr><tr><td>查询某个员工(来到修改页面)</td><td>emp/1</td><td>GET</td></tr><tr><td>来到添加页面</td><td>emp</td><td>GET</td></tr><tr><td>添加员工</td><td>emp</td><td>POST</td></tr><tr><td>来到修改页面（查出员工进行信息回显）</td><td>emp/1</td><td>GET</td></tr><tr><td>修改员工</td><td>emp</td><td>PUT</td></tr><tr><td>删除员工</td><td>emp/1</td><td>DELETE</td></tr></tbody></table></div><p>3）、员工列表：</p><h4 id="thymeleaf公共页面元素抽取"><a href="#thymeleaf公共页面元素抽取" class="headerlink" title="thymeleaf公共页面元素抽取"></a>thymeleaf公共页面元素抽取</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1、抽取公共片段</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;copy&quot;</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2、引入公共片段</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;~&#123;footer :: copy&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">~&#123;templatename::selector&#125;：模板名::选择器</span><br><span class="line">~&#123;templatename::fragmentname&#125;:模板名::片段名</span><br><span class="line"></span><br><span class="line">3、默认效果：</span><br><span class="line">insert的公共片段在div标签中</span><br><span class="line">如果使用th:insert等属性进行引入，可以不用写~&#123;&#125;：</span><br><span class="line">行内写法可以加上：[[~&#123;&#125;]];[(~&#123;&#125;)]；</span><br></pre></td></tr></table></figure><p>三种引入公共片段的th属性：</p><p><strong>th:insert</strong>：将公共片段整个插入到声明引入的元素中</p><p><strong>th:replace</strong>：将声明引入的元素替换为公共片段</p><p><strong>th:include</strong>：将被引入的片段的内容包含进这个标签中</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">&quot;copy&quot;</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">引入方式</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">效果</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>引入片段的时候传入参数： </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;col-md-2 d-none d-md-block bg-light sidebar&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar-sticky&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav flex-column&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link active&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">th:class</span>=<span class="string">&quot;$&#123;activeUri==&#x27;main.html&#x27;?&#x27;nav-link active&#x27;:&#x27;nav-link&#x27;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/main.html&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;24&quot;</span> <span class="attr">height</span>=<span class="string">&quot;24&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 24 24&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;currentColor&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">stroke-linecap</span>=<span class="string">&quot;round&quot;</span> <span class="attr">stroke-linejoin</span>=<span class="string">&quot;round&quot;</span> <span class="attr">class</span>=<span class="string">&quot;feather feather-home&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">&quot;9 22 9 12 15 12 15 22&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">polyline</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">                    Dashboard <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入侧边栏;传入参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;commons/bar::#sidebar(activeUri=&#x27;emps&#x27;)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6）、CRUD-员工添加"><a href="#6）、CRUD-员工添加" class="headerlink" title="6）、CRUD-员工添加"></a>6）、CRUD-员工添加</h3><p>添加页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan@atguigu.com&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-check form-check-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label&quot;</span>&gt;</span>男<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-check form-check-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label&quot;</span>&gt;</span>女<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>4<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>5<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>提交的数据格式不对：生日：日期；</p><p>2017-12-12；2017/12/12；2017.12.12；</p><p>日期的格式化；SpringMVC将页面提交的值需要转换为指定的类型;</p><p>2017-12-12—-Date； 类型转换，格式化;</p><p>默认日期是按照/的方式；</p><h3 id="7）、CRUD-员工修改"><a href="#7）、CRUD-员工修改" class="headerlink" title="7）、CRUD-员工修改"></a>7）、CRUD-员工修改</h3><p>修改添加二合一表单</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--需要区分是员工修改还是添加；--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/emp&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--发送put请求修改员工数据--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">1、SpringMVC中配置HiddenHttpMethodFilter;（SpringBoot自动配置好的）</span></span><br><span class="line"><span class="comment">2、页面创建一个post表单</span></span><br><span class="line"><span class="comment">3、创建一个input项，name=&quot;_method&quot;;值就是我们指定的请求方式</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;put&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;emp!=null&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;emp!=null&#125;&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;emp.id&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;emp.lastName&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan@atguigu.com&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;emp.email&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-check form-check-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">th:checked</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;emp.gender==1&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label&quot;</span>&gt;</span>男<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-check form-check-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">th:checked</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;emp.gender==0&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label&quot;</span>&gt;</span>女<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--提交的是部门的id--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;department.id&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:selected</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;dept.id == emp.department.id&#125;&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;dept.id&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;dept:$&#123;depts&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;dept.departmentName&#125;&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;birth&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;#dates.format(emp.birth, &#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp!=null&#125;?&#x27;修改&#x27;:&#x27;添加&#x27;&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="8）、CRUD-员工删除"><a href="#8）、CRUD-员工删除" class="headerlink" title="8）、CRUD-员工删除"></a>8）、CRUD-员工删除</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;emp:$&#123;emps&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>[[$&#123;emp.lastName&#125;]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp.email&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp.gender&#125;==0?&#x27;女&#x27;:&#x27;男&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp.department.departmentName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(emp.birth, &#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-primary&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/emp/&#125;+$&#123;emp.id&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:attr</span>=<span class="string">&quot;del_uri=@&#123;/emp/&#125;+$&#123;emp.id&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-danger deleteBtn&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="string">&quot;.deleteBtn&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//删除当前员工的</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#deleteEmpForm&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;action&quot;</span>,$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&quot;del_uri&quot;</span>)).<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="7、错误处理机制"><a href="#7、错误处理机制" class="headerlink" title="7、错误处理机制"></a>7、错误处理机制</h2><h3 id="1）、SpringBoot默认的错误处理机制"><a href="#1）、SpringBoot默认的错误处理机制" class="headerlink" title="1）、SpringBoot默认的错误处理机制"></a>1）、SpringBoot默认的错误处理机制</h3><p>默认效果：</p><p>​        1）、浏览器，返回一个默认的错误页面</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226173408.png" alt=""></p><p>  浏览器发送请求的请求头：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180347.png" alt=""></p><p>​        2）、如果是其他客户端，默认响应一个json数据</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226173527.png" alt=""></p><p>​        <img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180504.png" alt=""></p><p>原理：</p><p>​    可以参照ErrorMvcAutoConfiguration；错误处理的自动配置；</p><pre><code>  给容器中添加了以下组件</code></pre><p>​    1、DefaultErrorAttributes：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">帮我们在页面共享信息；</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes,</span></span><br><span class="line"><span class="params"><span class="type">boolean</span> includeStackTrace)</span> &#123;</span><br><span class="line">Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;String, Object&gt;();</span><br><span class="line">errorAttributes.put(<span class="string">&quot;timestamp&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">addStatus(errorAttributes, requestAttributes);</span><br><span class="line">addErrorDetails(errorAttributes, requestAttributes, includeStackTrace);</span><br><span class="line">addPath(errorAttributes, requestAttributes);</span><br><span class="line"><span class="keyword">return</span> errorAttributes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    2、BasicErrorController：处理默认/error请求</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicErrorController</span> <span class="keyword">extends</span> <span class="title class_">AbstractErrorController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(produces = &quot;text/html&quot;)</span><span class="comment">//产生html类型的数据；浏览器发送的请求来到这个方法处理</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">errorHtml</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">HttpServletResponse response)</span> &#123;</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line">Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">response.setStatus(status.value());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//去哪个页面作为错误页面；包含页面地址和页面内容</span></span><br><span class="line"><span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolveErrorView(request, response, status, model);</span><br><span class="line"><span class="keyword">return</span> (modelAndView == <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;error&quot;</span>, model) : modelAndView);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="meta">@ResponseBody</span>    <span class="comment">//产生json数据，其他客户端来到这个方法处理；</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">error</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;Map&lt;String, Object&gt;&gt;(body, status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    3、ErrorPageCustomizer：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;error.path:/error&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/error&quot;</span>;  系统出现错误以后来到error请求进行处理；（web.xml注册的错误页面规则）</span><br></pre></td></tr></table></figure><p>​    4、DefaultErrorViewResolver：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status,</span></span><br><span class="line"><span class="params">Map&lt;String, Object&gt; model)</span> &#123;</span><br><span class="line"><span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolve(String.valueOf(status), model);</span><br><span class="line"><span class="keyword">if</span> (modelAndView == <span class="literal">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;</span><br><span class="line">modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ModelAndView <span class="title function_">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> &#123;</span><br><span class="line">        <span class="comment">//默认SpringBoot可以去找到一个页面？  error/404</span></span><br><span class="line"><span class="type">String</span> <span class="variable">errorViewName</span> <span class="operator">=</span> <span class="string">&quot;error/&quot;</span> + viewName;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模板引擎可以解析这个页面地址就用模板引擎解析</span></span><br><span class="line"><span class="type">TemplateAvailabilityProvider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="built_in">this</span>.templateAvailabilityProviders</span><br><span class="line">.getProvider(errorViewName, <span class="built_in">this</span>.applicationContext);</span><br><span class="line"><span class="keyword">if</span> (provider != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//模板引擎可用的情况下返回到errorViewName指定的视图地址</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(errorViewName, model);</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">//模板引擎不可用，就在静态资源文件夹下找errorViewName对应的页面   error/404.html</span></span><br><span class="line"><span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    步骤：</p><p>​        一但系统出现4xx或者5xx之类的错误；ErrorPageCustomizer就会生效（定制错误的响应规则）；就会来到/error请求；就会被<strong>BasicErrorController</strong>处理；</p><p>​        1）响应页面；去哪个页面是由<strong>DefaultErrorViewResolver</strong>解析得到的；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">      HttpServletResponse response, HttpStatus status, Map&lt;String, Object&gt; model)</span> &#123;</span><br><span class="line">    <span class="comment">//所有的ErrorViewResolver得到ModelAndView</span></span><br><span class="line">   <span class="keyword">for</span> (ErrorViewResolver resolver : <span class="built_in">this</span>.errorViewResolvers) &#123;</span><br><span class="line">      <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolver.resolveErrorView(request, status, model);</span><br><span class="line">      <span class="keyword">if</span> (modelAndView != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> modelAndView;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2）、如果定制错误响应："><a href="#2）、如果定制错误响应：" class="headerlink" title="2）、如果定制错误响应："></a>2）、如果定制错误响应：</h3><h4 id="1）、如何定制错误的页面；"><a href="#1）、如何定制错误的页面；" class="headerlink" title="1）、如何定制错误的页面；"></a><strong>1）、如何定制错误的页面；</strong></h4><p>​            <strong>1）、有模板引擎的情况下；error/状态码;</strong> 【将错误页面命名为  错误状态码.html 放在模板引擎文件夹里面的 error文件夹下】，发生此状态码的错误就会来到  对应的页面；</p><p>​            我们可以使用4xx和5xx作为错误页面的文件名来匹配这种类型的所有错误，精确优先（优先寻找精确的状态码.html）；        </p><p>​            页面能获取的信息；</p><p>​                timestamp：时间戳</p><p>​                status：状态码</p><p>​                error：错误提示</p><p>​                exception：异常对象</p><p>​                message：异常消息</p><p>​                errors：JSR303数据校验的错误都在这里</p><p>​            2）、没有模板引擎（模板引擎找不到这个错误页面），静态资源文件夹下找；</p><p>​            3）、以上都没有错误页面，就是默认来到SpringBoot默认的错误提示页面；</p><h4 id="2）、如何定制错误的json数据；"><a href="#2）、如何定制错误的json数据；" class="headerlink" title="2）、如何定制错误的json数据；"></a>2）、如何定制错误的json数据；</h4><p>​        1）、自定义异常处理&amp;返回定制json数据；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">handleException</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;user.notexist&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;message&quot;</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//没有自适应效果...</span></span><br></pre></td></tr></table></figure><p>​        2）、转发到/error进行自适应响应效果处理</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">handleException</span><span class="params">(Exception e, HttpServletRequest request)</span>&#123;</span><br><span class="line">       Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//传入我们自己的错误状态码  4xx 5xx，否则就不会进入定制错误页面的解析流程</span></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Integer statusCode = (Integer) request</span></span><br><span class="line"><span class="comment">        .getAttribute(&quot;javax.servlet.error.status_code&quot;);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       request.setAttribute(<span class="string">&quot;javax.servlet.error.status_code&quot;</span>,<span class="number">500</span>);</span><br><span class="line">       map.put(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;user.notexist&quot;</span>);</span><br><span class="line">       map.put(<span class="string">&quot;message&quot;</span>,e.getMessage());</span><br><span class="line">       <span class="comment">//转发到/error</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;forward:/error&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="3）、将我们的定制数据携带出去；"><a href="#3）、将我们的定制数据携带出去；" class="headerlink" title="3）、将我们的定制数据携带出去；"></a>3）、将我们的定制数据携带出去；</h4><p>出现错误以后，会来到/error请求，会被BasicErrorController处理，响应出去可以获取的数据是由getErrorAttributes得到的（是AbstractErrorController（ErrorController）规定的方法）；</p><p>​    1、完全来编写一个ErrorController的实现类【或者是编写AbstractErrorController的子类】，放在容器中；</p><p>​    2、页面上能用的数据，或者是json返回能用的数据都是通过errorAttributes.getErrorAttributes得到；</p><p>​            容器中DefaultErrorAttributes.getErrorAttributes()；默认进行数据处理的；</p><p>自定义ErrorAttributes</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给容器中加入我们自己定义的ErrorAttributes</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title class_">DefaultErrorAttributes</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes, <span class="type">boolean</span> includeStackTrace)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="built_in">super</span>.getErrorAttributes(requestAttributes, includeStackTrace);</span><br><span class="line">        map.put(<span class="string">&quot;company&quot;</span>,<span class="string">&quot;atguigu&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最终的效果：响应是自适应的，可以通过定制ErrorAttributes改变需要返回的内容，</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180228135513.png" alt=""></p><h2 id="8、配置嵌入式Servlet容器"><a href="#8、配置嵌入式Servlet容器" class="headerlink" title="8、配置嵌入式Servlet容器"></a>8、配置嵌入式Servlet容器</h2><p>SpringBoot默认使用Tomcat作为嵌入式的Servlet容器；</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180301142915.png" alt=""></p><p>问题？</p><h3 id="1）、如何定制和修改Servlet容器的相关配置；"><a href="#1）、如何定制和修改Servlet容器的相关配置；" class="headerlink" title="1）、如何定制和修改Servlet容器的相关配置；"></a>1）、如何定制和修改Servlet容器的相关配置；</h3><p>1、修改和server有关的配置（ServerProperties【也是EmbeddedServletContainerCustomizer】）；</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="attr">server.context-path</span>=<span class="string">/crud</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.tomcat.uri-encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">//通用的Servlet容器设置</span></span><br><span class="line"><span class="attr">server.xxx</span></span><br><span class="line"><span class="attr">//Tomcat的设置</span></span><br><span class="line"><span class="attr">server.tomcat.xxx</span></span><br></pre></td></tr></table></figure><p>2、编写一个<strong>EmbeddedServletContainerCustomizer</strong>：嵌入式的Servlet容器的定制器；来修改Servlet容器的配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  <span class="comment">//一定要将这个定制器加入到容器中</span></span><br><span class="line"><span class="keyword">public</span> EmbeddedServletContainerCustomizer <span class="title function_">embeddedServletContainerCustomizer</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedServletContainerCustomizer</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定制嵌入式的Servlet容器相关的规则</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(ConfigurableEmbeddedServletContainer container)</span> &#123;</span><br><span class="line">            container.setPort(<span class="number">8083</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2）、注册Servlet三大组件【Servlet、Filter、Listener】"><a href="#2）、注册Servlet三大组件【Servlet、Filter、Listener】" class="headerlink" title="2）、注册Servlet三大组件【Servlet、Filter、Listener】"></a>2）、注册Servlet三大组件【Servlet、Filter、Listener】</h3><p>由于SpringBoot默认是以jar包的方式启动嵌入式的Servlet容器来启动SpringBoot的web应用，没有web.xml文件。</p><p>注册三大组件用以下方式</p><p>ServletRegistrationBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册三大组件</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">myServlet</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">MyServlet</span>(),<span class="string">&quot;/myServlet&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>FilterRegistrationBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">myFilter</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">FilterRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">    registrationBean.setFilter(<span class="keyword">new</span> <span class="title class_">MyFilter</span>());</span><br><span class="line">    registrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/hello&quot;</span>,<span class="string">&quot;/myServlet&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ServletListenerRegistrationBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title function_">myListener</span><span class="params">()</span>&#123;</span><br><span class="line">    ServletListenerRegistrationBean&lt;MyListener&gt; registrationBean = <span class="keyword">new</span> <span class="title class_">ServletListenerRegistrationBean</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MyListener</span>());</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SpringBoot帮我们自动SpringMVC的时候，自动的注册SpringMVC的前端控制器；DIspatcherServlet；</p><p>DispatcherServletAutoConfiguration中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(value = DispatcherServlet.class, name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">dispatcherServletRegistration</span><span class="params">(</span></span><br><span class="line"><span class="params">      DispatcherServlet dispatcherServlet)</span> &#123;</span><br><span class="line">   <span class="type">ServletRegistrationBean</span> <span class="variable">registration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(</span><br><span class="line">         dispatcherServlet, <span class="built_in">this</span>.serverProperties.getServletMapping());</span><br><span class="line">    <span class="comment">//默认拦截： /  所有请求；包静态资源，但是不拦截jsp请求；   /*会拦截jsp</span></span><br><span class="line">    <span class="comment">//可以通过server.servletPath来修改SpringMVC前端控制器默认拦截的请求路径</span></span><br><span class="line">    </span><br><span class="line">   registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);</span><br><span class="line">   registration.setLoadOnStartup(</span><br><span class="line">         <span class="built_in">this</span>.webMvcProperties.getServlet().getLoadOnStartup());</span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.multipartConfig != <span class="literal">null</span>) &#123;</span><br><span class="line">      registration.setMultipartConfig(<span class="built_in">this</span>.multipartConfig);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> registration;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2）、SpringBoot能不能支持其他的Servlet容器；</p><h3 id="3）、替换为其他嵌入式Servlet容器"><a href="#3）、替换为其他嵌入式Servlet容器" class="headerlink" title="3）、替换为其他嵌入式Servlet容器"></a>3）、替换为其他嵌入式Servlet容器</h3><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302114401.png" alt=""></p><p>默认支持：</p><p>Tomcat（默认使用）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   引入web模块默认就是使用嵌入式的Tomcat作为Servlet容器；</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Jetty</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入web模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入其他的Servlet容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Undertow</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入web模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入其他的Servlet容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4）、嵌入式Servlet容器自动配置原理；"><a href="#4）、嵌入式Servlet容器自动配置原理；" class="headerlink" title="4）、嵌入式Servlet容器自动配置原理；"></a>4）、嵌入式Servlet容器自动配置原理；</h3><p>EmbeddedServletContainerAutoConfiguration：嵌入式的Servlet容器自动配置？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@Import(BeanPostProcessorsRegistrar.class)</span></span><br><span class="line"><span class="comment">//导入BeanPostProcessorsRegistrar：Spring注解版；给容器中导入一些组件</span></span><br><span class="line"><span class="comment">//导入了EmbeddedServletContainerCustomizerBeanPostProcessor：</span></span><br><span class="line"><span class="comment">//后置处理器：bean初始化前后（创建完对象，还没赋值赋值）执行初始化工作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddedServletContainerAutoConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, Tomcat.class &#125;)</span><span class="comment">//判断当前是否引入了Tomcat依赖；</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span><span class="comment">//判断当前容器没有用户自己定义EmbeddedServletContainerFactory：嵌入式的Servlet容器工厂；作用：创建嵌入式的Servlet容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedTomcat</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> TomcatEmbeddedServletContainerFactory <span class="title function_">tomcatEmbeddedServletContainerFactory</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatEmbeddedServletContainerFactory</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nested configuration if Jetty is being used.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, Server.class, Loader.class,</span></span><br><span class="line"><span class="meta">WebAppContext.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedJetty</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> JettyEmbeddedServletContainerFactory <span class="title function_">jettyEmbeddedServletContainerFactory</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JettyEmbeddedServletContainerFactory</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nested configuration if Undertow is being used.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, Undertow.class, SslClientAuthMode.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedUndertow</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UndertowEmbeddedServletContainerFactory <span class="title function_">undertowEmbeddedServletContainerFactory</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UndertowEmbeddedServletContainerFactory</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1）、EmbeddedServletContainerFactory（嵌入式Servlet容器工厂）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmbeddedServletContainerFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取嵌入式的Servlet容器</span></span><br><span class="line">   EmbeddedServletContainer <span class="title function_">getEmbeddedServletContainer</span><span class="params">(</span></span><br><span class="line"><span class="params">         ServletContextInitializer... initializers)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144835.png" alt=""></p><p>2）、EmbeddedServletContainer：（嵌入式的Servlet容器）</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144910.png" alt=""></p><p>3）、以<strong>TomcatEmbeddedServletContainerFactory</strong>为例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> EmbeddedServletContainer <span class="title function_">getEmbeddedServletContainer</span><span class="params">(</span></span><br><span class="line"><span class="params">      ServletContextInitializer... initializers)</span> &#123;</span><br><span class="line">    <span class="comment">//创建一个Tomcat</span></span><br><span class="line">   <span class="type">Tomcat</span> <span class="variable">tomcat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tomcat</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置Tomcat的基本环节</span></span><br><span class="line">   <span class="type">File</span> <span class="variable">baseDir</span> <span class="operator">=</span> (<span class="built_in">this</span>.baseDirectory != <span class="literal">null</span> ? <span class="built_in">this</span>.baseDirectory</span><br><span class="line">         : createTempDir(<span class="string">&quot;tomcat&quot;</span>));</span><br><span class="line">   tomcat.setBaseDir(baseDir.getAbsolutePath());</span><br><span class="line">   <span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Connector</span>(<span class="built_in">this</span>.protocol);</span><br><span class="line">   tomcat.getService().addConnector(connector);</span><br><span class="line">   customizeConnector(connector);</span><br><span class="line">   tomcat.setConnector(connector);</span><br><span class="line">   tomcat.getHost().setAutoDeploy(<span class="literal">false</span>);</span><br><span class="line">   configureEngine(tomcat.getEngine());</span><br><span class="line">   <span class="keyword">for</span> (Connector additionalConnector : <span class="built_in">this</span>.additionalTomcatConnectors) &#123;</span><br><span class="line">      tomcat.getService().addConnector(additionalConnector);</span><br><span class="line">   &#125;</span><br><span class="line">   prepareContext(tomcat.getHost(), initializers);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将配置好的Tomcat传入进去，返回一个EmbeddedServletContainer；并且启动Tomcat服务器</span></span><br><span class="line">   <span class="keyword">return</span> getTomcatEmbeddedServletContainer(tomcat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4）、我们对嵌入式容器的配置修改是怎么生效？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerProperties、EmbeddedServletContainerCustomizer</span><br></pre></td></tr></table></figure><p><strong>EmbeddedServletContainerCustomizer</strong>：定制器帮我们修改了Servlet容器的配置？</p><p>怎么修改的原理？</p><p>5）、容器中导入了<strong>EmbeddedServletContainerCustomizerBeanPostProcessor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化之前</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span></span><br><span class="line">      <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    <span class="comment">//如果当前初始化的是一个ConfigurableEmbeddedServletContainer类型的组件</span></span><br><span class="line">   <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> ConfigurableEmbeddedServletContainer) &#123;</span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      postProcessBeforeInitialization((ConfigurableEmbeddedServletContainer) bean);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">postProcessBeforeInitialization</span><span class="params">(</span></span><br><span class="line"><span class="params">ConfigurableEmbeddedServletContainer bean)</span> &#123;</span><br><span class="line">    <span class="comment">//获取所有的定制器，调用每一个定制器的customize方法来给Servlet容器进行属性赋值；</span></span><br><span class="line">    <span class="keyword">for</span> (EmbeddedServletContainerCustomizer customizer : getCustomizers()) &#123;</span><br><span class="line">        customizer.customize(bean);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Collection&lt;EmbeddedServletContainerCustomizer&gt; <span class="title function_">getCustomizers</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.customizers == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Look up does not include the parent context</span></span><br><span class="line">        <span class="built_in">this</span>.customizers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;EmbeddedServletContainerCustomizer&gt;(</span><br><span class="line">            <span class="built_in">this</span>.beanFactory</span><br><span class="line">            <span class="comment">//从容器中获取所有这葛类型的组件：EmbeddedServletContainerCustomizer</span></span><br><span class="line">            <span class="comment">//定制Servlet容器，给容器中可以添加一个EmbeddedServletContainerCustomizer类型的组件</span></span><br><span class="line">            .getBeansOfType(EmbeddedServletContainerCustomizer.class,</span><br><span class="line">                            <span class="literal">false</span>, <span class="literal">false</span>)</span><br><span class="line">            .values());</span><br><span class="line">        Collections.sort(<span class="built_in">this</span>.customizers, AnnotationAwareOrderComparator.INSTANCE);</span><br><span class="line">        <span class="built_in">this</span>.customizers = Collections.unmodifiableList(<span class="built_in">this</span>.customizers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.customizers;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ServerProperties也是定制器</span><br></pre></td></tr></table></figure><p>步骤：</p><p>1）、SpringBoot根据导入的依赖情况，给容器中添加相应的EmbeddedServletContainerFactory【TomcatEmbeddedServletContainerFactory】</p><p>2）、容器中某个组件要创建对象就会惊动后置处理器；EmbeddedServletContainerCustomizerBeanPostProcessor；</p><p>只要是嵌入式的Servlet容器工厂，后置处理器就工作；</p><p>3）、后置处理器，从容器中获取所有的<strong>EmbeddedServletContainerCustomizer</strong>，调用定制器的定制方法</p><h3 id="5）、嵌入式Servlet容器启动原理；"><a href="#5）、嵌入式Servlet容器启动原理；" class="headerlink" title="5）、嵌入式Servlet容器启动原理；"></a>5）、嵌入式Servlet容器启动原理；</h3><p>什么时候创建嵌入式的Servlet容器工厂？什么时候获取嵌入式的Servlet容器并启动Tomcat；</p><p>获取嵌入式的Servlet容器工厂：</p><p>1）、SpringBoot应用启动运行run方法</p><p>2）、refreshContext(context);SpringBoot刷新IOC容器【创建IOC容器对象，并初始化容器，创建容器中的每一个组件】；如果是web应用创建<strong>AnnotationConfigEmbeddedWebApplicationContext</strong>，否则：<strong>AnnotationConfigApplicationContext</strong></p><p>3）、refresh(context);<strong>刷新刚才创建好的ioc容器；</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">   <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">      <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">      prepareRefresh();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">      <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">      prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">         postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">         invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">         registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">         initMessageSource();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">         initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">         onRefresh();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">         registerListeners();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">         finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">         finishRefresh();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">         <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">            logger.warn(<span class="string">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">         destroyBeans();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Reset &#x27;active&#x27; flag.</span></span><br><span class="line">         cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Propagate exception to caller.</span></span><br><span class="line">         <span class="keyword">throw</span> ex;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="comment">// Reset common introspection caches in Spring&#x27;s core, since we</span></span><br><span class="line">         <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">         resetCommonCaches();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4）、  onRefresh(); web的ioc容器重写了onRefresh方法</p><p>5）、webioc容器会创建嵌入式的Servlet容器；<strong>createEmbeddedServletContainer</strong>();</p><p><strong>6）、获取嵌入式的Servlet容器工厂：</strong></p><p>EmbeddedServletContainerFactory containerFactory = getEmbeddedServletContainerFactory();</p><p>​    从ioc容器中获取EmbeddedServletContainerFactory 组件；<strong>TomcatEmbeddedServletContainerFactory</strong>创建对象，后置处理器一看是这个对象，就获取所有的定制器来先定制Servlet容器的相关配置；</p><p>7）、<strong>使用容器工厂获取嵌入式的Servlet容器</strong>：this.embeddedServletContainer = containerFactory      .getEmbeddedServletContainer(getSelfInitializer());</p><p>8）、嵌入式的Servlet容器创建对象并启动Servlet容器；</p><p><strong>先启动嵌入式的Servlet容器，再将ioc容器中剩下没有创建出的对象获取出来；</strong></p><p><strong>==IOC容器启动创建嵌入式的Servlet容器==</strong></p><h2 id="9、使用外置的Servlet容器"><a href="#9、使用外置的Servlet容器" class="headerlink" title="9、使用外置的Servlet容器"></a>9、使用外置的Servlet容器</h2><p>嵌入式Servlet容器：应用打成可执行的jar</p><p>​        优点：简单、便携；</p><p>​        缺点：默认不支持JSP、优化定制比较复杂（使用定制器【ServerProperties、自定义EmbeddedServletContainerCustomizer】，自己编写嵌入式Servlet容器的创建工厂【EmbeddedServletContainerFactory】）；</p><p>外置的Servlet容器：外面安装Tomcat—-应用war包的方式打包；</p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>1）、必须创建一个war项目；（利用idea创建好目录结构）</p><p>2）、将嵌入式的Tomcat指定为provided；</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3）、必须编写一个<strong>SpringBootServletInitializer</strong>的子类，并调用configure方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletInitializer</span> <span class="keyword">extends</span> <span class="title class_">SpringBootServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> SpringApplicationBuilder <span class="title function_">configure</span><span class="params">(SpringApplicationBuilder application)</span> &#123;</span><br><span class="line">       <span class="comment">//传入SpringBoot应用的主程序</span></span><br><span class="line">      <span class="keyword">return</span> application.sources(SpringBoot04WebJspApplication.class);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4）、启动服务器就可以使用；</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>jar包：执行SpringBoot主类的main方法，启动ioc容器，创建嵌入式的Servlet容器；</p><p>war包：启动服务器，<strong>服务器启动SpringBoot应用</strong>【SpringBootServletInitializer】，启动ioc容器；</p><p>servlet3.0（Spring注解版）：</p><p>8.2.4 Shared libraries / runtimes pluggability：</p><p>规则：</p><p>​    1）、服务器启动（web应用启动）会创建当前web应用里面每一个jar包里面ServletContainerInitializer实例：</p><p>​    2）、ServletContainerInitializer的实现放在jar包的META-INF/services文件夹下，有一个名为javax.servlet.ServletContainerInitializer的文件，内容就是ServletContainerInitializer的实现类的全类名</p><p>​    3）、还可以使用@HandlesTypes，在应用启动的时候加载我们感兴趣的类；</p><p>流程：</p><p>1）、启动Tomcat</p><p>2）、org\springframework\spring-web\4.3.14.RELEASE\spring-web-4.3.14.RELEASE.jar!\META-INF\services\javax.servlet.ServletContainerInitializer：</p><p>Spring的web模块里面有这个文件：<strong>org.springframework.web.SpringServletContainerInitializer</strong></p><p>3）、SpringServletContainerInitializer将@HandlesTypes(WebApplicationInitializer.class)标注的所有这个类型的类都传入到onStartup方法的Set<Class<?>&gt;；为这些WebApplicationInitializer类型的类创建实例；</p><p>4）、每一个WebApplicationInitializer都调用自己的onStartup；</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302221835.png" alt=""></p><p>5）、相当于我们的SpringBootServletInitializer的类会被创建对象，并执行onStartup方法</p><p>6）、SpringBootServletInitializer实例执行onStartup的时候会createRootApplicationContext；创建容器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">createRootApplicationContext</span><span class="params">(</span></span><br><span class="line"><span class="params">      ServletContext servletContext)</span> &#123;</span><br><span class="line">    <span class="comment">//1、创建SpringApplicationBuilder</span></span><br><span class="line">   <span class="type">SpringApplicationBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> createSpringApplicationBuilder();</span><br><span class="line">   <span class="type">StandardServletEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardServletEnvironment</span>();</span><br><span class="line">   environment.initPropertySources(servletContext, <span class="literal">null</span>);</span><br><span class="line">   builder.environment(environment);</span><br><span class="line">   builder.main(getClass());</span><br><span class="line">   <span class="type">ApplicationContext</span> <span class="variable">parent</span> <span class="operator">=</span> getExistingRootWebApplicationContext(servletContext);</span><br><span class="line">   <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.logger.info(<span class="string">&quot;Root context already created (using as parent).&quot;</span>);</span><br><span class="line">      servletContext.setAttribute(</span><br><span class="line">            WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, <span class="literal">null</span>);</span><br><span class="line">      builder.initializers(<span class="keyword">new</span> <span class="title class_">ParentContextApplicationContextInitializer</span>(parent));</span><br><span class="line">   &#125;</span><br><span class="line">   builder.initializers(</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">ServletContextApplicationContextInitializer</span>(servletContext));</span><br><span class="line">   builder.contextClass(AnnotationConfigEmbeddedWebApplicationContext.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//调用configure方法，子类重写了这个方法，将SpringBoot的主程序类传入了进来</span></span><br><span class="line">   builder = configure(builder);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使用builder创建一个Spring应用</span></span><br><span class="line">   <span class="type">SpringApplication</span> <span class="variable">application</span> <span class="operator">=</span> builder.build();</span><br><span class="line">   <span class="keyword">if</span> (application.getSources().isEmpty() &amp;&amp; AnnotationUtils</span><br><span class="line">         .findAnnotation(getClass(), Configuration.class) != <span class="literal">null</span>) &#123;</span><br><span class="line">      application.getSources().add(getClass());</span><br><span class="line">   &#125;</span><br><span class="line">   Assert.state(!application.getSources().isEmpty(),</span><br><span class="line">         <span class="string">&quot;No SpringApplication sources have been defined. Either override the &quot;</span></span><br><span class="line">               + <span class="string">&quot;configure method or add an @Configuration annotation&quot;</span>);</span><br><span class="line">   <span class="comment">// Ensure error pages are registered</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.registerErrorPageFilter) &#123;</span><br><span class="line">      application.getSources().add(ErrorPageFilterConfiguration.class);</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//启动Spring应用</span></span><br><span class="line">   <span class="keyword">return</span> run(application);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>7）、Spring的应用就启动并且创建IOC容器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">   <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">FailureAnalyzers</span> <span class="variable">analyzers</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">   <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(</span><br><span class="line">            args);</span><br><span class="line">      <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">      <span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> printBanner(environment);</span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">      analyzers = <span class="keyword">new</span> <span class="title class_">FailureAnalyzers</span>(context);</span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//刷新IOC容器</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">      listeners.finished(context, <span class="literal">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) &#123;</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>==启动Servlet容器，再启动SpringBoot应用==</strong></p><h1 id="五、Docker"><a href="#五、Docker" class="headerlink" title="五、Docker"></a>五、Docker</h1><h2 id="1、简介-1"><a href="#1、简介-1" class="headerlink" title="1、简介"></a>1、简介</h2><p><strong>Docker</strong>是一个开源的应用容器引擎；是一个轻量级容器技术；</p><p>Docker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；</p><p>运行中的这个镜像称为容器，容器启动是非常快速的。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145450.png" alt=""></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145531.png" alt=""></p><h2 id="2、核心概念"><a href="#2、核心概念" class="headerlink" title="2、核心概念"></a>2、核心概念</h2><p>docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；</p><p>docker客户端(Client)：连接docker主机进行操作；</p><p>docker仓库(Registry)：用来保存各种打包好的软件镜像；</p><p>docker镜像(Images)：软件打包好的镜像；放在docker仓库中；</p><p>docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303165113.png" alt=""></p><p>使用Docker的步骤：</p><p>1）、安装Docker</p><p>2）、去Docker仓库找到这个软件对应的镜像；</p><p>3）、使用Docker运行这个镜像，这个镜像就会生成一个Docker容器；</p><p>4）、对容器的启动停止就是对软件的启动停止；</p><h2 id="3、安装Docker"><a href="#3、安装Docker" class="headerlink" title="3、安装Docker"></a>3、安装Docker</h2><h4 id="1）、安装linux虚拟机"><a href="#1）、安装linux虚拟机" class="headerlink" title="1）、安装linux虚拟机"></a>1）、安装linux虚拟机</h4><p>​    1）、VMWare、VirtualBox（安装）；</p><p>​    2）、导入虚拟机文件centos7-atguigu.ova；</p><p>​    3）、双击启动linux虚拟机;使用  root/ 123456登陆</p><p>​    4）、使用客户端连接linux服务器进行命令操作；</p><p>​    5）、设置虚拟机网络；</p><p>​        桥接网络===选好网卡====接入网线；</p><p>​    6）、设置好网络以后使用命令重启虚拟机的网络</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure><p>​    7）、查看linux的ip地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure><p>​    8）、使用客户端连接linux；</p><h4 id="2）、在linux虚拟机上安装docker"><a href="#2）、在linux虚拟机上安装docker" class="headerlink" title="2）、在linux虚拟机上安装docker"></a>2）、在linux虚拟机上安装docker</h4><p>步骤：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1、检查内核版本，必须是3.10及以上</span><br><span class="line">uname -r</span><br><span class="line">2、安装docker</span><br><span class="line">yum install docker</span><br><span class="line">3、输入y确认安装</span><br><span class="line">4、启动docker</span><br><span class="line">[root@localhost ~]# systemctl start docker</span><br><span class="line">[root@localhost ~]# docker -v</span><br><span class="line">Docker version 1.12.6, build 3e8e77d/1.12.6</span><br><span class="line">5、开机启动docker</span><br><span class="line">[root@localhost ~]# systemctl enable docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">6、停止docker</span><br><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure><h2 id="4、Docker常用命令-amp-操作"><a href="#4、Docker常用命令-amp-操作" class="headerlink" title="4、Docker常用命令&amp;操作"></a>4、Docker常用命令&amp;操作</h2><h3 id="1）、镜像操作"><a href="#1）、镜像操作" class="headerlink" title="1）、镜像操作"></a>1）、镜像操作</h3><div class="table-container"><table><thead><tr><th>操作</th><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>检索</td><td>docker  search 关键字  eg：docker  search redis</td><td>我们经常去docker  hub上检索镜像的详细信息，如镜像的TAG。</td></tr><tr><td>拉取</td><td>docker pull 镜像名:tag</td><td>:tag是可选的，tag表示标签，多为软件的版本，默认是latest</td></tr><tr><td>列表</td><td>docker images</td><td>查看所有本地镜像</td></tr><tr><td>删除</td><td>docker rmi image-id</td><td>删除指定的本地镜像</td></tr></tbody></table></div><p><a href="https://hub.docker.com/">https://hub.docker.com/</a></p><h3 id="2）、容器操作"><a href="#2）、容器操作" class="headerlink" title="2）、容器操作"></a>2）、容器操作</h3><p>软件镜像（QQ安装程序）——运行镜像——产生一个容器（正在运行的软件，运行的QQ）；</p><p>步骤：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1、搜索镜像</span><br><span class="line">[root@localhost ~]# docker search tomcat</span><br><span class="line">2、拉取镜像</span><br><span class="line">[root@localhost ~]# docker pull tomcat</span><br><span class="line">3、根据镜像启动容器</span><br><span class="line">docker run --name mytomcat -d tomcat:latest</span><br><span class="line">4、docker ps  </span><br><span class="line">查看运行中的容器</span><br><span class="line">5、 停止运行中的容器</span><br><span class="line">docker stop  容器的id</span><br><span class="line">6、查看所有的容器</span><br><span class="line">docker ps -a</span><br><span class="line">7、启动容器</span><br><span class="line">docker start 容器id</span><br><span class="line">8、删除一个容器</span><br><span class="line"> docker rm 容器id</span><br><span class="line">9、启动一个做了端口映射的tomcat</span><br><span class="line">[root@localhost ~]# docker run -d -p 8888:8080 tomcat</span><br><span class="line">-d：后台运行</span><br><span class="line">-p: 将主机的端口映射到容器的一个端口    主机端口:容器内部的端口</span><br><span class="line"></span><br><span class="line">10、为了演示简单关闭了linux的防火墙</span><br><span class="line">service firewalld status ；查看防火墙状态</span><br><span class="line">service firewalld stop：关闭防火墙</span><br><span class="line">11、查看容器的日志</span><br><span class="line">docker logs container-name/container-id</span><br><span class="line"></span><br><span class="line">更多命令参看</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/docker/</span><br><span class="line">可以参考每一个镜像的文档</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3）、安装MySQL示例"><a href="#3）、安装MySQL示例" class="headerlink" title="3）、安装MySQL示例"></a>3）、安装MySQL示例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure><p>错误的启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -d mysql</span><br><span class="line">42f09819908bb72dd99ae19e792e0a5d03c48638421fa64cce5f8ba0f40f5846</span><br><span class="line"></span><br><span class="line">mysql退出了</span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                           PORTS               NAMES</span><br><span class="line">42f09819908b        mysql               &quot;docker-entrypoint.sh&quot;   34 seconds ago      Exited (1) 33 seconds ago                            mysql01</span><br><span class="line">538bde63e500        tomcat              &quot;catalina.sh run&quot;        About an hour ago   Exited (143) About an hour ago                       compassionate_</span><br><span class="line">goldstine</span><br><span class="line">c4f1ac60b3fc        tomcat              &quot;catalina.sh run&quot;        About an hour ago   Exited (143) About an hour ago                       lonely_fermi</span><br><span class="line">81ec743a5271        tomcat              &quot;catalina.sh run&quot;        About an hour ago   Exited (143) About an hour ago                       sick_ramanujan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//错误日志</span><br><span class="line">[root@localhost ~]# docker logs 42f09819908b</span><br><span class="line">error: database is uninitialized and password option is not specified </span><br><span class="line">  You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD；这个三个参数必须指定一个</span><br></pre></td></tr></table></figure><p>正确的启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">b874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b874c56bec49        mysql               &quot;docker-entrypoint.sh&quot;   4 seconds ago       Up 3 seconds        3306/tcp            mysql01</span><br></pre></td></tr></table></figure><p>做了端口映射</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -p 3306:3306 --name mysql02 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">ad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">ad10e4bc5c6a        mysql               &quot;docker-entrypoint.sh&quot;   4 seconds ago       Up 2 seconds        0.0.0.0:3306-&gt;3306/tcp   mysql02</span><br></pre></td></tr></table></figure><p>几个其他的高级操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql03 -v /conf/mysql:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line">把主机的/conf/mysql文件夹挂载到 mysqldocker容器的/etc/mysql/conf.d文件夹里面</span><br><span class="line">改mysql的配置文件就只需要把mysql配置文件放在自定义的文件夹下（/conf/mysql）</span><br><span class="line"></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span><br><span class="line">指定mysql的一些配置参数</span><br></pre></td></tr></table></figure><h1 id="六、SpringBoot与数据访问"><a href="#六、SpringBoot与数据访问" class="headerlink" title="六、SpringBoot与数据访问"></a>六、SpringBoot与数据访问</h1><h2 id="1、JDBC"><a href="#1、JDBC" class="headerlink" title="1、JDBC"></a>1、JDBC</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.15.22:3306/jdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure><p>效果：</p><p>​    默认是用org.apache.tomcat.jdbc.pool.DataSource作为数据源；</p><p>​    数据源的相关配置都在DataSourceProperties里面；</p><p>自动配置原理：</p><p>org.springframework.boot.autoconfigure.jdbc：</p><p>1、参考DataSourceConfiguration，根据配置创建数据源，默认使用Tomcat连接池；可以使用spring.datasource.type指定自定义的数据源类型；</p><p>2、SpringBoot默认可以支持；</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.tomcat.jdbc.pool.DataSource、HikariDataSource、BasicDataSource、</span><br></pre></td></tr></table></figure><p>3、自定义数据源类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generic DataSource configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;spring.datasource.type&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Generic</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(DataSourceProperties properties)</span> &#123;</span><br><span class="line">       <span class="comment">//使用DataSourceBuilder创建数据源，利用反射创建响应type的数据源，并且绑定相关属性</span></span><br><span class="line">      <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、<strong>DataSourceInitializer：ApplicationListener</strong>；</p><p>​    作用：</p><p>​        1）、runSchemaScripts();运行建表语句；</p><p>​        2）、runDataScripts();运行插入数据的sql语句；</p><p>默认只需要将文件命名为：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schema-*.sql、data-*.sql</span></span><br><span class="line"><span class="attr">默认规则：schema.sql，schema-all.sql；</span></span><br><span class="line"><span class="attr">可以使用</span>   <span class="string"></span></span><br><span class="line"><span class="attr">schema</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">-</span> <span class="string">classpath:department.sql</span></span><br><span class="line">      <span class="attr">指定位置</span></span><br></pre></td></tr></table></figure><p>5、操作数据库：自动配置了JdbcTemplate操作数据库</p><h2 id="2、整合Druid数据源"><a href="#2、整合Druid数据源" class="headerlink" title="2、整合Druid数据源"></a>2、整合Druid数据源</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">导入druid数据源</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druid</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置Druid的监控</span></span><br><span class="line">    <span class="comment">//1、配置一个管理后台的Servlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">StatViewServlet</span>(), <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        initParams.put(<span class="string">&quot;loginUsername&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        initParams.put(<span class="string">&quot;loginPassword&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        initParams.put(<span class="string">&quot;allow&quot;</span>,<span class="string">&quot;&quot;</span>);<span class="comment">//默认就是允许所有访问</span></span><br><span class="line">        initParams.put(<span class="string">&quot;deny&quot;</span>,<span class="string">&quot;192.168.15.21&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、配置一个web监控的filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">webStatFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> <span class="title class_">WebStatFilter</span>());</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">&quot;exclusions&quot;</span>,<span class="string">&quot;*.js,*.css,/druid/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line"></span><br><span class="line">        bean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3、整合MyBatis"><a href="#3、整合MyBatis" class="headerlink" title="3、整合MyBatis"></a>3、整合MyBatis</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180305194443.png" alt=""></p><p>步骤：</p><p>​    1）、配置数据源相关属性（见上一节Druid）</p><p>​    2）、给数据库建表</p><p>​    3）、创建JavaBean</p><h3 id="4）、注解版"><a href="#4）、注解版" class="headerlink" title="4）、注解版"></a>4）、注解版</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指定这是一个操作数据库的mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from department where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Department <span class="title function_">getDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from department where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true,keyProperty = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into department(departmentName) values(#&#123;departmentName&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertDept</span><span class="params">(Department department)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateDept</span><span class="params">(Department department)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>问题：</p><p>自定义MyBatis的配置规则；给容器中添加一个ConfigurationCustomizer；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConfigurationCustomizer <span class="title function_">configurationCustomizer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConfigurationCustomizer</span>()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(Configuration configuration)</span> &#123;</span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用MapperScan批量扫描所有的Mapper接口；</span><br><span class="line"><span class="meta">@MapperScan(value = &quot;com.atguigu.springboot.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBoot06DataMybatisApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(SpringBoot06DataMybatisApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5）、配置文件版"><a href="#5）、配置文件版" class="headerlink" title="5）、配置文件版"></a>5）、配置文件版</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span> <span class="string">指定全局配置文件的位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>  <span class="string">指定sql映射文件的位置</span></span><br></pre></td></tr></table></figure><p>更多使用参照</p><p><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p><h2 id="4、整合SpringData-JPA"><a href="#4、整合SpringData-JPA" class="headerlink" title="4、整合SpringData JPA"></a>4、整合SpringData JPA</h2><h3 id="1）、SpringData简介"><a href="#1）、SpringData简介" class="headerlink" title="1）、SpringData简介"></a>1）、SpringData简介</h3><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306105412.png" alt=""></p><h3 id="2）、整合SpringData-JPA"><a href="#2）、整合SpringData-JPA" class="headerlink" title="2）、整合SpringData JPA"></a>2）、整合SpringData JPA</h3><p>JPA:ORM（Object Relational Mapping）；</p><p>1）、编写一个实体类（bean）和数据表进行映射，并且配置好映射关系；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用JPA注解配置映射关系</span></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//告诉JPA这是一个实体类（和数据表映射的类）</span></span><br><span class="line"><span class="meta">@Table(name = &quot;tbl_user&quot;)</span> <span class="comment">//@Table来指定和哪个数据表对应;如果省略默认表名就是user；</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">//这是一个主键</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><span class="comment">//自增主键</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;last_name&quot;,length = 50)</span> <span class="comment">//这是和数据表对应的一个列</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="meta">@Column</span> <span class="comment">//省略默认列名就是属性名</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br></pre></td></tr></table></figure><p>2）、编写一个Dao接口来操作实体类对应的数据表（Repository）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继承JpaRepository来完成对数据库的操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User,Integer&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3）、基本的配置JpaProperties</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line"> <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line"><span class="comment">#     更新或者创建数据表结构</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="comment">#    控制台显示SQL</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h1 id="七、启动配置原理"><a href="#七、启动配置原理" class="headerlink" title="七、启动配置原理"></a>七、启动配置原理</h1><p>几个重要的事件回调机制</p><p>配置在META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><p><strong>SpringApplicationRunListener</strong></p><p>只需要放在ioc容器中</p><p><strong>ApplicationRunner</strong></p><p><strong>CommandLineRunner</strong></p><p>启动流程：</p><h2 id="1、创建SpringApplication对象"><a href="#1、创建SpringApplication对象" class="headerlink" title="1、创建SpringApplication对象"></a><strong>1、创建SpringApplication对象</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">initialize(sources);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(Object[] sources)</span> &#123;</span><br><span class="line">    <span class="comment">//保存主配置类</span></span><br><span class="line">    <span class="keyword">if</span> (sources != <span class="literal">null</span> &amp;&amp; sources.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.sources.addAll(Arrays.asList(sources));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断当前是否一个web应用</span></span><br><span class="line">    <span class="built_in">this</span>.webEnvironment = deduceWebEnvironment();</span><br><span class="line">    <span class="comment">//从类路径下找到META-INF/spring.factories配置的所有ApplicationContextInitializer；然后保存起来</span></span><br><span class="line">    setInitializers((Collection) getSpringFactoriesInstances(</span><br><span class="line">        ApplicationContextInitializer.class));</span><br><span class="line">    <span class="comment">//从类路径下找到ETA-INF/spring.factories配置的所有ApplicationListener</span></span><br><span class="line">    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">    <span class="comment">//从多个配置类中找到有main方法的主配置类</span></span><br><span class="line">    <span class="built_in">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145727.png" alt=""></p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-15/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145855.png" alt=""></p><h2 id="2、运行run方法"><a href="#2、运行run方法" class="headerlink" title="2、运行run方法"></a>2、运行run方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">   <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">FailureAnalyzers</span> <span class="variable">analyzers</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//获取SpringApplicationRunListeners；从类路径下META-INF/spring.factories</span></span><br><span class="line">   <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line">    <span class="comment">//回调所有的获取SpringApplicationRunListener.starting()方法</span></span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="comment">//封装命令行参数</span></span><br><span class="line">      <span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(</span><br><span class="line">            args);</span><br><span class="line">      <span class="comment">//准备环境</span></span><br><span class="line">      <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">       <span class="comment">//创建环境完成后回调SpringApplicationRunListener.environmentPrepared()；表示环境准备完成</span></span><br><span class="line">       </span><br><span class="line">      <span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> printBanner(environment);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//创建ApplicationContext；决定创建web的ioc还是普通的ioc</span></span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">       </span><br><span class="line">      analyzers = <span class="keyword">new</span> <span class="title class_">FailureAnalyzers</span>(context);</span><br><span class="line">       <span class="comment">//准备上下文环境;将environment保存到ioc中；而且applyInitializers()；</span></span><br><span class="line">       <span class="comment">//applyInitializers()：回调之前保存的所有的ApplicationContextInitializer的initialize方法</span></span><br><span class="line">       <span class="comment">//回调所有的SpringApplicationRunListener的contextPrepared()；</span></span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       <span class="comment">//prepareContext运行完成以后回调所有的SpringApplicationRunListener的contextLoaded（）；</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">//s刷新容器；ioc容器初始化（如果是web应用还会创建嵌入式的Tomcat）；Spring注解版</span></span><br><span class="line">       <span class="comment">//扫描，创建，加载所有组件的地方；（配置类，组件，自动配置）</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">       <span class="comment">//从ioc容器中获取所有的ApplicationRunner和CommandLineRunner进行回调</span></span><br><span class="line">       <span class="comment">//ApplicationRunner先回调，CommandLineRunner再回调</span></span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">       <span class="comment">//所有的SpringApplicationRunListener回调finished方法</span></span><br><span class="line">      listeners.finished(context, <span class="literal">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) &#123;</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="comment">//整个SpringBoot应用启动完成以后返回启动的ioc容器；</span></span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、事件监听机制"><a href="#3、事件监听机制" class="headerlink" title="3、事件监听机制"></a>3、事件监听机制</h2><p>配置在META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextInitializer</span>&lt;ConfigurableApplicationContext&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ApplicationContextInitializer...initialize...&quot;</span>+applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>SpringApplicationRunListener</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloSpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//必须有的构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloSpringApplicationRunListener</span><span class="params">(SpringApplication application, String[] args)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">starting</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...starting...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">environmentPrepared</span><span class="params">(ConfigurableEnvironment environment)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> environment.getSystemProperties().get(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...environmentPrepared..&quot;</span>+o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...contextPrepared...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...contextLoaded...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">finished</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...finished...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置（META-INF/spring.factories）</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.atguigu.springboot.listener.HelloApplicationContextInitializer</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.boot.SpringApplicationRunListener</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.atguigu.springboot.listener.HelloSpringApplicationRunListener</span></span><br></pre></td></tr></table></figure><p>只需要放在ioc容器中</p><p><strong>ApplicationRunner</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplicationRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ApplicationRunner...run....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CommandLineRunner</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloCommandLineRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CommandLineRunner...run...&quot;</span>+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="八、自定义starter"><a href="#八、自定义starter" class="headerlink" title="八、自定义starter"></a>八、自定义starter</h1><p>starter：</p><p>​    1、这个场景需要使用到的依赖是什么？</p><p>​    2、如何编写自动配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//指定这个类是一个配置类</span></span><br><span class="line"><span class="meta">@ConditionalOnXXX</span>  <span class="comment">//在指定条件成立的情况下自动配置类生效</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter</span>  <span class="comment">//指定自动配置类的顺序</span></span><br><span class="line"><span class="meta">@Bean</span>  <span class="comment">//给容器中添加组件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationPropertie</span>结合相关xxxProperties类来绑定相关的配置</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span> <span class="comment">//让xxxProperties生效加入到容器中</span></span><br><span class="line"></span><br><span class="line">自动配置类要能加载</span><br><span class="line">将需要启动就加载的自动配置类，配置在META-INF/spring.factories</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br></pre></td></tr></table></figure><p>​    3、模式：</p><p>启动器只用来做依赖导入；</p><p>专门来写一个自动配置模块；</p><p>启动器依赖自动配置；别人只需要引入启动器（starter）</p><p>mybatis-spring-boot-starter；自定义启动器名-spring-boot-starter</p><p>步骤：</p><p>1）、启动器模块</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--启动器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--引入自动配置模块--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2）、自动配置模块</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--引入spring-boot-starter；所有starter的基本配置--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;atguigu.hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrefix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrefix</span><span class="params">(String prefix)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSuffix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuffix</span><span class="params">(String suffix)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line"></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> HelloProperties <span class="title function_">getHelloProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHelloProperties</span><span class="params">(HelloProperties helloProperties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.helloProperties = helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHellAtguigu</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix()+<span class="string">&quot;-&quot;</span> +name + helloProperties.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//web应用才生效</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">HelloService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">        service.setHelloProperties(helloProperties);</span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="更多SpringBoot整合示例"><a href="#更多SpringBoot整合示例" class="headerlink" title="更多SpringBoot整合示例"></a>更多SpringBoot整合示例</h1><p><a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples">https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-19%2F1566207899.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Notes" scheme="http://www.ts1989.cn/categories/Notes/"/>
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="JavaWeb" scheme="http://www.ts1989.cn/tags/JavaWeb/"/>
    
    <category term="SpringBoot" scheme="http://www.ts1989.cn/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>数据分析与挖掘基础</title>
    <link href="http://www.ts1989.cn/2019/08/15/datadigging01-base/"/>
    <id>http://www.ts1989.cn/2019/08/15/datadigging01-base/</id>
    <published>2019-08-14T20:09:35.000Z</published>
    <updated>2019-08-29T08:29:44.208Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-29%2F1567067381.png" alt=""></p><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><h4 id="什么是数据分析和挖掘？"><a href="#什么是数据分析和挖掘？" class="headerlink" title="什么是数据分析和挖掘？"></a>什么是数据分析和挖掘？</h4><p>所谓数据分析，即对已知的数据进行分析，然后提取出一些有价值的信息，比如统计出平均数、标准差等信息，数据分析的数据量有时可能不会太大，而数据挖掘，是指<strong>对大量的数据进行分析与挖掘</strong>，得到一些<strong>未知的、有价值的信息</strong>等，比如从网站的用户或用户行为数据中挖掘出用户的<strong>潜在需求</strong>信息，从而对网站进行改善等。</p><blockquote><p>数据挖掘需要数据分析为基础</p></blockquote><h4 id="数据分析与数据挖掘能做什么事？"><a href="#数据分析与数据挖掘能做什么事？" class="headerlink" title="数据分析与数据挖掘能做什么事？"></a>数据分析与数据挖掘能做什么事？</h4><p>数据挖掘技术可以帮助我们<strong>更好地发现事物之间的规律</strong>。所以，我们可以<strong>利用数据挖掘技术实现数据规律的探索</strong>，比如发现窃电用户、发掘用户潜在需求、实现信息的个性化推送、发现疾病与症状甚至疾病与药物之间的规律……等。</p><h4 id="数据挖掘的过程？"><a href="#数据挖掘的过程？" class="headerlink" title="数据挖掘的过程？"></a>数据挖掘的过程？</h4><ol><li>定义目标 （分析什么数据，解决什么问题）</li><li>获取数据（爬虫、下载统计网站的数据）</li><li>数据探索 </li><li>数据预处理(数据清洗【去掉脏数据】、数据集成【集中】、数据变换【规范 化】、数据规约【精简、合并】) </li><li>挖掘建模(分类、聚类、关联、预测) </li><li>模型评价与发布 </li></ol><h3 id="相关模块"><a href="#相关模块" class="headerlink" title="相关模块"></a>相关模块</h3><h4 id="相关模块简介"><a href="#相关模块简介" class="headerlink" title="相关模块简介"></a>相关模块简介</h4><ol><li>numpy 可以高效处理数据、<strong>提供数组支持</strong>、很多模块都依赖他，比如pandas、 scipy、matplotlib都依赖他，所以这个模块是基础。 </li><li>pandas 我们课程后续用得最多的一个模块，主要用于进行<strong>数据探索和数据分析。</strong> </li><li>matplotlib <strong>作图</strong>模块，解决可视化问题。 </li><li>scipy 主要进行<strong>数值计算</strong>，同时支持矩阵运算，并提供了很多高等数据处理功能， 比如积分、傅里叶变换、微分方程求解等。 </li><li>statsmodels 这个模块主要用于<strong>统计分析</strong> </li><li>Gensim 这个模块主要用于<strong>文本挖掘</strong> </li><li>sklearn、keras 前者<strong>机器学习</strong>，后者<strong>深度学习</strong> </li></ol><p><code>numpy</code>、<code>mkl</code>和<code>scipy</code>模块建议下载安装</p><h4 id="相关模块基本使用"><a href="#相关模块基本使用" class="headerlink" title="相关模块基本使用"></a>相关模块基本使用</h4><h5 id="numpy"><a href="#numpy" class="headerlink" title="numpy"></a>numpy</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"></span><br><span class="line">x = numpy.array([<span class="string">&quot;a&quot;</span>,<span class="string">&quot;9&quot;</span>,<span class="string">&quot;2&quot;</span>])</span><br><span class="line"></span><br><span class="line">y = numpy.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line">                 [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>],</span><br><span class="line">                 [<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">                 [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">67</span>]])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(y)</span><br><span class="line"><span class="built_in">print</span>(y[<span class="number">1</span>][<span class="number">2</span>])</span><br></pre></td></tr></table></figure><h5 id="pandas"><a href="#pandas" class="headerlink" title="pandas"></a>pandas</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pda</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Series #index索引</span></span><br><span class="line"><span class="string">DataFrame</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = pda.Series([<span class="number">8</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># index</span></span><br><span class="line">a = pda.Series([<span class="number">8</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">1</span>],index=[<span class="string">&quot;one&quot;</span>,<span class="string">&quot;two&quot;</span>,<span class="string">&quot;three&quot;</span>,<span class="string">&quot;four&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line">b = pda.DataFrame([[<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>],[<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>]])</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line">b = pda.DataFrame([[<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>],[<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>]],columns = [<span class="string">&quot;one&quot;</span>,<span class="string">&quot;two&quot;</span>,<span class="string">&quot;three&quot;</span>,<span class="string">&quot;four&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line">c = pda.DataFrame(&#123;</span><br><span class="line">    <span class="string">&quot;one&quot;</span>:<span class="number">4</span>,</span><br><span class="line">    <span class="string">&quot;two&quot;</span>:[<span class="number">6</span>,<span class="number">5</span>,<span class="number">3</span>],</span><br><span class="line">    <span class="string">&quot;three&quot;</span>:<span class="built_in">list</span>(<span class="built_in">str</span>(<span class="number">982</span>))</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 头部尾部数据，默认前五行</span></span><br><span class="line">d = c.head(<span class="number">2</span>) <span class="comment"># 前两行</span></span><br><span class="line">e = c.tail(<span class="number">1</span>) <span class="comment"># 后一行</span></span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计信息，总计、平均数、标准差、最小、分位数、最大</span></span><br><span class="line"><span class="built_in">print</span>(b.describe())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转置</span></span><br><span class="line"><span class="built_in">print</span>(c.T)</span><br></pre></td></tr></table></figure><h4 id="Python数据导入"><a href="#Python数据导入" class="headerlink" title="Python数据导入"></a>Python数据导入</h4><h5 id="导入excel"><a href="#导入excel" class="headerlink" title="导入excel"></a>导入excel</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pda</span><br><span class="line"></span><br><span class="line">i = pda.read_csv(<span class="string">&quot;/Users/biandudu/Documents/webcrawerfiles/hexun.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(i.describe())</span><br><span class="line"><span class="comment"># 按照某一列排序</span></span><br><span class="line"><span class="built_in">print</span>(i.sort_values(by=<span class="string">&quot;hits&quot;</span>))</span><br><span class="line"></span><br><span class="line">j = pda.read_excel(<span class="string">&quot;/Users/biandudu/Documents/webcrawerfiles/abc.xls&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(j)</span><br></pre></td></tr></table></figure><h5 id="导入mysql"><a href="#导入mysql" class="headerlink" title="导入mysql"></a>导入mysql</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pda</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">conn = pymysql.connect(host=<span class="string">&quot;127.0.0.1&quot;</span>,user=<span class="string">&quot;root&quot;</span>,passwd=<span class="string">&quot;123456&quot;</span>,db=<span class="string">&quot;data_analysis&quot;</span>)</span><br><span class="line"></span><br><span class="line">sql = <span class="string">&quot;select * from company&quot;</span></span><br><span class="line"></span><br><span class="line">k = pda.read_sql(sql,conn)</span><br><span class="line"><span class="built_in">print</span>(k.describe())</span><br></pre></td></tr></table></figure><h5 id="导入html"><a href="#导入html" class="headerlink" title="导入html"></a>导入html</h5><blockquote><p>使用pandas，可以直接从html网页中加载对应table表格中的数据，但是在使用read_html()之前，需要先安装html5lib模块与beautifulsoup4模块。</p></blockquote><p><code>pda.read_html()</code></p><h5 id="导入文本"><a href="#导入文本" class="headerlink" title="导入文本"></a>导入文本</h5><p><code>pda.read_table()</code></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-29%2F1567067381.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Notes" scheme="http://www.ts1989.cn/categories/Notes/"/>
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="Data Analysis" scheme="http://www.ts1989.cn/tags/Data-Analysis/"/>
    
    <category term="DataMine" scheme="http://www.ts1989.cn/tags/DataMine/"/>
    
  </entry>
  
  <entry>
    <title>How Africa is Becoming China&#39;s China</title>
    <link href="http://www.ts1989.cn/2019/05/24/Aferica-China/"/>
    <id>http://www.ts1989.cn/2019/05/24/Aferica-China/</id>
    <published>2019-05-24T14:23:30.000Z</published>
    <updated>2019-08-28T12:40:01.257Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div id="dplayer0" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer0"),"video":{"url":"http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/China.mp4","pic":"http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-28%2F1566993623.png"},"danmaku":{"id":"Africa","api":"https://dplayer.moerats.com/"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script><span id="more"></span>]]></content>
    
    
    <summary type="html">Meanwhile Europe is becoming Africa&#39;s Africa</summary>
    
    
    
    <category term="Video" scheme="http://www.ts1989.cn/categories/Video/"/>
    
    
    <category term="Share" scheme="http://www.ts1989.cn/tags/Share/"/>
    
    <category term="China" scheme="http://www.ts1989.cn/tags/China/"/>
    
  </entry>
  
  <entry>
    <title>MFCC探索</title>
    <link href="http://www.ts1989.cn/2019/01/16/MFCCExplore/"/>
    <id>http://www.ts1989.cn/2019/01/16/MFCCExplore/</id>
    <published>2019-01-16T15:23:52.000Z</published>
    <updated>2019-07-06T03:21:10.347Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562383266.png" alt=""></p><span id="more"></span><h2 id="毕业设计进展报告五——陶家成"><a href="#毕业设计进展报告五——陶家成" class="headerlink" title="毕业设计进展报告五——陶家成"></a>毕业设计进展报告五——陶家成</h2><h2 id="一周主要工作内容"><a href="#一周主要工作内容" class="headerlink" title="一周主要工作内容"></a>一周主要工作内容</h2><ol><li>了解特征提取的过程</li><li>了解MFCC及其实现原理</li><li>了解HMM</li><li>打了一些codeforces的题</li><li>《语音信号处理》、《Automatic Speech Recognition》</li></ol><p>未完成：</p><ul><li>了解傅立叶变换及其在深度学习中的应用</li></ul><h2 id="具体内容"><a href="#具体内容" class="headerlink" title="具体内容"></a>具体内容</h2><h3 id="关于音频特征MFCC提取"><a href="#关于音频特征MFCC提取" class="headerlink" title="关于音频特征MFCC提取"></a>关于音频特征MFCC提取</h3><h4 id="MFCC概述"><a href="#MFCC概述" class="headerlink" title="MFCC概述"></a>MFCC概述</h4><blockquote><p>根据人耳听觉机理的研究发现，人耳对不同频率的声波有不同的听觉敏感度。所以，人们从低频到高频这一段频带内按临界带宽的大小由密到疏安排一组<strong>带通滤波器</strong>，对输入信号进行滤波。将每个带通滤波器输出的信号能量作为信号的基本特征，对此特征经过进一步处理后就可以作为语音的输入特征。由于这种特征不依赖于信号的性质，对输入信号不做任何的假设和限制，又利用了听觉模型的研究成果。因此，这种参数比基于声道模型的LPCC相比具有更好的鲁邦性，更符合人耳的听觉特性，而且当信噪比降低时仍然具有较好的识别性能。</p></blockquote><p>梅尔倒谱系数是在Mel标度频率域提取出来的倒谱参数，Mel标度描述了人耳频率的非线性特性，它与频率的关系可用下式近似表示：</p><p>​                             $Mel(f) = 2595 · lg(1 + f/700)$</p><p>Mel频率与线性频率的关系：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562382522.png" alt=""></p><h4 id="MFCC特征提取过程包括"><a href="#MFCC特征提取过程包括" class="headerlink" title="MFCC特征提取过程包括"></a>MFCC特征提取过程包括</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562382541.png" alt=""></p><ul><li>对音频信号预加重、分帧和加窗</li><li>FFT(快速傅里叶变换)得到频谱</li><li>频谱通过Mel滤波器组得到Mel频谱</li><li>在Mel频谱上面进行倒谱分析得到MFCC特征</li></ul><p>通过这个MFCC特征提取过程，语音就可以通过一系列的倒谱向量来描述了，每个向量就是每帧的MFCC特征向量。语音识别系统就可以接着在MFCC特征的基础上进行训练和识别了。</p><h4 id="预加重"><a href="#预加重" class="headerlink" title="预加重"></a>预加重</h4><blockquote><p>预加重的目的是提升高频部分，对语音的高频部分进行加重，去除口唇辐射的影响，增加语音的高频分辨率使信号的频谱变得平坦，保持在低频到高频的整个频带中，能用同样的信噪比求频谱。原因是因为对于语音信号来说，语音的低频段能量较大，能量主要分布在低频段，语音的功率谱密度随频率的增高而下降，这样，鉴频器输出就会高频段的输出信噪比明显下降，从而导致高频传输衰弱，使高频传输困难，这对信号的质量会带来很大的影响。因此，在传输之前把信号的高频部分进行加重，然后接收端再去重，能够提高信号传输质量。</p></blockquote><p>预加重相当于图片处理中的灰度拉伸/二值化，<strong>「增加识别的准确性」</strong></p><p>预加重其实是将语音信号通过一个<strong>高通滤波器</strong>：</p><p>$x_p(n) = x(n) - k·(n-1)$    （任取k，但是语音处理通常用0.9-0.97）</p><h4 id="分帧"><a href="#分帧" class="headerlink" title="分帧"></a>分帧</h4><blockquote><p>语音信号的变化是非常迅速的，但是通常傅里叶变换适用于分析平稳的信号。我们假设在较短的时间跨度范围内，语音信号的变换是平坦的，一般取这个时间跨度为20ms-40ms。为什么取这个范围呢，因为能够保证一帧内既有足够多的周期，又不会变化太剧烈。</p></blockquote><p>为了<strong>「分离平滑帧」</strong></p><h4 id="加窗"><a href="#加窗" class="headerlink" title="加窗"></a>加窗</h4><blockquote><p>每帧信号通常要与一个平滑的窗函数相乘，让帧两端平滑地衰减到零，这样可以降低傅里叶变换后旁瓣的强度，取得更高质量的频谱。对每一帧，选择一个窗函数，窗函数的宽度就是帧长。常用的窗函数有矩形窗、汉明窗、汉宁窗、高斯窗等。</p></blockquote><p>为了<strong>「取得更高质量的频谱」</strong></p><p>假设分帧后的信号为S(n), n=0,1…,N-1, N为帧的大小，那么乘上汉明窗</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562382595.png" alt=""></p><p>后，W(n)的形式如下：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562382607.png" alt=""></p><h4 id="FFT-快速傅立叶变换"><a href="#FFT-快速傅立叶变换" class="headerlink" title="FFT(快速傅立叶变换)"></a>FFT(快速傅立叶变换)</h4><blockquote><p>由于信号在时域上的变换通常很难看出信号的特性，所以通常将它转换为频域上的能量分布来观察，不同的能量分布，就能代表不同语音的特性。所以在乘上汉明窗后，每帧还必须再经过快速傅里叶变换以得到在频谱上的能量分布。</p></blockquote><p>得到<strong>「频谱的能量分布」</strong></p><p>对语音信号频谱取模平方得到语音信号谱线能量。</p><h4 id="声谱图「重点部分」"><a href="#声谱图「重点部分」" class="headerlink" title="声谱图「重点部分」"></a>声谱图「重点部分」</h4><h5 id="声谱图的作用："><a href="#声谱图的作用：" class="headerlink" title="声谱图的作用："></a>声谱图的作用：</h5><ul><li><strong>音素以及它们的属性更易于观察</strong></li><li><strong>通过观察共振峰和它们的转变可以更好的识别声音</strong> </li><li><strong>隐马尔科夫模型就是隐含地对声谱图进行建模以达到好的识别性能</strong> </li><li><strong>能够直观的评估TTS系统（text to speech）的好坏，直接对比合成的语音和自然的语音声谱图的匹配度即可</strong></li></ul><p>经过前面的预处理，每帧语音都对应一个频谱。</p><p>「但是这部分还是看不太懂」</p><h4 id="计算通过Mel滤波器的能量"><a href="#计算通过Mel滤波器的能量" class="headerlink" title="计算通过Mel滤波器的能量"></a>计算通过Mel滤波器的能量</h4><p>将能量谱通过一组Mel尺度的三角形滤波器组，定义一个有M个滤波器的滤波器组（滤波器的个数和临界带的个数相近），采用的滤波器为三角滤波器，中心频率为f(m) 。M通常取22-26。各f(m)之间的间隔随着m值的减小而缩小，随着m值的增大而增宽，如图所示：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562382633.png" alt=""></p><p>对频谱进行平滑化，并消除谐波的作用，突显原先语音的共振峰。（因此一段语音的音调或音高，是不会呈现在MFCC 参数内，换句话说，以MFCC 为特征的语音辨识系统，并不会受到输入语音的音调不同而有所影响）此外，还可以降低运算量。</p><p>三角滤波器的频率响应定义为: </p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562382647.png" alt=""></p><p>计算每个滤波器组输出的对数能量为 ：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562382655.png" alt=""></p><h4 id="计算DCT倒谱"><a href="#计算DCT倒谱" class="headerlink" title="计算DCT倒谱"></a>计算DCT倒谱</h4><p>经离散余弦变换（DCT）得到MFCC系数 :</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562382675.png" alt=""></p><p>将上述的对数能量带入离散余弦变换，求出L阶的Mel参数。L阶指MFCC系数阶数，通常取12-16。这里M是三角滤波器个数。</p><h4 id="在六大区实现的官方源码中使用HTK实现MFCC和HMM"><a href="#在六大区实现的官方源码中使用HTK实现MFCC和HMM" class="headerlink" title="在六大区实现的官方源码中使用HTK实现MFCC和HMM"></a>在六大区实现的官方源码中使用HTK实现MFCC和HMM</h4><blockquote><p>整个HTK是使用HMM作为语音识别的核心，当HMM应用于孤立词语音识别时，它用不同的隐含状态来描述不同的语音发音，对于连续语音识别系统，多个孤立词HMM子模型按一定的语言模型组成的复合HMM模型序列来刻画连续的语音信号，在序列中每个模型直接对应于相关的发音，并且每一个模型都有进入和退出状态，这两个状态没有对应的观察矢量，只用于不同模型的连接。</p></blockquote><p>HTK是英国剑桥大学开发的一套基于C语言的隐马尔科夫模型工具箱，主要应用于语音识别、语音合成的研究，也被用在其他领域，如字符识别和DNA排序等。HTK是重量级的HMM版本。</p><h5 id="代码位置："><a href="#代码位置：" class="headerlink" title="代码位置："></a>代码位置：</h5><p><code>inferenceLSTM/read_data</code>和<code>inferenceLSTM/HTKfile</code></p><h5 id="HTK文件结构："><a href="#HTK文件结构：" class="headerlink" title="HTK文件结构："></a>HTK文件结构：</h5><p>帧数：4字节（第0-第3字节）</p><p>采样周期：4字节（第4-第7字节）</p><p>每一帧的字节数：2字节（第8-第9字节）</p><p>参数类型：2字节（第10-第11字节）</p><p>数据：N字节（第12字节开始-文件结尾）</p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ol><li>把文件中的主要代码和预处理脚本都理清看懂</li><li>完成采集数据集的准备工作，弄清音频的要求</li><li>弄懂声谱图部分，性能调优的方向之一</li><li>看书《深度学习中文版》<ul><li>第三章——概率与信息论</li><li>第八章——深度模型中的优化</li><li>第十章——循环和递归网络——LSTM</li></ul></li><li>学好算法，打打codeforces</li></ol><p>ADD</p><ul><li>了解傅立叶变换及其在深度学习中的应用</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562383266.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Todo" scheme="http://www.ts1989.cn/categories/Todo/"/>
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="About" scheme="http://www.ts1989.cn/tags/About/"/>
    
  </entry>
  
  <entry>
    <title>Understanding RNN &amp; LSTM</title>
    <link href="http://www.ts1989.cn/2019/01/05/LSTM/"/>
    <id>http://www.ts1989.cn/2019/01/05/LSTM/</id>
    <published>2019-01-05T13:23:54.000Z</published>
    <updated>2019-09-01T06:25:38.550Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div id="dplayer3" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer3"),"video":{"url":"http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/LSTM1.mp4","pic":"http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-09-01%2F1567318915.png"},"danmaku":{"id":"LSTM","api":"https://dplayer.moerats.com/"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script><span id="more"></span>]]></content>
    
    
    <summary type="html">&lt;div id=&quot;dplayer3&quot; class=&quot;dplayer hexo-tag-dplayer-mark&quot; style=&quot;margin-bottom: 20px;&quot;&gt;&lt;/div&gt;&lt;script&gt;(function(){var player = new DPlayer({&quot;container&quot;:document.getElementById(&quot;dplayer3&quot;),&quot;video&quot;:{&quot;url&quot;:&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/LSTM1.mp4&quot;,&quot;pic&quot;:&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-09-01%2F1567318915.png&quot;},&quot;danmaku&quot;:{&quot;id&quot;:&quot;LSTM&quot;,&quot;api&quot;:&quot;https://dplayer.moerats.com/&quot;}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()&lt;/script&gt;</summary>
    
    
    
    <category term="Video" scheme="http://www.ts1989.cn/categories/Video/"/>
    
    
    <category term="Share" scheme="http://www.ts1989.cn/tags/Share/"/>
    
    <category term="LSTM" scheme="http://www.ts1989.cn/tags/LSTM/"/>
    
  </entry>
  
  <entry>
    <title>语音识别初实现</title>
    <link href="http://www.ts1989.cn/2019/01/04/ASRExplore/"/>
    <id>http://www.ts1989.cn/2019/01/04/ASRExplore/</id>
    <published>2019-01-04T09:33:42.000Z</published>
    <updated>2019-07-06T03:19:00.703Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562383060.png" alt=""></p><span id="more"></span><h2 id="语音识别初实现——傅立叶变换、MFCC、HMM"><a href="#语音识别初实现——傅立叶变换、MFCC、HMM" class="headerlink" title="语音识别初实现——傅立叶变换、MFCC、HMM"></a>语音识别初实现——傅立叶变换、MFCC、HMM</h2><h3 id="读取和绘制音频数据"><a href="#读取和绘制音频数据" class="headerlink" title="读取和绘制音频数据"></a>读取和绘制音频数据</h3><blockquote><p>读取音频文件并可视化展现</p></blockquote><p>音频文件是实际音频信哈的数字化形式，实际的音频信号是复杂的连续波形。为了将其保存成数字化形式，需要对音频信号进行采样并将其转换成数字。语音通常以44100 Hz的频率进行采样，这就意味着每秒钟信号被分解成44100份，然后这些抽样值被保存。</p><h5 id="代码实现："><a href="#代码实现：" class="headerlink" title="代码实现："></a>代码实现：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> wavfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用wavfile包从input_read.wav中读取音频文件:</span></span><br><span class="line">sampling_freq, audio = wavfile.read(<span class="string">&#x27;input_read.wav&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印信号相关参数</span></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;\nShape:&#x27;</span>, audio.shape)</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;Datatype:&#x27;</span>, audio.dtype)</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;Duration:&#x27;</span>, <span class="built_in">round</span>(audio.shape[<span class="number">0</span>] / <span class="built_in">float</span>(sampling_freq), <span class="number">3</span>), <span class="string">&#x27;seconds&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准化</span></span><br><span class="line">audio = audio / (<span class="number">2.</span>**<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取前30个值画图</span></span><br><span class="line">audio = audio[:<span class="number">30</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立时间轴，x轴按照采样频率因子进行缩放</span></span><br><span class="line">x_values = np.arange(<span class="number">0</span>, <span class="built_in">len</span>(audio), <span class="number">1</span>) / <span class="built_in">float</span>(sampling_freq)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单位转换为seconds</span></span><br><span class="line">x_values *= <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 画出声音信号图形</span></span><br><span class="line">plt.plot(x_values, audio, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Time (ms)&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Amplitude&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Audio signal&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562381661.png" alt=""></p><h3 id="将音频信号转化为频域"><a href="#将音频信号转化为频域" class="headerlink" title="将音频信号转化为频域"></a>将音频信号转化为频域</h3><blockquote><p>音频信号是不同频率、幅度和相位的正弦波的复杂混合。正弦波也称作正弦曲线。音频信号的频率内容中隐藏了很多信息。事实上，一个音频信号的性质由其频率内容决定。世界上的语音和音乐都是基于这个事实的。</p></blockquote><p>//Todo 傅立叶变换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> wavfile</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read the input file</span></span><br><span class="line">sampling_freq, audio = wavfile.read(<span class="string">&#x27;input_freq.wav&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Normalize the values</span></span><br><span class="line">audio = audio / (<span class="number">2.</span>**<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取数组长度</span></span><br><span class="line">len_audio = <span class="built_in">len</span>(audio)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 傅立叶变换，因为傅立叶变换是关于中心点对称的，因此只需要转换信号的前半部分。</span></span><br><span class="line"><span class="comment"># 最终目标是提取功率信号，先将信号的值平方</span></span><br><span class="line">transformed_signal = np.fft.fft(audio)</span><br><span class="line">half_length = np.ceil((len_audio + <span class="number">1</span>) / <span class="number">2.0</span>)</span><br><span class="line">transformed_signal = <span class="built_in">abs</span>(transformed_signal[<span class="number">0</span>:half_length])</span><br><span class="line">transformed_signal /= <span class="built_in">float</span>(len_audio)</span><br><span class="line">transformed_signal **= <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取信号长度</span></span><br><span class="line">len_ts = <span class="built_in">len</span>(transformed_signal)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将部分信号乘以2</span></span><br><span class="line"><span class="keyword">if</span> len_audio % <span class="number">2</span>:</span><br><span class="line">    transformed_signal[<span class="number">1</span>:len_ts] *= <span class="number">2</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    transformed_signal[<span class="number">1</span>:len_ts-<span class="number">1</span>] *= <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取功率信号</span></span><br><span class="line">power = <span class="number">10</span> * np.log10(transformed_signal)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build the time axis</span></span><br><span class="line">x_values = np.arange(<span class="number">0</span>, half_length, <span class="number">1</span>) * (sampling_freq / len_audio) / <span class="number">1000.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot the figure</span></span><br><span class="line">plt.figure()</span><br><span class="line">plt.plot(x_values, power, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Freq (in kHz)&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Power (in dB)&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562381699.png" alt=""></p><h3 id="提取频域特征"><a href="#提取频域特征" class="headerlink" title="提取频域特征"></a>提取频域特征</h3><blockquote><p>将信号转换为频域之后，还需要将其转换成有用的形式。<strong>梅尔频率倒谱系数</strong>(Mel Frequency Cepstrum Coefficient，MFCC)可以解决这个问题。MFCC首先计算信号的功率谱，然后用滤波器组和离散余弦变换的组合来提取特征。</p></blockquote><p>//Todo 梅尔频率倒谱系数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> wavfile </span><br><span class="line"><span class="keyword">from</span> features <span class="keyword">import</span> mfcc, logfbank</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read input sound file</span></span><br><span class="line">sampling_freq, audio = wavfile.read(<span class="string">&quot;input_freq.wav&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract MFCC and Filter bank features</span></span><br><span class="line"><span class="comment"># 提取MFCC和过滤器组特征</span></span><br><span class="line">mfcc_features = mfcc(audio, sampling_freq)</span><br><span class="line">filterbank_features = logfbank(audio, sampling_freq)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print parameters</span></span><br><span class="line"><span class="comment"># 查看可以生成多少个窗体</span></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;\nMFCC:\nNumber of windows =&#x27;</span>, mfcc_features.shape[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;Length of each feature =&#x27;</span>, mfcc_features.shape[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;\nFilter bank:\nNumber of windows =&#x27;</span>, filterbank_features.shape[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;Length of each feature =&#x27;</span>, filterbank_features.shape[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot the features</span></span><br><span class="line"><span class="comment"># 画出特征图</span></span><br><span class="line">mfcc_features = mfcc_features.T</span><br><span class="line">plt.matshow(mfcc_features)</span><br><span class="line">plt.title(<span class="string">&#x27;MFCC&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 滤波器组特征可视化，需要转换矩阵，使得域是水平的</span></span><br><span class="line">filterbank_features = filterbank_features.T</span><br><span class="line">plt.matshow(filterbank_features)</span><br><span class="line">plt.title(<span class="string">&#x27;Filter bank&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h3 id="创建一个隐马尔可夫模型"><a href="#创建一个隐马尔可夫模型" class="headerlink" title="创建一个隐马尔可夫模型"></a>创建一个隐马尔可夫模型</h3><blockquote><p>本例将用到隐马尔科夫模型(Hidden Markov Models，HMMs)来做语音识别。隐马尔科夫模型非常擅长建立时间序列数据模型。因为一个音频信号同时也是一个时间序列信号，因此隐马尔科夫模型也同样适用于音频信号的处理。假定输出是通过隐藏状态生成的，我们的目标是找到这些隐藏状态，以便对信号建模。</p></blockquote><p>// Todo 隐马尔科夫模型</p><h3 id="创建一个语音识别器"><a href="#创建一个语音识别器" class="headerlink" title="创建一个语音识别器"></a>创建一个语音识别器</h3><blockquote><p>我们需要为每一类构建一个隐马尔科夫模型。如果想识别新的输入文件中的单词，需要对该文件运行所有的模型，并找出最佳分数的结果。下面将用到在前一节构建的隐马尔科夫类。 </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> argparse </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> wavfile </span><br><span class="line"><span class="keyword">from</span> hmmlearn <span class="keyword">import</span> hmm</span><br><span class="line"><span class="keyword">from</span> features <span class="keyword">import</span> mfcc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于解析命令行中输入的参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_arg_parser</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Trains the HMM classifier&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--input-folder&quot;</span>, dest=<span class="string">&quot;input_folder&quot;</span>, required=<span class="literal">True</span>,</span><br><span class="line">            <span class="built_in">help</span>=<span class="string">&quot;Input folder containing the audio files in subfolders&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> parser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建类处理HHM相关过程</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HMMTrainer</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="comment"># 初始化该类。下面将用到高斯隐马尔科夫模型(Gaussian HMMs)来对数据建模。参数 n_components定义了隐藏状态的个数，参数cov_type定义了转移矩阵的协方差类型，参数 n_iter定义了训练的迭代次数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_name=<span class="string">&#x27;GaussianHMM&#x27;</span>, n_components=<span class="number">4</span>, cov_type=<span class="string">&#x27;diag&#x27;</span>, n_iter=<span class="number">1000</span></span>):</span><br><span class="line">        <span class="comment">#  初始化变量</span></span><br><span class="line">        self.model_name = model_name</span><br><span class="line">        self.n_components = n_components</span><br><span class="line">        self.cov_type = cov_type</span><br><span class="line">        self.n_iter = n_iter</span><br><span class="line">        self.models = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 用以下参数定义模型</span></span><br><span class="line">        <span class="keyword">if</span> self.model_name == <span class="string">&#x27;GaussianHMM&#x27;</span>:</span><br><span class="line">            self.model = hmm.GaussianHMM(n_components=self.n_components, </span><br><span class="line">                    covariance_type=self.cov_type, n_iter=self.n_iter)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Invalid model type&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输入数据是一个NumPy数组，数组的每个元素都是一个特征向量，每个特征向量都包含k 个维度</span></span><br><span class="line">    <span class="comment"># X is a 2D numpy array where each row is 13D</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">self, X</span>):</span><br><span class="line">        np.seterr(<span class="built_in">all</span>=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">        self.models.append(self.model.fit(X))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 基于该模型定义一个提取分数的方法</span></span><br><span class="line">    <span class="comment"># Run the model on input data</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_score</span>(<span class="params">self, input_data</span>):</span><br><span class="line">        <span class="keyword">return</span> self.model.score(input_data)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 定义一个main函数，解析输入的参数</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    args = build_arg_parser().parse_args()</span><br><span class="line">    input_folder = args.input_folder</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化隐马尔科夫模型的变量</span></span><br><span class="line">    hmm_models = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解析包含所有数据库音频文件的输入路径</span></span><br><span class="line">    <span class="keyword">for</span> dirname <span class="keyword">in</span> os.listdir(input_folder):</span><br><span class="line">        <span class="comment"># 提取子文件夹的名称 </span></span><br><span class="line">        subfolder = os.path.join(input_folder, dirname)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(subfolder): </span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 子文件夹的名称即为该类的标记，提取标记</span></span><br><span class="line">        label = subfolder[subfolder.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化变量</span></span><br><span class="line">        X = np.array([])</span><br><span class="line">        y_words = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 迭代每一个子文件夹中的音频文件（分别保留一个进行测试）</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir(subfolder) <span class="keyword">if</span> x.endswith(<span class="string">&#x27;.wav&#x27;</span>)][:-<span class="number">1</span>]:</span><br><span class="line">            <span class="comment"># 读取每个音频文件</span></span><br><span class="line">            filepath = os.path.join(subfolder, filename)</span><br><span class="line">            sampling_freq, audio = wavfile.read(filepath)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 提取MFCC特征</span></span><br><span class="line">            mfcc_features = mfcc(audio, sampling_freq)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 将MFCC特征添加到X变量</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(X) == <span class="number">0</span>:</span><br><span class="line">                X = mfcc_features</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                X = np.append(X, mfcc_features, axis=<span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加标记</span></span><br><span class="line">            y_words.append(label)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;X.shape =&#x27;</span>, X.shape</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 一旦提取完当前类所有文件的特征，就可以训练并保存隐马尔科夫模型了。因为隐马尔科夫模型是一个无监督学习的生成模型，所以并不需要利用标记针对每一类构建隐马尔科夫模型。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Train and save HMM model</span></span><br><span class="line">        hmm_trainer = HMMTrainer()</span><br><span class="line">        hmm_trainer.train(X)</span><br><span class="line">        hmm_models.append((hmm_trainer, label))</span><br><span class="line">        hmm_trainer = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Test files（获取一个未被用于训练的测试文件列表）</span></span><br><span class="line">    input_files = [</span><br><span class="line">            <span class="string">&#x27;data/pineapple/pineapple15.wav&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;data/orange/orange15.wav&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;data/apple/apple15.wav&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;data/kiwi/kiwi15.wav&#x27;</span></span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 为输入数据分类</span></span><br><span class="line">    <span class="keyword">for</span> input_file <span class="keyword">in</span> input_files:</span><br><span class="line">        <span class="comment"># Read input file</span></span><br><span class="line">        sampling_freq, audio = wavfile.read(input_file)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 提取MFCC特征</span></span><br><span class="line">        mfcc_features = mfcc(audio, sampling_freq)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Define variables</span></span><br><span class="line">        max_score = <span class="literal">None</span></span><br><span class="line">        output_label = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 迭代HMM模型并选取得分最高的模型</span></span><br><span class="line">        <span class="comment"># the one with the highest score</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> hmm_models:</span><br><span class="line">            hmm_model, label = item</span><br><span class="line">            <span class="comment"># 提取并保存最大分数</span></span><br><span class="line">            score = hmm_model.get_score(mfcc_features)</span><br><span class="line">            <span class="keyword">if</span> score &gt; max_score:</span><br><span class="line">                max_score = score</span><br><span class="line">                output_label = label</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Print the output</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;\nTrue:&quot;</span>, input_file[input_file.find(<span class="string">&#x27;/&#x27;</span>)+<span class="number">1</span>:input_file.rfind(<span class="string">&#x27;/&#x27;</span>)]</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Predicted:&quot;</span>, output_label </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-07-06%2F1562383060.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Todo" scheme="http://www.ts1989.cn/categories/Todo/"/>
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="About" scheme="http://www.ts1989.cn/tags/About/"/>
    
  </entry>
  
  <entry>
    <title>深度学习初探</title>
    <link href="http://www.ts1989.cn/2019/01/03/DLWithPyFirstExlpore/"/>
    <id>http://www.ts1989.cn/2019/01/03/DLWithPyFirstExlpore/</id>
    <published>2019-01-02T17:22:26.000Z</published>
    <updated>2019-01-02T09:47:16.063Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422431.png" alt=""></p><span id="more"></span><h2 id="深度学习初探——基于Python的理论和实现"><a href="#深度学习初探——基于Python的理论和实现" class="headerlink" title="深度学习初探——基于Python的理论和实现"></a>深度学习初探——基于Python的理论和实现</h2><h3 id="此书特点："><a href="#此书特点：" class="headerlink" title="此书特点："></a>此书特点：</h3><ul><li>从零开始实现深度学习程序</li><li>最终实现一个高精度识别图像的系统</li><li>从实现层面理解误差反向传播法、卷积运算</li><li>不介绍深度学习框架</li><li>不介绍参数调优</li><li>不进行GPU相关实现</li></ul><p>目标：有能力进一步去阅读最新的论文或者神经网络相关的理论方面的技术书。</p><h3 id="Python入门"><a href="#Python入门" class="headerlink" title="Python入门"></a>Python入门</h3><h4 id="Numpy"><a href="#Numpy" class="headerlink" title="Numpy"></a>Numpy</h4><blockquote><p>在深度学习的实现中，经常出现数组和矩阵的计算。NumPy 的数组类 (numpy.array)中提供了很多便捷的方法，在实现深度学习时，我们将使用这些方法。</p></blockquote><h5 id="导入Numpy库"><a href="#导入Numpy库" class="headerlink" title="导入Numpy库"></a>导入Numpy库</h5><p>Python中使用import语句来导入库。这里的import numpy as np，直译的话就是“将 numpy 作为 np 导入”的意思。通过写成这样的形式，之后NumPy 相关的方法均可通过 np 来调用。</p><h5 id="生成Numpy数组"><a href="#生成Numpy数组" class="headerlink" title="生成Numpy数组"></a>生成Numpy数组</h5><p>生成 NumPy 数组，需要使用 np.array() 方法。</p><h5 id="Numpy的算数运算"><a href="#Numpy的算数运算" class="headerlink" title="Numpy的算数运算"></a>Numpy的算数运算</h5><p>当数组 x 和数组 y 的元素个数相同时，可以对各个元素进行算术运算。</p><h5 id="Numpy的N维数组"><a href="#Numpy的N维数组" class="headerlink" title="Numpy的N维数组"></a>Numpy的N维数组</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A = np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br></pre></td></tr></table></figure><h5 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h5><p>形状不同的数组之间也可以进行运算。标量数组扩展成2*2数组再计算，称之为广播。</p><h5 id="访问元素"><a href="#访问元素" class="headerlink" title="访问元素"></a>访问元素</h5><p>逐个访问，for语句访问，数组访问</p><h4 id="Matplotlib"><a href="#Matplotlib" class="headerlink" title="Matplotlib"></a>Matplotlib</h4><blockquote><p>在深度学习的实验中，图形的绘制和数据的可视化非常重要。Matplotlib是用于绘制图形的库，使用 Matplotlib 可以轻松地绘制图形和实现数据的可视化。</p></blockquote><h5 id="pyplot的功能"><a href="#pyplot的功能" class="headerlink" title="pyplot的功能"></a>pyplot的功能</h5><p>添加标题和x轴标签名等功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成数据</span></span><br><span class="line">x = np.arange(<span class="number">0</span>, <span class="number">6</span>, <span class="number">0.1</span>) <span class="comment"># 以0.1为单位，生成0到6的数据</span></span><br><span class="line">y1 = np.sin(x)</span><br><span class="line">y2 = np.cos(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制图形</span></span><br><span class="line">plt.plot(x, y1, label=<span class="string">&quot;sin&quot;</span>)</span><br><span class="line">plt.plot(x, y2, linestyle = <span class="string">&quot;--&quot;</span>, label=<span class="string">&quot;cos&quot;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&quot;x&quot;</span>) <span class="comment"># x轴的标签</span></span><br><span class="line">plt.ylabel(<span class="string">&quot;y&quot;</span>) <span class="comment"># y轴的标签</span></span><br><span class="line">plt.title(<span class="string">&#x27;sin &amp; cos&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421376.png" alt=""></p><h5 id="显示图像"><a href="#显示图像" class="headerlink" title="显示图像"></a>显示图像</h5><p>pyplot提供了用于显示图像的方法imshow()。另外，可以使用matplotlib.image 模块的 imread() 方法读入图像。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.image <span class="keyword">import</span> imread</span><br><span class="line"></span><br><span class="line">img = imread(<span class="string">&#x27;../dataset/lena.png&#x27;</span>) <span class="comment">#读入图像</span></span><br><span class="line">plt.imshow(img)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421755.png" alt=""></p><p>图像放在dataset目录下，可以直接读取。</p><h3 id="感知机"><a href="#感知机" class="headerlink" title="感知机"></a>感知机</h3><h4 id="感知机是什么？"><a href="#感知机是什么？" class="headerlink" title="感知机是什么？"></a>感知机是什么？</h4><blockquote><p>感知机是作为神经网络(深度学习)的起源的算法。感知机接收多个输入信号，输出一个信号。这里所说的“信号”可以想象成电流或河流那样具备“流动性”的东西。像电流流过导线，向前方输送电子一样，感知机的信号也会形成流，向前方输送信息。但是，和实际的电流不同的是，感知机的信号只有“流 / 不流”(1/0)两种取值。</p></blockquote><p>x1、x2 是输入信号，y是输出信号，w1、w2 是权重(w是weight的首字母)。图中的○称为“神经元”或者“节点”。输入信号被送往神经元时，会被分别乘以固定的权重(w1x1、w2x2)。神经元会计算传送过来的信号的总和，只有当这个总和超过了某个界限值时，才会输出1。这也称为“神经元被激活”。b称为偏置的参数，用于控制神经元被激活的容易程度。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421775.png" alt=""></p><p>数学表示：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421787.png" alt=""></p><p>感知机多个输入信号有各自的权重，这些权重发挥着控制着各个信号的重要性的作用。权重越大，信号的重要性就越高。（权重相当于电流中的电阻，电阻决定电流流动难度的参数）</p><h4 id="简单逻辑电路"><a href="#简单逻辑电路" class="headerlink" title="简单逻辑电路"></a>简单逻辑电路</h4><p>我们已经知道使用感知机可以表示与门、与非门、或门的逻辑电路。这里重要的一点是:与门、与非门、或门的感知机构造是一样的。实 际 上 ， 3 个门电路只有参数的值(权重和阈值)不同 。</p><h5 id="感知机的实现"><a href="#感知机的实现" class="headerlink" title="感知机的实现"></a>感知机的实现</h5><p>使用权重和偏置实现与门：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AND</span>(<span class="params">x1, x2</span>):</span><br><span class="line">    x = np.array([x1, x2])</span><br><span class="line">    w = np.array([<span class="number">0.5</span>, <span class="number">0.5</span>])</span><br><span class="line">    b = -<span class="number">0.7</span></span><br><span class="line">    tmp = np.<span class="built_in">sum</span>(w*x) + b</span><br><span class="line">    <span class="keyword">if</span> tmp &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> xs <span class="keyword">in</span> [(<span class="number">0</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>)]:</span><br><span class="line">        y = AND(xs[<span class="number">0</span>], xs[<span class="number">1</span>])</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(xs) + <span class="string">&quot; -&gt; &quot;</span> + <span class="built_in">str</span>(y))</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421816.png" alt=""></p><p>使用感知机可以实现与门、与非门、或门三种逻辑电路。 </p><h5 id="感知机的局限性"><a href="#感知机的局限性" class="headerlink" title="感知机的局限性"></a>感知机的局限性</h5><ul><li>感知机无法实现异或门</li><li>感知机无法表示曲线</li></ul><h5 id="多层感知机"><a href="#多层感知机" class="headerlink" title="多层感知机"></a>多层感知机</h5><ul><li>通过组合与门、与非门、或门实现异或门</li></ul><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421835.png" alt=""></p><p>通过叠加层(加深层)，感知机能进行更加灵活的表示。</p><h3 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h3><blockquote><p>感知机的作用是：即便对于复杂的函数，也隐含着能够表示它的可能性。神经网络的一个重要性质是可以自动从数据中学习合适的权重参数。</p></blockquote><h4 id="从感知机到神经网络"><a href="#从感知机到神经网络" class="headerlink" title="从感知机到神经网络"></a>从感知机到神经网络</h4><h5 id="神经网络的例子"><a href="#神经网络的例子" class="headerlink" title="神经网络的例子"></a>神经网络的例子</h5><p>用图来表示神经网络，分为输入层、输出层和中间层。中间层也叫隐藏层，隐藏层的神经元肉眼看不见。神经元的连接方式而言，与感知机并无差别。</p><h5 id="复习感知机"><a href="#复习感知机" class="headerlink" title="复习感知机"></a>复习感知机</h5><p>明确表示出偏置，简化式子，引入新函数h(x) ：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421861.png" alt=""></p><h5 id="激活函数"><a href="#激活函数" class="headerlink" title="激活函数"></a>激活函数</h5><p>h(x)函数会将输入信号的总和转换为输出信号，这种函数一般称为激活函数(activation function)。激活函数的<br>作用在于决定如何来激活输入信号的总和。</p><p>先计算输入信号的加权总和，然后用激活函数转换这一总和：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421883.png" alt=""></p><p>明确显示激活函数计算过程的神经元 ：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421894.png" alt=""></p><p>信号的加权总和为节点 a，然后节点 a 被激活函数 h() 转换成节点 y。“神经元”和“节点”两个术语的含义相同。</p><p>激活函数是连接感知机和神经网络的桥梁。</p><h4 id="激活函数-1"><a href="#激活函数-1" class="headerlink" title="激活函数"></a>激活函数</h4><blockquote><p>激活函数以阈值为界，一旦输入超过阈值，就切换输出。这样的函数称为“阶跃函数”。因此，可以说感知机中使用了阶跃函数作为激活函数。也就是说，在激活函数的众多候选函数中，感知机使用了阶跃函数。那么，如果感知机使用其他函数作为激活函数的话会怎么样呢?实际上，如果将激活函数从阶跃函数换成其他函数，就可以进入神经网络的世界了。</p></blockquote><h5 id="sigmoid函数"><a href="#sigmoid函数" class="headerlink" title="sigmoid函数"></a>sigmoid函数</h5><p>神经网络经常使用的一个激活函数sigmoid函数：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421908.png" alt=""></p><p>神经网络利用sigmoid函数作为激活函数，进行信号的转换，转换后的信号被传送到下一个神经元。感知机和神经网络的主要区别就在于这个激活函数。在其它方面，比如神经元的多层连接的构造，信号的传递方法等，基本上和感知机是一样的。</p><h5 id="阶跃函数的实现"><a href="#阶跃函数的实现" class="headerlink" title="阶跃函数的实现"></a>阶跃函数的实现</h5><p>简单的阶跃函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">step_function</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>支持NumPy数组的实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">step_function</span>(<span class="params">x</span>):</span><br><span class="line">    y = x &gt; <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> y.astype(np.<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure><p>NumPy数组进行不等号运算后，数组的各个元素都会进行不等号运算，生成一个布尔型的数组。数组y是个布尔型的数组，但是阶跃函数是会输出int型的0或1的函数。因此需要转换为int型。</p><p>可以用 astype() 方法转换 NumPy 数组的类型。astype() 方法通过参数指定期望的类型，这个例子中是 np.int 型。</p><h5 id="阶跃函数的图形"><a href="#阶跃函数的图形" class="headerlink" title="阶跃函数的图形"></a>阶跃函数的图形</h5><p>图形上表示上面定义的阶跃函数，需要用到matplotlib库：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pylab <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_function</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> np.array(x &gt; <span class="number">0</span>, dtype = np.<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#−5.0到5.0的范围内，以0.1为单位，生成 NumPy数组([-5.0, -4.9, ..., 4.9])</span></span><br><span class="line">x = np.arange(-<span class="number">5.0</span>,<span class="number">5.0</span>,<span class="number">0.1</span>)</span><br><span class="line"><span class="comment">#step_function()以该NumPy数组为 参数，对数组的各个元素执行阶跃函数运算，并以数组形式返回运算结果。</span></span><br><span class="line">y = step_function(x)</span><br><span class="line">plt.plot(x,y)</span><br><span class="line">plt.ylim(-<span class="number">0.1</span>,<span class="number">1.1</span>)<span class="comment">#指定y轴的范围</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>阶跃函数以 0 为界，输出从 0 切换为 1(或者从 1 切换为 0)。 它的值呈阶梯式变化，所以称为阶跃函数。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421929.png" alt=""></p><h5 id="sigmoid函数的实现"><a href="#sigmoid函数的实现" class="headerlink" title="sigmoid函数的实现"></a>sigmoid函数的实现</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> + np.exp(-x))</span><br><span class="line"></span><br><span class="line">x = np.array([-<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">2.0</span>])</span><br><span class="line">sigmoid(x)</span><br></pre></td></tr></table></figure><p>在python中可以如此表示sigmoid函数，当传入参数x为NumPy数组时，也能被正确计算，是因为NumPy的广播功能。</p><p>现在把上面的阶跃函数换成sigmoid函数：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421949.png" alt=""></p><p>sigmoid函数和阶跃函数的比较：</p><ul><li>sigmoid函数是一条平滑的曲线，输入输出发生连续的变化。阶跃则是以0为界，急剧变化。</li><li>阶跃函数只能返回0和1，sigmoid函数可以返回实数</li><li>都是非线性函数：<ul><li>激活函数不能使用线性函数，使用线性函数，加深网络的层数就没有意义了。</li><li>线性函数无法发挥多层网络带来的优势</li></ul></li></ul><h5 id="ReLU函数"><a href="#ReLU函数" class="headerlink" title="ReLU函数"></a>ReLU函数</h5><p>sigmoid早就开始用了，现在主要使用ReLU（Rectified Linear Unit）函数。</p><p>ReLU函数输入大于 0 时，直接输出该值;在输入小于等于 0 时，输出 0 ：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421963.png" alt=""></p><p>ReLU函数的实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">relu</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> np.maximum(<span class="number">0</span>,x)</span><br></pre></td></tr></table></figure><h4 id="多维数组的运算"><a href="#多维数组的运算" class="headerlink" title="多维数组的运算"></a>多维数组的运算</h4><p>多维数组运算可以高效实现神经网络</p><h5 id="二维矩阵"><a href="#二维矩阵" class="headerlink" title="二维矩阵"></a>二维矩阵</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">B = np.array([[<span class="number">1</span>,<span class="number">2</span>], [<span class="number">3</span>,<span class="number">4</span>], [<span class="number">5</span>,<span class="number">6</span>]])</span><br></pre></td></tr></table></figure><p>矩阵的乘积：（np.dot(A, B)和np.dot(B, A)不同）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A = np.array([[<span class="number">1</span>,<span class="number">2</span>], [<span class="number">3</span>,<span class="number">4</span>]])</span><br><span class="line">B = np.array([[<span class="number">5</span>,<span class="number">6</span>], [<span class="number">7</span>,<span class="number">8</span>]])</span><br><span class="line">np.dot(A, B)</span><br></pre></td></tr></table></figure><p>A的列数必须和B的行数相等才能计算np.dot(A,B)</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421976.png" alt=""></p><h5 id="神经网络的内积"><a href="#神经网络的内积" class="headerlink" title="神经网络的内积"></a>神经网络的内积</h5><p>使用NumPy矩阵实现神经网络：（省略了偏置和激活函数，只有权重）</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546421988.png" alt=""></p><h4 id="三层神经网络的实现"><a href="#三层神经网络的实现" class="headerlink" title="三层神经网络的实现"></a>三层神经网络的实现</h4><p>巧妙使用NumPy数组，可以使用很少的代码实现神经网络的前向处理。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422003.png" alt=""></p><h5 id="符号确认"><a href="#符号确认" class="headerlink" title="符号确认"></a>符号确认</h5><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422018.png" alt=""></p><p>表示前一层的第 2 个神经元 x2 到后一层的第 1 个神经元 的权重。w(weight)</p><h5 id="各层间信号传递的实现"><a href="#各层间信号传递的实现" class="headerlink" title="各层间信号传递的实现"></a>各层间信号传递的实现</h5><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422034.png" alt=""></p><p>矩阵乘法运算，则可以表示成：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422046.png" alt=""></p><p>代码简单实现上述式子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">X = np.array([<span class="number">1.0</span>, <span class="number">0.5</span>])</span><br><span class="line">W1 = np.array([[<span class="number">0.1</span>, <span class="number">0.3</span>, <span class="number">0.5</span>], [<span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.6</span>]]) </span><br><span class="line">B1 = np.array([<span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">0.3</span>])</span><br><span class="line"></span><br><span class="line">A1 = np.dot(X, W1) + B1 <span class="comment">#x的列数和w的行数相同，w和x对应维度的个数也保持一致</span></span><br><span class="line"><span class="comment">#前面的乘积的到一个3列，加上B的3列</span></span><br></pre></td></tr></table></figure><p>隐藏层的加权和(加权信号和偏置的总和)用 a 表示，被激活函数转换后的信号用 z 表示。此外，图中 h() 表示激活函数，这里我们使用的是 sigmoid 函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Z1 = sigmoid(A1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(A1)</span><br><span class="line"><span class="built_in">print</span>(Z1)</span><br></pre></td></tr></table></figure><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422064.png" alt=""><br>下面实现第一层到第二层的信号传递：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">W2 = np.array([[<span class="number">0.1</span>, <span class="number">0.4</span>], [<span class="number">0.2</span>, <span class="number">0.5</span>], [<span class="number">0.3</span>, <span class="number">0.6</span>]])</span><br><span class="line">B2 = np.array([<span class="number">0.1</span>, <span class="number">0.2</span>])</span><br><span class="line"><span class="built_in">print</span>(Z1.shape) <span class="comment"># (3,) </span></span><br><span class="line"><span class="built_in">print</span>(W2.shape) <span class="comment"># (3, 2) </span></span><br><span class="line"><span class="built_in">print</span>(B2.shape) <span class="comment"># (2,)</span></span><br><span class="line">A2 = np.dot(Z1, W2) + B2 </span><br><span class="line">Z2 = sigmoid(A2)</span><br></pre></td></tr></table></figure><p>实现基本相同，但是最后的激活函数和隐藏层的有所不同。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">identity_function</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">W3 = np.array([[<span class="number">0.1</span>, <span class="number">0.3</span>], [<span class="number">0.2</span>, <span class="number">0.4</span>]]) </span><br><span class="line">B3 = np.array([<span class="number">0.1</span>, <span class="number">0.2</span>])</span><br><span class="line"></span><br><span class="line">A3 = np.dot(Z2, W3) + B3</span><br><span class="line">Y = identity_function(A3) <span class="comment"># 或者Y = A3</span></span><br></pre></td></tr></table></figure><p>这里的identity_function()函数（恒等函数），并将其作为输出层的激活函数。这样实现只是为了和之前的流程保持统一。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422080.png" alt=""></p><p>输出层所用的函数：根据求解问题的性质决定：</p><ul><li>回归问题用恒等函数</li><li>二元分类问题使用sigmoid函数</li><li>多元分类问题使用softmax函数</li></ul><h5 id="代码实现小结"><a href="#代码实现小结" class="headerlink" title="代码实现小结"></a>代码实现小结</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init_network</span>():</span><br><span class="line">    <span class="comment">#初始化为字典变量&#123;&#125;</span></span><br><span class="line">    network = &#123;&#125;</span><br><span class="line">    network[<span class="string">&#x27;W1&#x27;</span>] = np.array([[<span class="number">0.1</span>, <span class="number">0.3</span>, <span class="number">0.5</span>], [<span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.6</span>]])</span><br><span class="line">    network[<span class="string">&#x27;b1&#x27;</span>] = np.array([<span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">0.3</span>])</span><br><span class="line">    network[<span class="string">&#x27;W2&#x27;</span>] = np.array([[<span class="number">0.1</span>, <span class="number">0.4</span>], [<span class="number">0.2</span>, <span class="number">0.5</span>], [<span class="number">0.3</span>, <span class="number">0.6</span>]])</span><br><span class="line">    network[<span class="string">&#x27;b2&#x27;</span>] = np.array([<span class="number">0.1</span>, <span class="number">0.2</span>])</span><br><span class="line">    network[<span class="string">&#x27;W3&#x27;</span>] = np.array([[<span class="number">0.1</span>, <span class="number">0.3</span>], [<span class="number">0.2</span>, <span class="number">0.4</span>]])</span><br><span class="line">    network[<span class="string">&#x27;b3&#x27;</span>] = np.array([<span class="number">0.1</span>, <span class="number">0.2</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> network</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">network,x</span>):</span><br><span class="line">    W1, W2, W3 = network[<span class="string">&#x27;W1&#x27;</span>], network[<span class="string">&#x27;W2&#x27;</span>], network[<span class="string">&#x27;W3&#x27;</span>] </span><br><span class="line">    b1, b2, b3 = network[<span class="string">&#x27;b1&#x27;</span>], network[<span class="string">&#x27;b2&#x27;</span>], network[<span class="string">&#x27;b3&#x27;</span>]</span><br><span class="line">    a1 = np.dot(x, W1) + b1 z1 = sigmoid(a1)</span><br><span class="line">    a2 = np.dot(z1, W2) + b2 z2 = sigmoid(a2)</span><br><span class="line">    a3 = np.dot(z2, W3) + b3 y = identity_function(a3)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">network = init_network()</span><br><span class="line">x = np.array([<span class="number">1.0</span>, <span class="number">0.5</span>])</span><br><span class="line">y = forward(network, x)</span><br><span class="line"><span class="built_in">print</span>(y) <span class="comment"># [ 0.31682708 0.69627909]</span></span><br></pre></td></tr></table></figure><p>定义了init_network()和forward()函数，分别进行权重的初始化和信号处理。后面会有backword()处理函数（从输出往输入方向的处理）。通过NumPy的多维数组，高效地实现了神经网络。</p><h4 id="输出层的设计"><a href="#输出层的设计" class="headerlink" title="输出层的设计"></a>输出层的设计</h4><p>神经网络可以用在分类问题和回归问题上，需要根据情况改变输出层的激活函数，回归问题用恒等函数，分类问题用softmax函数。</p><h5 id="恒等函数和softmax-函数"><a href="#恒等函数和softmax-函数" class="headerlink" title="恒等函数和softmax 函数"></a>恒等函数和softmax 函数</h5><p>和前面隐藏层的激活函数一样，恒等函数进行的转换处理可以用一根箭头表示。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422096.png" alt=""></p><p>分类问题中的softmax函数可以用下面的式子表示：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422108.png" alt=""></p><p>softmax 函数的分子是输入信号 ak 的指数函数，分母是所有输入信号的指数函数的和。</p><p>softmax函数的输出通过肩头和所有的信号相连，输出层的各个神经元都受到输入信号的影响。</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422120.png" alt=""></p><p>softmax函数的实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">softmax</span>(<span class="params">a</span>):</span><br><span class="line">    exp_a = np.exp(a) </span><br><span class="line">    sum_exp_a = np.<span class="built_in">sum</span>(exp_a) </span><br><span class="line">    y = exp_a / sum_exp_a</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><h5 id="实现softmax函数的注意事项"><a href="#实现softmax函数的注意事项" class="headerlink" title="实现softmax函数的注意事项"></a>实现softmax函数的注意事项</h5><p>上面的softmax的实现存在溢出问题，指数运算的值很容易溢出，如果超大的值进行除法运算就会出现不确定的情况。溢出问题在进行计算的运算时必须注意！</p><p>改进：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422136.png" alt=""></p><p>指数运算时加上某个常数并不会改变运算结果，这里的C‘为了防止溢出，一般使用输入信号中的最大值的相反数。</p><p>softmax改进后的函数实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">softmax</span>(<span class="params">a</span>):</span><br><span class="line">    c = np.<span class="built_in">max</span>(a)</span><br><span class="line">    exp_a = np.exp(a-c)</span><br><span class="line">    sum_exp_a = np.<span class="built_in">sum</span>(exp_a)</span><br><span class="line">    y = exp_a / sum_exp_a</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><h5 id="softmax的函数特征"><a href="#softmax的函数特征" class="headerlink" title="softmax的函数特征"></a>softmax的函数特征</h5><blockquote><p>因为指数函数是单调递增函数，即便使用了softmax函数各个元素之间的大小关系也不会改变。一般来说，神经网络只把输出值最大的神经元对应的类别作为识别结果。即便使用softmax函数，输出值最大的神经元也不会改变，在神经网络分类时，softmax函数可以省略。</p><p>求解机器学习问题的步骤可以分为“学习”A 和“推理”两个阶段。首先，在学习阶段进行模型的学习 B，然后，在推理阶段，用学到的模型对未知的数据进行推理(分类)。如前所述，推理阶段一般会省略输出层的 softmax 函数。在输出层使用 softmax 函数是因为它和神经网络的学习有关系。</p></blockquote><ul><li>softmax的函数输出总是在0.0到1.0之间</li><li>softmax函数的输出值总和为1，所以softmax可以解释为概率。</li><li>通过使用softmax函数，可以使用概率论统计的方法处理问题</li></ul><h5 id="输出层神经元数量"><a href="#输出层神经元数量" class="headerlink" title="输出层神经元数量"></a>输出层神经元数量</h5><p>输出层的神经元数量需要根据待解决的问题来决定。对于分类问题，输出层的神经元数量一般设定为类别的数量。</p><h4 id="手写数字识别"><a href="#手写数字识别" class="headerlink" title="手写数字识别"></a>手写数字识别</h4><p>使用学习到的参数，先实现神经网络的“推理处理”。这个推理处理也称为神经网络的前向传播(forward propagation)。</p><h5 id="MNIST数据集"><a href="#MNIST数据集" class="headerlink" title="MNIST数据集"></a>MNIST数据集</h5><h6 id="什么是MNIST？"><a href="#什么是MNIST？" class="headerlink" title="什么是MNIST？"></a>什么是MNIST？</h6><ol><li>MNIST手写数据集，是机器学习最有名的数据集之一。MNIST有训练图像6w张，测试图像1w张。</li><li>一般使用方法：先用训练图像进行学习，再用学习到的模型度量能够多大程度上对测试图像进行正确的分类。</li><li>MNIST图像数据是28像素x28像素的灰度图像，各个像素取值在0-255之间，每个图像对应有数字标签。</li></ol><p><code>ch03/mnist_show.py</code>使用<code>mnist.py</code>中的<code>load_mnist()</code>函数，就可以读取MNIST数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys, os</span><br><span class="line">sys.path.append(os.pardir)  <span class="comment"># 为了导入父目录的文件而进行的设定</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> dataset.mnist <span class="keyword">import</span> load_mnist <span class="comment"># 调入自定义的load_mnist函数</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">img_show</span>(<span class="params">img</span>):</span><br><span class="line">    <span class="comment"># Image.fromarray把保存为 NumPy 数组的图像数据转换为 PIL 用 的数据对象</span></span><br><span class="line">    pil_img = Image.fromarray(np.uint8(img))</span><br><span class="line">    pil_img.show()</span><br><span class="line"></span><br><span class="line">(x_train, t_train), (x_test, t_test) = load_mnist(flatten=<span class="literal">True</span>, normalize=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 当flatten=True时读入的图像是以一列NumPy数组的形式保存的，显示图像时需要调用reshape()方法</span></span><br><span class="line"></span><br><span class="line">img = x_train[<span class="number">0</span>]</span><br><span class="line">label = t_train[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(label)  <span class="comment"># 5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(img.shape)  <span class="comment"># (784,)</span></span><br><span class="line">img = img.reshape(<span class="number">28</span>, <span class="number">28</span>)  </span><br><span class="line"><span class="comment"># 通过 reshape() 方法的参数指定期望的形状，更改 NumPy 数组的形状。</span></span><br><span class="line"><span class="built_in">print</span>(img.shape)  <span class="comment"># (28, 28)</span></span><br><span class="line"></span><br><span class="line">img_show(img)</span><br></pre></td></tr></table></figure><h6 id="关于PIL（Python-Image-Library）"><a href="#关于PIL（Python-Image-Library）" class="headerlink" title="关于PIL（Python Image Library）"></a>关于PIL（Python Image Library）</h6><p>是Python的图像处理标准库，功能非常强大，API简单易用。</p><h6 id="PIL中的Image和NumPy中的array相互转换"><a href="#PIL中的Image和NumPy中的array相互转换" class="headerlink" title="PIL中的Image和NumPy中的array相互转换"></a>PIL中的Image和NumPy中的array相互转换</h6><ol><li>PIL Image转换为array</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img = np.asarray(image</span><br></pre></td></tr></table></figure><p>如果出现read-only错误，并不是转换的错误，一般是你读取的图片的时候，默认选择的是”r”,”rb”模式有关。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img.flags.writeable = <span class="literal">True</span> <span class="comment"># 将数组改为读写模式</span></span><br></pre></td></tr></table></figure><ol><li>array转换成image</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Image.fromarray(np.unit8(img))</span><br></pre></td></tr></table></figure><h6 id="关于load-mnist函数的解释"><a href="#关于load-mnist函数的解释" class="headerlink" title="关于load_mnist函数的解释"></a>关于load_mnist函数的解释</h6><p>位于<code>`dataset/mnist.py</code>的<code>load_mnist</code>函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_mnist</span>(<span class="params">normalize=<span class="literal">True</span>, flatten=<span class="literal">True</span>, one_hot_label=<span class="literal">False</span></span>):</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果数据不存在，调用init方法下载并转换</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(save_file):</span><br><span class="line">        init_mnist()</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># with能够自动处理上下文环境产生的异常</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(save_file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        dataset = pickle.load(f)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> normalize:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> (<span class="string">&#x27;train_img&#x27;</span>, <span class="string">&#x27;test_img&#x27;</span>):</span><br><span class="line">            dataset[key] = dataset[key].astype(np.float32)</span><br><span class="line">            dataset[key] /= <span class="number">255.0</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> one_hot_label:</span><br><span class="line">        dataset[<span class="string">&#x27;train_label&#x27;</span>] = _change_one_hot_label(dataset[<span class="string">&#x27;train_label&#x27;</span>])</span><br><span class="line">        dataset[<span class="string">&#x27;test_label&#x27;</span>] = _change_one_hot_label(dataset[<span class="string">&#x27;test_label&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> flatten:</span><br><span class="line">         <span class="keyword">for</span> key <span class="keyword">in</span> (<span class="string">&#x27;train_img&#x27;</span>, <span class="string">&#x27;test_img&#x27;</span>):</span><br><span class="line">            dataset[key] = dataset[key].reshape(-<span class="number">1</span>, <span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (dataset[<span class="string">&#x27;train_img&#x27;</span>], dataset[<span class="string">&#x27;train_label&#x27;</span>]), (dataset[<span class="string">&#x27;test_img&#x27;</span>], dataset[<span class="string">&#x27;test_label&#x27;</span>]) </span><br></pre></td></tr></table></figure><p>通过传入布尔值来执行相关操作的函数：</p><ol><li>normalize（正规化）：将图像的像素值正规化为0.0~1.0。<ul><li>将图像的各个像素值除以 255，使得数据的值在 0.0~1.0 的范围内。像这样把数据限定到某个范围内的处理称为<strong>正规化</strong>(normalization)。</li></ul></li><li>flatten（扁平化）：是否将图像展开为一维数组。</li><li>one_hot_label（一条标签数组）：one_hot_label为True的情况下，标签作为one-hot数组返回。「one-hot数组是指[0,0,1,0,0,0,0,0,0,0]这样的数组」</li><li>读入<code>MNIST数据集</code>，返回<code>(训练图像, 训练标签), (测试图像, 测试标签)</code></li></ol><h5 id="神经网路的推理处理"><a href="#神经网路的推理处理" class="headerlink" title="神经网路的推理处理"></a>神经网路的推理处理</h5><p>神经网络输入层有784个神经元，输出层有10个神经元，输入层784源于图像大小28 x 28，输出层的10来源于10类别分类。此外还有两个隐藏层，第一层50个神经元，第二层100个神经元。50和100可以为任意值。</p><p>定义 get_data()、init_network()、predict() ：【neuralnet_mnist.py】</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys, os</span><br><span class="line">sys.path.append(os.pardir)  <span class="comment"># 为了导入父目录的文件而进行的设定</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> dataset.mnist <span class="keyword">import</span> load_mnist</span><br><span class="line"><span class="keyword">from</span> common.functions <span class="keyword">import</span> sigmoid, softmax</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回测试图像和测试标签</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    (x_train, t_train), (x_test, t_test) = load_mnist(normalize=<span class="literal">True</span>, flatten=<span class="literal">True</span>, one_hot_label=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> x_test, t_test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读入保存在pickle文件sample_weight.pkl中的权重参数，这个文件以字典变量的形式保存了权重和偏置参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_network</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;sample_weight.pkl&quot;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        network = pickle.load(f)</span><br><span class="line">    <span class="keyword">return</span> network</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">network, x</span>):</span><br><span class="line">    W1, W2, W3 = network[<span class="string">&#x27;W1&#x27;</span>], network[<span class="string">&#x27;W2&#x27;</span>], network[<span class="string">&#x27;W3&#x27;</span>]</span><br><span class="line">    b1, b2, b3 = network[<span class="string">&#x27;b1&#x27;</span>], network[<span class="string">&#x27;b2&#x27;</span>], network[<span class="string">&#x27;b3&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    a1 = np.dot(x, W1) + b1</span><br><span class="line">    z1 = sigmoid(a1)</span><br><span class="line">    a2 = np.dot(z1, W2) + b2</span><br><span class="line">    z2 = sigmoid(a2)</span><br><span class="line">    a3 = np.dot(z2, W3) + b3</span><br><span class="line">    y = softmax(a3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x, t = get_data() <span class="comment"># 取出数据</span></span><br><span class="line">network = init_network()</span><br><span class="line">accuracy_cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">    y = predict(network, x[i])</span><br><span class="line">    p= np.argmax(y) <span class="comment"># 获取概率最高的元素的索引</span></span><br><span class="line">    <span class="keyword">if</span> p == t[i]:</span><br><span class="line">        accuracy_cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Accuracy:&quot;</span> + <span class="built_in">str</span>(<span class="built_in">float</span>(accuracy_cnt) / <span class="built_in">len</span>(x)))</span><br></pre></td></tr></table></figure><p>这三个函数实现了神经网络的推理处理，然后评价识别精度（accuracy）：</p><ol><li>获取MNIST的数据集，生成网络。</li><li>用 for 语句逐一取出保存在 x 中的图像数据，用 predict() 函数进行分类。「predict() 函数以 NumPy 数组的形式输出各个标签对应的概率」</li><li>取出这个概率列表中的最大值的索引，作为预测结果。「np.argmax(x) 将获取被赋给参数 x 的数组中的最大值元素的索引」</li><li>比较神经网络所预测的答案和正确解标签，将回答正确的概率作为识别精度</li></ol><blockquote><p>「注:」此处是假设学习已经完成，学习中的参数保存在sample_weight.pkl文件中，在推理阶段，直接加载这些学习到的参数</p><p>在刚才的例子中，作为一种预处理，我们将各个像素值除以 255，进行了简单的正规化。实际上，很多预处理都会考虑到数据的整体分布。比如，利用数据整体的均值或标准差，移动数据，使数据整体以 0 为中心分布，或者进行正规化，把数据的延展控制在一定范围内。除此之外，还有将数据整体的分布形状均匀化的方法，即数据<strong>白化</strong>(whitening)等。</p></blockquote><h5 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h5><p>多维数组对应维度的元素个数一致，输入由784个元素组成的一维数组，最终输出元素个数为10的一维数组：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422166.png" alt=""></p><p>这是只输入一张图像数据时的处理流程。</p><p>比如，我们想用 predict()函数一次性打包处理 100 张图像。为此，可以把 x 的形状改为 100 × 784，将100 张图像打包作为输入数据：</p><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422176.png" alt=""></p><p>此时，输入的100张图像的结果被一次性输出了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">x, t = get_data()</span><br><span class="line">network = init_network()</span><br><span class="line"></span><br><span class="line">batch_size = <span class="number">100</span> <span class="comment"># 批数量</span></span><br><span class="line">accuracy_cnt = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(x), batch_size):</span><br><span class="line">    x_batch = x[i:i+batch_size]</span><br><span class="line">    y_batch = predict(network, x_batch)</span><br><span class="line">    p = np.argmax(y_batch, axis=<span class="number">1</span>)</span><br><span class="line">    accuracy_cnt += np.<span class="built_in">sum</span>(p == t[i:i+batch_size])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Accuracy:&quot;</span> + <span class="built_in">str</span>(<span class="built_in">float</span>(accuracy_cnt) / <span class="built_in">len</span>(x)))</span><br></pre></td></tr></table></figure><p>批处理代码实现中的不同之处：</p><ol><li>首先是range()函数：<ul><li><code>range(start, end)</code>生成一个start到end-1之间的整数构成的列表</li><li><code>range(start, end, step)</code>下一个元素会增加step</li></ul></li><li><code>x[i:i+batch_n]</code>会取出从第 i 个到第 i+batch_n 个之间的数据。</li><li>通过 argmax() 获取值最大的元素的索引。不过这里需要注意的是，我们给定了参数 axis=1。这指定了在 100 × 10 的数组中，沿着第 1 维方向(以第 1 维为轴)找到值最大的元素的索引(第 0 维对应第 1 个维度)。</li><li>最后，比较一下以批为单位进行分类的结果和实际的答案</li></ol><blockquote><p>本章介绍的神经网络和上一章的感知机在信号的按层传递这一点上是相同的，但是，向下一个神经元发送信号时，改变信号的激活函数有很大差异。神经网络中使用的是平滑变化的 sigmoid函数，而感知机中使用的是信号急剧变化的阶跃函数。</p></blockquote><h3 id="神经网络学习"><a href="#神经网络学习" class="headerlink" title="神经网络学习"></a>神经网络学习</h3><blockquote><p>“学习”是指从训练数据中自动获取最优权重参数的过程。为了使神经网络能进行学习，将导入损失函数这一指标。而学习的目的就是以该损失函数为基准，找出能使它的值达到最小的权重参数。为了找出尽可能小的损失函数的值，利用了函数斜率的梯度法。</p></blockquote><h3 id="误差反向传播法"><a href="#误差反向传播法" class="headerlink" title="误差反向传播法"></a>误差反向传播法</h3><blockquote><p>数值微分虽然简单，也容易实现，但缺点是计算上比较费时间。误差反向传播法能够高效计算权重参数的梯度。正确理解误差反向传播法，有两种方法：数学式和计算图</p></blockquote><h3 id="与学习相关的技巧"><a href="#与学习相关的技巧" class="headerlink" title="与学习相关的技巧"></a>与学习相关的技巧</h3><blockquote><p>神经网络的学习中一些重要观点，主题涉及寻找最优权重参数的最优化方法、权重参数的初始值、超参数设定方法等。为了应对过拟合，还将介绍权值衰减、Dropout 等正则化方法，并进行实现。</p></blockquote><h3 id="卷积神经网络"><a href="#卷积神经网络" class="headerlink" title="卷积神经网络"></a>卷积神经网络</h3><blockquote><p>本章主题是卷积神经网络（CNN），CNN用于图像识别、语音识别等场合，在图像识别比赛中，基于深度学习的方法几乎都以CNN为基础。</p></blockquote><h3 id="深度学习"><a href="#深度学习" class="headerlink" title="深度学习"></a>深度学习</h3><blockquote><p>深度学习是加深了层的深度神经网络。基于之前介绍的网络，只需通过叠加层，就可以创建深度网络。 关于神经网络，已经学了很多：构成神经网络的各种层、学习时的有效技巧、对图像特别有效的CNN、参数的最优方法等。本章将这些知识汇总起来，创建一个深度网络，挑战MNIST数据集的手写数字识别。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-01-02%2F1546422431.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Notes" scheme="http://www.ts1989.cn/categories/Notes/"/>
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="DeepLearning" scheme="http://www.ts1989.cn/tags/DeepLearning/"/>
    
  </entry>
  
  <entry>
    <title>02 熟悉Urllib库</title>
    <link href="http://www.ts1989.cn/2018/12/12/Python-data-analysis02/"/>
    <id>http://www.ts1989.cn/2018/12/12/Python-data-analysis02/</id>
    <published>2018-12-12T13:01:36.000Z</published>
    <updated>2019-08-25T15:10:14.618Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-25%2F1566745810.png" alt=""></p><span id="more"></span><h2 id="三、Urllib库"><a href="#三、Urllib库" class="headerlink" title="三、Urllib库"></a>三、Urllib库</h2><h3 id="1-Urllib基础"><a href="#1-Urllib基础" class="headerlink" title="1. Urllib基础"></a>1. Urllib基础</h3><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><div class="table-container"><table><thead><tr><th style="text-align:center">urlretrieve()</th><th style="text-align:center">爬一个网页</th></tr></thead><tbody><tr><td style="text-align:center">urlcleanup()</td><td style="text-align:center">清除urlretrieve()生成的缓存</td></tr><tr><td style="text-align:center">info()</td><td style="text-align:center">展现基本环境信息</td></tr><tr><td style="text-align:center">getcode()</td><td style="text-align:center">当前网页的状态码</td></tr><tr><td style="text-align:center">geturl()</td><td style="text-align:center">当前网页的网址</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line">urllib.request.urlretrieve(<span class="string">&quot;http://hellobi.com&quot;</span>,filename=<span class="string">&quot;/Users/biandudu/Documents/webcrawerfiles/1.html&quot;</span>)</span><br><span class="line">urllib.request.urlcleanup()</span><br><span class="line">file = urllib.request.urlopen(<span class="string">&quot;http://www.hellobi.com&quot;</span>，timeout=<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(file.info())</span><br><span class="line"><span class="built_in">print</span>(file.getcode())</span><br><span class="line"><span class="built_in">print</span>(file.geturl())</span><br></pre></td></tr></table></figure><h3 id="2-超时设置-并抛出异常"><a href="#2-超时设置-并抛出异常" class="headerlink" title="2. 超时设置 并抛出异常"></a>2. 超时设置 并抛出异常</h3><blockquote><p>有些网站反应快，我们希望2秒钟没有反应，则判断为超时，那么此时，timeout的值就是2，再比如，有些网站服务器反应慢，那么此时，我们希望100秒没有反应，才判断为超时，那么此时timeout的值就是100。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        file = urllib.request.urlopen(<span class="string">&quot;http://hellobi.com&quot;</span>, timeout=<span class="number">0.5</span>)</span><br><span class="line">        data = file.read()</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">len</span>(data))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;异常：&quot;</span>+<span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure><h3 id="3-自动模拟HTTP请求"><a href="#3-自动模拟HTTP请求" class="headerlink" title="3. 自动模拟HTTP请求"></a>3. 自动模拟HTTP请求</h3><blockquote><p>客户端如果要与服务器端进行通信，需要通过http请求进行，http请求有很多种，我们在此会讲post与get两种请求方式。比如登陆、搜索某些信息的时候会用到。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line">keywd = <span class="string">&quot;张译天&quot;</span></span><br><span class="line">keywd = urllib.request.quote(keywd)  <span class="comment"># 对中文编码</span></span><br><span class="line">url = <span class="string">&quot;http://www.baidu.com/s?wd=&quot;</span>+keywd+<span class="string">&quot;&amp;ie=utf-8&amp;tn=96542061_hao_pg&quot;</span></span><br><span class="line">req = urllib.request.Request(url)</span><br><span class="line">data = urllib.request.urlopen(req).read()</span><br><span class="line">fh = <span class="built_in">open</span>(<span class="string">&quot;/Users/biandudu/Documents/webcrawerfiles/2.html&quot;</span>,<span class="string">&quot;wb&quot;</span>)</span><br><span class="line">fh.write(data)</span><br><span class="line">fh.close()</span><br></pre></td></tr></table></figure><h5 id="自动提交post请求"><a href="#自动提交post请求" class="headerlink" title="自动提交post请求"></a>自动提交post请求</h5><p>首先登陆这个网站：www.iqianyue.com/mypost/ 并分析源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置表单内容</span></span><br><span class="line">url = <span class="string">&quot;http://www.iqianyue.com/mypost/&quot;</span></span><br><span class="line">mydata = urllib.parse.urlencode(&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:<span class="string">&quot;ceo@sfsfd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pass&quot;</span>:<span class="string">&quot;1232jas&quot;</span></span><br><span class="line">&#125;).encode(<span class="string">&quot;utf-8&quot;</span>)   <span class="comment"># 设置对应的信息，对应的编码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装请求</span></span><br><span class="line">req = urllib.request.Request(url,mydata)   <span class="comment"># 提交到的地址，提交的数据</span></span><br><span class="line">data = urllib.request.urlopen(req).read()  <span class="comment"># urlopen将对应请求提交过去，爬数据</span></span><br><span class="line">fh = <span class="built_in">open</span>(<span class="string">&quot;/Users/biandudu/Documents/webcrawerfiles/3.html&quot;</span>,<span class="string">&quot;wb&quot;</span>)  <span class="comment"># 写入本地文件，wb二进制写入</span></span><br><span class="line">fh.write(data)</span><br><span class="line">fh.close()</span><br></pre></td></tr></table></figure><p>Tips：</p><ul><li>找到登录，只需要关注 <code>form</code> 里的 <code>name属性</code> </li><li>找不到登录，隐藏在js文件中，我们需要通过 <strong>抓包</strong> 来进行分析</li></ul><h3 id="4-异常处理"><a href="#4-异常处理" class="headerlink" title="4. 异常处理"></a>4. 异常处理</h3><div class="table-container"><table><thead><tr><th>301 Moved Permanently</th><th>重定向到新的URL，永久性</th></tr></thead><tbody><tr><td>302 Found</td><td>重定向到临时的URL，非永久性</td></tr><tr><td>304 Not Modified</td><td>请求的资源未更新</td></tr><tr><td>400 Bad Request</td><td>非法请求</td></tr><tr><td>401 Unauthorized</td><td>请求未经授权</td></tr><tr><td>403 Forbidden</td><td>禁止访问</td></tr><tr><td>404 Not Found</td><td>未找到对应页面</td></tr><tr><td>500 Internal Server Error</td><td>服务器内部错误</td></tr><tr><td>501 Not Implemented</td><td>服务器不支持实现请求所需要的功能</td></tr></tbody></table></div><h5 id="URLError和HTTPError"><a href="#URLError和HTTPError" class="headerlink" title="URLError和HTTPError"></a>URLError和HTTPError</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.error</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    urllib.request.urlopen(<span class="string">&quot;http://blog.csdksdfjs.net/dsd&quot;</span>)  <span class="comment"># csdn爬取会被屏蔽</span></span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:   <span class="comment"># 捕获异常</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(e,<span class="string">&quot;code&quot;</span>):            <span class="comment"># 是否有这个状态码属性，判断有没有code</span></span><br><span class="line">        <span class="built_in">print</span>(e.code)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(e,<span class="string">&quot;reason&quot;</span>):          <span class="comment"># 判断是否有reason这个属性</span></span><br><span class="line">        <span class="built_in">print</span>(e.reason)</span><br></pre></td></tr></table></figure><h3 id="5-浏览器伪装技术"><a href="#5-浏览器伪装技术" class="headerlink" title="5. 浏览器伪装技术"></a>5. 浏览器伪装技术</h3><blockquote><p>我们可以试试爬取csdn博客，我们发现会返回403，因为对方服务器会 对爬虫进行屏蔽。此时，我们需要伪装成浏览器才能爬取。<br>浏览器伪装我们一般通过报头进行，接下来我们通过实战分析一下。</p></blockquote><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-23%2F1566542319.png" alt="User-Agent"></p><h5 id="如果没有伪装会报403禁止访问错误"><a href="#如果没有伪装会报403禁止访问错误" class="headerlink" title="如果没有伪装会报403禁止访问错误"></a>如果没有伪装会报403禁止访问错误</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://ask.hellobi.com/blog/weiwei/5322&quot;</span></span><br><span class="line">headers=(<span class="string">&quot;User-Agent&quot;</span>,<span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&quot;</span>)</span><br><span class="line">opener = urllib.request.build_opener()  <span class="comment"># 创建一个opener对象</span></span><br><span class="line">opener.addheaders = [headers]           <span class="comment"># 添加报头信息</span></span><br><span class="line"></span><br><span class="line">data = opener.<span class="built_in">open</span>(url).read()</span><br><span class="line">fh = <span class="built_in">open</span>(<span class="string">&quot;/Users/biandudu/Documents/webcrawerfiles/6.html&quot;</span>,<span class="string">&quot;wb&quot;</span>)</span><br><span class="line">fh.write(data)</span><br><span class="line">fh.close()</span><br></pre></td></tr></table></figure><h3 id="6-Python新闻爬虫实战"><a href="#6-Python新闻爬虫实战" class="headerlink" title="6. Python新闻爬虫实战"></a>6. Python新闻爬虫实战</h3><blockquote><p>需求:将新浪新闻首页(<a href="http://news.sina.com.cn/)所有新闻都爬到">http://news.sina.com.cn/)所有新闻都爬到</a> 本地。 </p><p>思路:先爬首页，通过正则获取所有新闻链接，然后依次爬各新闻，并<br>存储到本地。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line">data = urllib.request.urlopen(<span class="string">&quot;http://news.sina.com.cn/&quot;</span>).read()</span><br><span class="line">data2 = data.decode(<span class="string">&quot;utf-8&quot;</span>,<span class="string">&quot;ignore&quot;</span>)  <span class="comment"># 有时候设置utf-8还会报错，就添加一个ignore</span></span><br><span class="line"></span><br><span class="line">pat=<span class="string">&#x27;href=&quot;(https://news.sina.com.cn/.*?)&quot;&#x27;</span></span><br><span class="line">allurl = re.<span class="built_in">compile</span>(pat).findall(data2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(allurl)):</span><br><span class="line">    thisurl = allurl[i]</span><br><span class="line">    file = <span class="string">&quot;/Users/biandudu/Documents/webcrawerfiles/sinanews/&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;.html&quot;</span></span><br><span class="line">    urllib.request.urlretrieve(thisurl,file)</span><br></pre></td></tr></table></figure><h3 id="作业三-提取出版社信息并写入文件中"><a href="#作业三-提取出版社信息并写入文件中" class="headerlink" title="作业三: 提取出版社信息并写入文件中"></a>作业三: 提取出版社信息并写入文件中</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re,xlwt,datetime</span><br><span class="line"></span><br><span class="line">html=request.urlopen(<span class="string">&quot;https://read.douban.com/provider/all&quot;</span>).read()    <span class="comment">#读取网页源代码内容</span></span><br><span class="line">html.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">wzgz=<span class="string">&quot;&lt;a href=\&quot;(.*?)\&quot; class=\&quot;provider-item\&quot;&gt;&lt;div class=\&quot;col-media\&quot;&gt;&lt;div class=\&quot;cm-left avatar\&quot;&gt;&lt;div class=\&quot;avatar\&quot;&gt;&lt;img src=\&quot;(.*?)\&quot;/&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=\&quot;cm-body\&quot;&gt;&lt;div class=\&quot;name\&quot;&gt;(.*?)&lt;/div&gt;&lt;div class=\&quot;works-num\&quot;&gt;(.*?) 部作品在售&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/a&gt;&quot;</span></span><br><span class="line">xx=re.<span class="built_in">compile</span>(wzgz).findall(<span class="built_in">str</span>(html,<span class="string">&quot;utf-8&quot;</span>))                         <span class="comment">#通过正则表达式匹配在网页源代码中提取所需内容</span></span><br><span class="line"><span class="comment">#print(xx)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建workbook和sheet对象</span></span><br><span class="line">workbook = xlwt.Workbook()</span><br><span class="line">sheet1 = workbook.add_sheet(<span class="string">&#x27;sheet1&#x27;</span>,cell_overwrite_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化excel样式</span></span><br><span class="line">style = xlwt.XFStyle()</span><br><span class="line"></span><br><span class="line"><span class="comment">#为样式创建字体</span></span><br><span class="line">font = xlwt.Font()</span><br><span class="line">font.name = <span class="string">&#x27;Times New Roman&#x27;</span></span><br><span class="line">font.bold = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置样式的字体</span></span><br><span class="line">style.font = font</span><br><span class="line"></span><br><span class="line"><span class="comment">#在sheet1表的第1行设置字段名称并写入数据</span></span><br><span class="line">sheet1.write(<span class="number">0</span>,<span class="number">0</span>,<span class="string">&quot;序号&quot;</span>,style)</span><br><span class="line">sheet1.write(<span class="number">0</span>,<span class="number">1</span>,<span class="string">&quot;出版社-URL&quot;</span>,style)</span><br><span class="line">sheet1.write(<span class="number">0</span>,<span class="number">2</span>,<span class="string">&quot;LOGO-URL&quot;</span>,style)</span><br><span class="line">sheet1.write(<span class="number">0</span>,<span class="number">3</span>,<span class="string">&quot;出版社名称&quot;</span>,style)</span><br><span class="line">sheet1.write(<span class="number">0</span>,<span class="number">4</span>,<span class="string">&quot;在售作品数量&quot;</span>,style)</span><br><span class="line"></span><br><span class="line">a=<span class="number">0</span>                                                                <span class="comment">#定义行号初始值</span></span><br><span class="line">h=<span class="number">0</span>                                                                <span class="comment">#定义在售数量初始值</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xx:</span><br><span class="line">    <span class="comment">#print(str(a+1),i[0])</span></span><br><span class="line">    sheet1.write(a+<span class="number">1</span>,<span class="number">0</span>,a+<span class="number">1</span>,style)                                   <span class="comment">#在第a+1行第1列写入序号</span></span><br><span class="line">    sheet1.write(a+<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;https://read.douban.com&quot;</span>+<span class="built_in">str</span>(i[<span class="number">0</span>]),style)   <span class="comment">#在第a+1行第2列写入出版社URL</span></span><br><span class="line">    sheet1.write(a+<span class="number">1</span>,<span class="number">2</span>,i[<span class="number">1</span>],style)                                  <span class="comment">#在第a+1行第3列写入LOGO-URL</span></span><br><span class="line">    sheet1.write(a+<span class="number">1</span>,<span class="number">3</span>,i[<span class="number">2</span>],style)                                  <span class="comment">#在第a+1行第4列写入出版社名称</span></span><br><span class="line">    sheet1.write(a+<span class="number">1</span>,<span class="number">4</span>,<span class="built_in">int</span>(i[<span class="number">3</span>]),style)                             <span class="comment">#在第a+1行第5列写入在售数量</span></span><br><span class="line">    h+=<span class="built_in">int</span>(i[<span class="number">3</span>])                                                    <span class="comment">#在售数量累计求和</span></span><br><span class="line">    a+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> a==a:                                                        <span class="comment">#判断XX列表是否遍历结束，并在sheet1表尾行写入在售数量求和的值</span></span><br><span class="line">        t=datetime.datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">        t1=datetime.datetime.now().strftime(<span class="string">&quot;%Y%m%d%H%M%S&quot;</span>)</span><br><span class="line">        sheet1.write(a+<span class="number">1</span>,<span class="number">3</span>,<span class="string">&quot;合计&quot;</span>,style)                            <span class="comment">#在sheet1表尾行写入“合计”</span></span><br><span class="line">        sheet1.write(a+<span class="number">1</span>,<span class="number">4</span>,h,style)                                 <span class="comment">#在sheet1表尾行写入在售数量累计值</span></span><br><span class="line">        sheet1.write(a+<span class="number">2</span>,<span class="number">3</span>,<span class="string">&quot;采集时间&quot;</span>,style)                        <span class="comment">#在sheet1表尾行写入数据采集时间</span></span><br><span class="line">        sheet1.write(a+<span class="number">2</span>,<span class="number">4</span>,t,style)                                 <span class="comment">#在sheet1表尾行写入数据采集时间</span></span><br><span class="line"></span><br><span class="line">workbook.save(<span class="string">&quot;d:/豆瓣出版社汇总表&quot;</span>+<span class="built_in">str</span>(t1)+<span class="string">&quot;.xls&quot;</span>)                 <span class="comment">#保存该excel文件,有同名文件时无法直接覆盖</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;数据写入excel文件完毕！&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;在售书数量合计：&quot;</span>+<span class="built_in">str</span>(h))</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-25%2F1566745810.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Notes" scheme="http://www.ts1989.cn/categories/Notes/"/>
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="Data Analysis" scheme="http://www.ts1989.cn/tags/Data-Analysis/"/>
    
    <category term="Python" scheme="http://www.ts1989.cn/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>01 爬虫入门</title>
    <link href="http://www.ts1989.cn/2018/12/12/Python-data-analysis/"/>
    <id>http://www.ts1989.cn/2018/12/12/Python-data-analysis/</id>
    <published>2018-12-11T17:01:36.000Z</published>
    <updated>2019-08-25T15:10:51.185Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-25%2F1566745847.png" alt=""></p><span id="more"></span><h2 id="一-Python初识"><a href="#一-Python初识" class="headerlink" title="一. Python初识"></a>一. Python初识</h2><h4 id="一些简单概念"><a href="#一些简单概念" class="headerlink" title="一些简单概念"></a>一些简单概念</h4><blockquote><p>Python中没有数组的概念</p></blockquote><p><strong>列表[]</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可以存储元素: abc=[“My”, “You”]</span><br><span class="line">如果要选取列表中的元素 abc[<span class="number">1</span>] 输出 ‘You’</span><br><span class="line">要替换列表中的元素: abc[<span class="number">1</span>]=”He”</span><br></pre></td></tr></table></figure><p><strong>元祖()</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cde=(“My”, “You”)</span><br><span class="line">选取元素同样用 cde[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p><strong>列表和元组的区别</strong></p><p>列表中的元素是可以修改的 但是元组这种数据类型呢 是不能修改的</p><p><strong>集合</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parame = &#123;value01,value02,...&#125;</span><br><span class="line">或者</span><br><span class="line"><span class="built_in">set</span>(value)</span><br></pre></td></tr></table></figure><p><strong>字典</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;key1 : value1, key2 : value2 &#125;</span><br></pre></td></tr></table></figure><h4 id="简单代码展示"><a href="#简单代码展示" class="headerlink" title="简单代码展示"></a>简单代码展示</h4><p><strong>函数的使用</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">abc</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;abcd!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">function1</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">if</span>(a&gt;b):</span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line">function1(<span class="number">10</span>,<span class="number">19</span>)</span><br><span class="line"></span><br><span class="line">abc()</span><br></pre></td></tr></table></figure><p><strong>模块</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> data_05functiondefinition</span><br><span class="line"></span><br><span class="line">data=data_05functiondefinition.function1(<span class="number">19</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure><p><strong>文件写入</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fh = <span class="built_in">open</span>(<span class="string">&quot;/Users/biandudu/Desktop/PythonDataAnalysis/file1.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">contents1 = <span class="string">&quot;我是文件内容&quot;</span></span><br><span class="line">fh.write(contents1)</span><br><span class="line"></span><br><span class="line">fh.close()</span><br></pre></td></tr></table></figure><p><strong>文件读取</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fh1 = <span class="built_in">open</span>(<span class="string">&quot;/Users/biandudu/Desktop/PythonDataAnalysis/file2.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="comment"># data2 = fh1.read()</span></span><br><span class="line"><span class="comment"># print(data2)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = fh1.readline()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(line)==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line">fh1.close()</span><br></pre></td></tr></table></figure><p><strong>异常抛出</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 中间异常不处理，会导致程序的崩溃</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;my&quot;</span>)</span><br><span class="line">    printasa(<span class="string">&quot;sss&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">    <span class="built_in">print</span>(err)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h3><h4 id="作业一：输出乘法口诀"><a href="#作业一：输出乘法口诀" class="headerlink" title="作业一：输出乘法口诀"></a>作业一：输出乘法口诀</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,i+<span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(i)+<span class="string">&quot;*&quot;</span>+<span class="built_in">str</span>(j)+<span class="string">&quot;=&quot;</span>+<span class="built_in">str</span>(i*j)+<span class="string">&quot;  &quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="comment"># end=&quot;&quot;意思是末尾不换行，加空格</span></span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure><h4 id="作业二：将多个Excel表格内容合并"><a href="#作业二：将多个Excel表格内容合并" class="headerlink" title="作业二：将多个Excel表格内容合并"></a>作业二：将多个Excel表格内容合并</h4><h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><p>可以采用一些操作Excel的模块来实现，比如xlrd、xlwt、openyxl、xlsxwriter等模块。xlrd模块主要用于读取Excel表，xlwt与xlsxwriter模块主要用于将数据写入表中，两个模块任选其一即可，但是xlwt与xlsxwriter模块不支持修改表，所以在信息追加的时候会较麻烦，其实这个问题至少有两种思路解决：</p><p><strong>A、换成其他模块，比如openpyxl等</strong>，这个模块实现起来会相对简单一些</p><p><strong>B、仍然使用xlwt与xlsxwriter等模块</strong>，但是先将每次读取的信息存储到list（列表）中，然后，最后一次写入。这一种方式稍微复杂一些</p><p><strong>此外，还有一个难点，即一个表格中有多个sheet</strong>，我们希望能够用程序自动获取这多个sheet，然后将各sheet中的内容一并写入到最终表格中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlrd,xlsxwriter</span><br><span class="line"> <span class="comment">#设置要合并的所有文件</span></span><br><span class="line">allxls=[<span class="string">&quot;F:/第一个测试文件.xls&quot;</span>,<span class="string">&quot;F:/第二个测试文件.xls&quot;</span>,<span class="string">&quot;F:/第三个测试文件.xls&quot;</span>]</span><br><span class="line"><span class="comment">#设置合并到的文件</span></span><br><span class="line">endxls =<span class="string">&quot;F:/endxls.xls&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#打开表格</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">open_xls</span>(<span class="params">file</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        fh=xlrd.open_workbook(file)</span><br><span class="line">        <span class="keyword">return</span> fh</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(<span class="string">&quot;打开出错，错误为：&quot;</span>+e))</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取所有sheet</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getsheet</span>(<span class="params">fh</span>):</span><br><span class="line">    <span class="keyword">return</span> fh.sheets()</span><br><span class="line"></span><br><span class="line"><span class="comment">#读取某个sheet的行数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getnrows</span>(<span class="params">fh,sheet</span>):</span><br><span class="line">    table=fh.sheets()[sheet]</span><br><span class="line">    content=table.nrows</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"><span class="comment">#读取某个文件的内容并返回所有行的值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getfilect</span>(<span class="params">fh,fl,shnum</span>):</span><br><span class="line">    fh=open_xls(fl)</span><br><span class="line">    table=fh.sheet_by_name(shname[shnum])</span><br><span class="line">    num=getnrows(fh,shnum)</span><br><span class="line">    lenrvalue=<span class="built_in">len</span>(rvalue)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,num):</span><br><span class="line">        rdata=table.row_values(row)</span><br><span class="line">        rvalue.append(rdata)</span><br><span class="line">    <span class="comment">#print(rvalue[lenrvalue:])</span></span><br><span class="line">    filevalue.append(rvalue[lenrvalue:])</span><br><span class="line">    <span class="keyword">return</span> filevalue</span><br><span class="line"></span><br><span class="line"><span class="comment">#存储所有读取的结果</span></span><br><span class="line">filevalue=[]</span><br><span class="line"><span class="comment">#存储一个标签的结果</span></span><br><span class="line">svalue=[]</span><br><span class="line"><span class="comment">#存储一行结果</span></span><br><span class="line">rvalue=[]</span><br><span class="line"><span class="comment">#存储各sheet名</span></span><br><span class="line">shname=[]</span><br><span class="line"></span><br><span class="line"><span class="comment">#读取第一个待读文件，获得sheet数</span></span><br><span class="line">fh=open_xls(allxls[<span class="number">0</span>])</span><br><span class="line">sh=getsheet(fh)</span><br><span class="line">x=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> sheet <span class="keyword">in</span> sh:</span><br><span class="line">    shname.append(sheet.name)</span><br><span class="line">    svalue.append([])</span><br><span class="line">    x+=<span class="number">1</span></span><br><span class="line"><span class="comment">#依次读取各sheet的内容</span></span><br><span class="line"><span class="comment">#依次读取各文件当前sheet的内容</span></span><br><span class="line"><span class="keyword">for</span> shnum <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,x):</span><br><span class="line">    <span class="keyword">for</span> fl <span class="keyword">in</span> allxls:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;正在读取文件：&quot;</span>+<span class="built_in">str</span>(fl)+<span class="string">&quot;的第&quot;</span>+<span class="built_in">str</span>(shnum)+<span class="string">&quot;个标签的…&quot;</span>)</span><br><span class="line">        filevalue=getfilect(fh,fl,shnum)</span><br><span class="line">    svalue[shnum].append(filevalue)</span><br><span class="line">    <span class="comment">#print(svalue[0])</span></span><br><span class="line">    <span class="comment">#print(svalue[1])</span></span><br><span class="line"><span class="comment">#由于append具有叠加关系，分析可得所有信息均在svalue[0][0]中存储</span></span><br><span class="line"><span class="comment">#svalue[0][0]元素数量为sheet标签数(sn)*文件数(fn)</span></span><br><span class="line">sn=x</span><br><span class="line">fn=<span class="built_in">len</span>(allxls)</span><br><span class="line">endvalue=[]</span><br><span class="line"><span class="comment">#设置一个函数专门获取svalue里面的数据，即获取各项标签的数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getsvalue</span>(<span class="params">k</span>):</span><br><span class="line">    <span class="keyword">for</span> z <span class="keyword">in</span> <span class="built_in">range</span>(k,k+fn):</span><br><span class="line">        endvalue.append(svalue[<span class="number">0</span>][<span class="number">0</span>][z])</span><br><span class="line">    <span class="keyword">return</span> endvalue</span><br><span class="line"></span><br><span class="line"><span class="comment">#打开最终写入的文件</span></span><br><span class="line">wb1=xlsxwriter.Workbook(endxls)</span><br><span class="line"><span class="comment">#创建一个sheet工作对象</span></span><br><span class="line">ws=wb1.add_worksheet()</span><br><span class="line">polit=<span class="number">0</span></span><br><span class="line">linenum=<span class="number">0</span></span><br><span class="line"><span class="comment">#依次遍历每个sheet中的数据</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,sn*fn,fn):</span><br><span class="line">    thisvalue=getsvalue(s)</span><br><span class="line">    tvalue=thisvalue[polit:]</span><br><span class="line">    <span class="comment">#将一个标签的内容写入新文件中</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(tvalue)):</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(tvalue[a])):</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(tvalue[a][b])):</span><br><span class="line">                <span class="comment">#print(linenum)</span></span><br><span class="line">                <span class="comment">#print(c)</span></span><br><span class="line">                data=tvalue[a][b][c]</span><br><span class="line">                ws.write(linenum,c,data)</span><br><span class="line">            linenum+=<span class="number">1</span></span><br><span class="line">    <span class="comment">#叠加关系，需要设置分割点</span></span><br><span class="line">    polit=<span class="built_in">len</span>(thisvalue)</span><br><span class="line">wb1.close()</span><br></pre></td></tr></table></figure><h2 id="二-爬虫初识"><a href="#二-爬虫初识" class="headerlink" title="二. 爬虫初识"></a>二. 爬虫初识</h2><blockquote><p>简单来说，网络爬虫就是自动从互联网中定向或不定向地采集信息的一<br>种程序。<br>网络爬虫有很多种类型，常用的有通用网络爬虫（搜索引擎）、聚焦网络爬虫（定向采集「信息过滤提取规则」）等。</p></blockquote><p>通用网络爬虫可以应用在搜索引擎中，聚焦网络爬虫可以从互联网中自动采集信息并代替我们筛选出相关的数据出来</p><ol><li>搜索引擎</li><li>采集金融数据</li><li>采集商品数据</li><li>自动过滤广告</li><li>采集竞争对手的客户数据</li><li>采集行业相关数据，进行数据分析 </li><li>…….</li></ol><h3 id="爬虫运行原理"><a href="#爬虫运行原理" class="headerlink" title="爬虫运行原理"></a>爬虫运行原理</h3><h4 id="通用爬虫"><a href="#通用爬虫" class="headerlink" title="通用爬虫"></a>通用爬虫</h4><p><img src="http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-20%2F1566280749.png" alt=""></p><h4 id="聚焦网络爬虫"><a href="#聚焦网络爬虫" class="headerlink" title="聚焦网络爬虫"></a>聚焦网络爬虫</h4><ol><li><strong>对爬取目标的定义和描述</strong>。在聚焦网络爬虫中，我们首先要依据爬取需求定义好该聚焦网络爬虫爬取的目标，以及进行相关的描述</li><li><strong>获取初始的URL</strong></li><li>根据初始的URL<strong>爬取</strong>网页，并<strong>获得新的URL</strong></li><li>从新的URL中 <strong>过滤</strong> 掉与爬取目标无关的链接。因为聚焦网络爬虫对网页的抓取是有目的性，所以与目标无关的网页将会被过滤掉。同时，也需要将已爬取的URL地址存放到一个列表中，用于去重和判断爬取的进程</li><li>将 <strong>过滤后的链接放到URL队列</strong> 中</li><li>从URL队列中，根据 <strong>搜索算法</strong>  ，确当URL的 <strong>优先级</strong> ，并确定下一步要抓取的URL地址。在通用网络爬虫中，下一步爬取那些URL，是不太重要的，但是在聚焦网络爬虫中，由于其具有目的性，故而下一步爬取哪些URL地址相对来说是比较重要的。对于聚焦网络爬虫来说，<strong>不同的爬取顺序，可能导致爬虫的执行效率不同</strong>，所以，我们需要依据搜索策略来确定下一步需要爬取那些URL地址</li><li>从下一步要爬取的URL地址中，读取新的URL，然后依据新的URL地址爬取网页，并重复上述爬取的过程</li><li>满足系统中设置的<strong>停止条件</strong>时，或无法获取新的URL地址时，停止爬行</li></ol><h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><h5 id="什么是正则表达式"><a href="#什么是正则表达式" class="headerlink" title="什么是正则表达式"></a>什么是正则表达式</h5><blockquote><p>提取出关键的数据，可以通过一些表达式进行提取，正则表达式就是其中一种进行数据筛选的表达式。</p></blockquote><h4 id="原子"><a href="#原子" class="headerlink" title="原子"></a>原子</h4><blockquote><p>原子是正则表达式中最基本的组成单位，每个正则表达式中至少要包含一个原子。常见的原子类型有:</p></blockquote><ol><li>普通字符</li><li>非打印字符</li><li>通用字符</li><li>原子表</li></ol><h5 id="普通字符和非打印字符"><a href="#普通字符和非打印字符" class="headerlink" title="普通字符和非打印字符"></a>普通字符和非打印字符</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pat=<span class="string">&quot;yue&quot;</span></span><br><span class="line">pat2=<span class="string">&quot;\n&quot;</span> <span class="comment"># 非打印字符</span></span><br><span class="line"></span><br><span class="line">string=<span class="string">&quot;http://yum.iqianyue.com&quot;</span></span><br><span class="line">string2=<span class="string">&quot;abcd&quot;</span></span><br><span class="line">string3=<span class="string">&#x27;&#x27;&#x27;absbddf</span></span><br><span class="line"><span class="string">sdfsfdfsfdfsf&#x27;&#x27;&#x27;</span> <span class="comment"># 三引号可以加入换行的句子</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rst1=re.search(pat,string)</span><br><span class="line">rst2=re.search(pat,string2)</span><br><span class="line">rst3=re.search(pat2,string3)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rst1)</span><br><span class="line"><span class="built_in">print</span>(rst2)</span><br><span class="line"><span class="built_in">print</span>(rst3)</span><br></pre></td></tr></table></figure><h5 id="通用字符和原子表"><a href="#通用字符和原子表" class="headerlink" title="通用字符和原子表"></a>通用字符和原子表</h5><p><code>\w</code>——匹配任意字母数字下划线</p><p><code>\d</code> ——匹配任意十进制数</p><p><code>\s</code> ——匹配空白字符</p><p><code>\W</code> ——和<code>\w</code>互补的关系，匹配任意除了字母数字下划线的字符</p><p><code>\D</code> ——和<code>\d</code>互补</p><p><code>\S</code> ——和<code>\s</code>互补</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pat3 = <span class="string">&quot;\w\dpython\w&quot;</span></span><br><span class="line">pat4 = <span class="string">&quot;pytho[ajs]n&quot;</span> <span class="comment"># ajs任意其一都可以匹配 [原子表]</span></span><br><span class="line"></span><br><span class="line">string = <span class="string">&quot;hohoiha3python3oioih&quot;</span></span><br><span class="line">string2 = <span class="string">&quot;sfsdkfpythoandsfd&quot;</span></span><br><span class="line"></span><br><span class="line">rst3 = re.search(pat3,string)</span><br><span class="line">rst4 = re.search(pat4,string2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rst3)</span><br><span class="line"><span class="built_in">print</span>(rst4)</span><br></pre></td></tr></table></figure><h4 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h4><blockquote><p>所谓的元字符，就是正则表达式中具有一些特殊含义的字符，比如重复N次前面的字符等。</p></blockquote><p>全部元字符：<a href="https://www.runoob.com/regexp/regexp-metachar.html">菜鸟教程——元字符</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pat = <span class="string">&quot;.python...&quot;</span></span><br><span class="line">pat2 = <span class="string">&quot;python|php&quot;</span></span><br><span class="line"></span><br><span class="line">string = <span class="string">&quot;sfafapythonfaf&quot;</span></span><br><span class="line">string2 = <span class="string">&quot;shshdsphpskfdsfpythonsfsdf&quot;</span></span><br><span class="line"></span><br><span class="line">rst = re.search(pat,string)</span><br><span class="line">rst2 = re.search(pat2,string2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rst)</span><br><span class="line"><span class="built_in">print</span>(rst2)</span><br></pre></td></tr></table></figure><h4 id="模式修正符"><a href="#模式修正符" class="headerlink" title="模式修正符"></a>模式修正符</h4><blockquote><p>所谓的模式修正符，即可以在不改变正则表达式的情况下，通过模式修正符改变正则表达式的含义，从而实现一些匹配结果的调整等功能。</p></blockquote><div class="table-container"><table><thead><tr><th>模式修正符</th><th>说明</th></tr></thead><tbody><tr><td>i</td><td>表示在和模式进行匹配进不区分大小写</td></tr><tr><td>m</td><td>将模式视为多行，使用^和$表示任何一行都可以以正则表达式开始或结束</td></tr><tr><td>s</td><td>如果没有使用这个模式修正符号，元字符中的”.”默认不能表示换行符号,将字符串视为单行</td></tr><tr><td>x</td><td>表示模式中的空白忽略不计</td></tr><tr><td>e</td><td>正则表达式必须使用在preg_replace替换字符串的函数中时才可以使用(讲这个函数时再说)</td></tr><tr><td>A</td><td>以模式字符串开头，相当于元字符^</td></tr><tr><td>Z</td><td>以模式字符串结尾，相当于元字符$</td></tr><tr><td>U</td><td>正则表达式的特点：就是比较“贪婪”，使用该模式修正符可以取消贪婪模式</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pat = <span class="string">&quot;.python...&quot;</span></span><br><span class="line"></span><br><span class="line">string = <span class="string">&quot;sfafaPythonfaf&quot;</span></span><br><span class="line"></span><br><span class="line">rst = re.search(pat,string,re.I) <span class="comment"># 模式修正；不区分大小写</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rst)</span><br></pre></td></tr></table></figure><h4 id="贪婪模式与懒惰模式"><a href="#贪婪模式与懒惰模式" class="headerlink" title="贪婪模式与懒惰模式"></a>贪婪模式与懒惰模式</h4><blockquote><p>贪婪模式的核心点就是尽可能多的匹配，而懒惰模式的核心点就是尽可能少的匹配。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pat = <span class="string">&quot;p.*y&quot;</span> <span class="comment"># 贪婪模式</span></span><br><span class="line">pat2 = <span class="string">&quot;p.*?y&quot;</span></span><br><span class="line"></span><br><span class="line">string = <span class="string">&quot;sfafapythonfafsfsfsfpythonsdfsfpython&quot;</span></span><br><span class="line"></span><br><span class="line">rst = re.search(pat,string)</span><br><span class="line">rst2 = re.search(pat2,string)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rst)</span><br><span class="line"><span class="built_in">print</span>(rst2)</span><br></pre></td></tr></table></figure><h4 id="正则表达式函数"><a href="#正则表达式函数" class="headerlink" title="正则表达式函数"></a>正则表达式函数</h4><blockquote><p>正则表达式函数有re.match()函数、re.search()函数、全局匹配函数、re.sub()函数</p></blockquote><div class="table-container"><table><thead><tr><th>re.match()</th><th>如果开头不是就直接返回None</th></tr></thead><tbody><tr><td>re.search</td><td>可以出现在字符串的任意位置</td></tr><tr><td>re.sub()</td><td></td></tr><tr><td>re.compile</td><td>可以搜索匹配全部满足条件的</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rst = re.<span class="built_in">compile</span>(pat1).findall(string)</span><br></pre></td></tr></table></figure><h4 id="常见正则实例"><a href="#常见正则实例" class="headerlink" title="常见正则实例"></a>常见正则实例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pat = <span class="string">&quot;[a-zA-Z]+://[^\s]*[.com|.cn]&quot;</span></span><br><span class="line"></span><br><span class="line">string = <span class="string">&#x27;&lt;a herf=&quot;http://www.baidu,com&gt;hshfhksdf&lt;/a&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">rst = re.<span class="built_in">compile</span>(pat).findall(string)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rst)</span><br></pre></td></tr></table></figure><h4 id="简单的爬虫"><a href="#简单的爬虫" class="headerlink" title="简单的爬虫"></a>简单的爬虫</h4><h5 id="提取CSDN的QQ群"><a href="#提取CSDN的QQ群" class="headerlink" title="提取CSDN的QQ群"></a>提取CSDN的QQ群</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pat = <span class="string">&quot;学员群(.*?)&lt;/span&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line">data = urllib.request.urlopen(<span class="string">&quot;https://edu.csdn.net/course/detail/4358&quot;</span>).read()</span><br><span class="line"></span><br><span class="line">result = re.<span class="built_in">compile</span>(pat).findall(<span class="built_in">str</span>(data))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://ts1989ed.oss-cn-shenzhen.aliyuncs.com/2019-08-25%2F1566745847.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Notes" scheme="http://www.ts1989.cn/categories/Notes/"/>
    
    
    <category term="IT" scheme="http://www.ts1989.cn/tags/IT/"/>
    
    <category term="Data Analysis" scheme="http://www.ts1989.cn/tags/Data-Analysis/"/>
    
    <category term="Python" scheme="http://www.ts1989.cn/tags/Python/"/>
    
  </entry>
  
</feed>
